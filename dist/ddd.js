(function(){var t=this,e=t._,i={},n=Array.prototype,r=Object.prototype,o=Function.prototype,a=n.push,s=n.slice,c=n.concat,l=r.toString,h=r.hasOwnProperty,u=n.forEach,p=n.map,d=n.reduce,f=n.reduceRight,v=n.filter,m=n.every,g=n.some,y=n.indexOf,b=n.lastIndexOf,A=Array.isArray,_=Object.keys,E=o.bind,x=function(t){return t instanceof x?t:this instanceof x?void(this._wrapped=t):new x(t)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=x),exports._=x):t._=x,x.VERSION="1.5.1";var w=x.each=x.forEach=function(t,e,n){if(null!=t)if(u&&t.forEach===u)t.forEach(e,n);else if(t.length===+t.length){for(var r=0,o=t.length;o>r;r++)if(e.call(n,t[r],r,t)===i)return}else for(var a in t)if(x.has(t,a)&&e.call(n,t[a],a,t)===i)return};x.map=x.collect=function(t,e,i){var n=[];return null==t?n:p&&t.map===p?t.map(e,i):(w(t,function(t,r,o){n.push(e.call(i,t,r,o))}),n)};var F="Reduce of empty array with no initial value";x.reduce=x.foldl=x.inject=function(t,e,i,n){var r=arguments.length>2;if(null==t&&(t=[]),d&&t.reduce===d)return n&&(e=x.bind(e,n)),r?t.reduce(e,i):t.reduce(e);if(w(t,function(t,o,a){r?i=e.call(n,i,t,o,a):(i=t,r=!0)}),!r)throw new TypeError(F);return i},x.reduceRight=x.foldr=function(t,e,i,n){var r=arguments.length>2;if(null==t&&(t=[]),f&&t.reduceRight===f)return n&&(e=x.bind(e,n)),r?t.reduceRight(e,i):t.reduceRight(e);var o=t.length;if(o!==+o){var a=x.keys(t);o=a.length}if(w(t,function(s,c,l){c=a?a[--o]:--o,r?i=e.call(n,i,t[c],c,l):(i=t[c],r=!0)}),!r)throw new TypeError(F);return i},x.find=x.detect=function(t,e,i){var n;return B(t,function(t,r,o){return e.call(i,t,r,o)?(n=t,!0):void 0}),n},x.filter=x.select=function(t,e,i){var n=[];return null==t?n:v&&t.filter===v?t.filter(e,i):(w(t,function(t,r,o){e.call(i,t,r,o)&&n.push(t)}),n)},x.reject=function(t,e,i){return x.filter(t,function(t,n,r){return!e.call(i,t,n,r)},i)},x.every=x.all=function(t,e,n){e||(e=x.identity);var r=!0;return null==t?r:m&&t.every===m?t.every(e,n):(w(t,function(t,o,a){return(r=r&&e.call(n,t,o,a))?void 0:i}),!!r)};var B=x.some=x.any=function(t,e,n){e||(e=x.identity);var r=!1;return null==t?r:g&&t.some===g?t.some(e,n):(w(t,function(t,o,a){return r||(r=e.call(n,t,o,a))?i:void 0}),!!r)};x.contains=x.include=function(t,e){return null==t?!1:y&&t.indexOf===y?-1!=t.indexOf(e):B(t,function(t){return t===e})},x.invoke=function(t,e){var i=s.call(arguments,2),n=x.isFunction(e);return x.map(t,function(t){return(n?e:t[e]).apply(t,i)})},x.pluck=function(t,e){return x.map(t,function(t){return t[e]})},x.where=function(t,e,i){return x.isEmpty(e)?i?void 0:[]:x[i?"find":"filter"](t,function(t){for(var i in e)if(e[i]!==t[i])return!1;return!0})},x.findWhere=function(t,e){return x.where(t,e,!0)},x.max=function(t,e,i){if(!e&&x.isArray(t)&&t[0]===+t[0]&&t.length<65535)return Math.max.apply(Math,t);if(!e&&x.isEmpty(t))return-(1/0);var n={computed:-(1/0),value:-(1/0)};return w(t,function(t,r,o){var a=e?e.call(i,t,r,o):t;a>n.computed&&(n={value:t,computed:a})}),n.value},x.min=function(t,e,i){if(!e&&x.isArray(t)&&t[0]===+t[0]&&t.length<65535)return Math.min.apply(Math,t);if(!e&&x.isEmpty(t))return 1/0;var n={computed:1/0,value:1/0};return w(t,function(t,r,o){var a=e?e.call(i,t,r,o):t;a<n.computed&&(n={value:t,computed:a})}),n.value},x.shuffle=function(t){var e,i=0,n=[];return w(t,function(t){e=x.random(i++),n[i-1]=n[e],n[e]=t}),n};var q=function(t){return x.isFunction(t)?t:function(e){return e[t]}};x.sortBy=function(t,e,i){var n=q(e);return x.pluck(x.map(t,function(t,e,r){return{value:t,index:e,criteria:n.call(i,t,e,r)}}).sort(function(t,e){var i=t.criteria,n=e.criteria;if(i!==n){if(i>n||void 0===i)return 1;if(n>i||void 0===n)return-1}return t.index<e.index?-1:1}),"value")};var C=function(t,e,i,n){var r={},o=q(null==e?x.identity:e);return w(t,function(e,a){var s=o.call(i,e,a,t);n(r,s,e)}),r};x.groupBy=function(t,e,i){return C(t,e,i,function(t,e,i){(x.has(t,e)?t[e]:t[e]=[]).push(i)})},x.countBy=function(t,e,i){return C(t,e,i,function(t,e){x.has(t,e)||(t[e]=0),t[e]++})},x.sortedIndex=function(t,e,i,n){i=null==i?x.identity:q(i);for(var r=i.call(n,e),o=0,a=t.length;a>o;){var s=o+a>>>1;i.call(n,t[s])<r?o=s+1:a=s}return o},x.toArray=function(t){return t?x.isArray(t)?s.call(t):t.length===+t.length?x.map(t,x.identity):x.values(t):[]},x.size=function(t){return null==t?0:t.length===+t.length?t.length:x.keys(t).length},x.first=x.head=x.take=function(t,e,i){return null!=t?null==e||i?t[0]:s.call(t,0,e):void 0},x.initial=function(t,e,i){return s.call(t,0,t.length-(null==e||i?1:e))},x.last=function(t,e,i){return null!=t?null==e||i?t[t.length-1]:s.call(t,Math.max(t.length-e,0)):void 0},x.rest=x.tail=x.drop=function(t,e,i){return s.call(t,null==e||i?1:e)},x.compact=function(t){return x.filter(t,x.identity)};var S=function(t,e,i){return e&&x.every(t,x.isArray)?c.apply(i,t):(w(t,function(t){x.isArray(t)||x.isArguments(t)?e?a.apply(i,t):S(t,e,i):i.push(t)}),i)};x.flatten=function(t,e){return S(t,e,[])},x.without=function(t){return x.difference(t,s.call(arguments,1))},x.uniq=x.unique=function(t,e,i,n){x.isFunction(e)&&(n=i,i=e,e=!1);var r=i?x.map(t,i,n):t,o=[],a=[];return w(r,function(i,n){(e?n&&a[a.length-1]===i:x.contains(a,i))||(a.push(i),o.push(t[n]))}),o},x.union=function(){return x.uniq(x.flatten(arguments,!0))},x.intersection=function(t){var e=s.call(arguments,1);return x.filter(x.uniq(t),function(t){return x.every(e,function(e){return x.indexOf(e,t)>=0})})},x.difference=function(t){var e=c.apply(n,s.call(arguments,1));return x.filter(t,function(t){return!x.contains(e,t)})},x.zip=function(){for(var t=x.max(x.pluck(arguments,"length").concat(0)),e=new Array(t),i=0;t>i;i++)e[i]=x.pluck(arguments,""+i);return e},x.object=function(t,e){if(null==t)return{};for(var i={},n=0,r=t.length;r>n;n++)e?i[t[n]]=e[n]:i[t[n][0]]=t[n][1];return i},x.indexOf=function(t,e,i){if(null==t)return-1;var n=0,r=t.length;if(i){if("number"!=typeof i)return n=x.sortedIndex(t,e),t[n]===e?n:-1;n=0>i?Math.max(0,r+i):i}if(y&&t.indexOf===y)return t.indexOf(e,i);for(;r>n;n++)if(t[n]===e)return n;return-1},x.lastIndexOf=function(t,e,i){if(null==t)return-1;var n=null!=i;if(b&&t.lastIndexOf===b)return n?t.lastIndexOf(e,i):t.lastIndexOf(e);for(var r=n?i:t.length;r--;)if(t[r]===e)return r;return-1},x.range=function(t,e,i){arguments.length<=1&&(e=t||0,t=0),i=arguments[2]||1;for(var n=Math.max(Math.ceil((e-t)/i),0),r=0,o=new Array(n);n>r;)o[r++]=t,t+=i;return o};var P=function(){};x.bind=function(t,e){var i,n;if(E&&t.bind===E)return E.apply(t,s.call(arguments,1));if(!x.isFunction(t))throw new TypeError;return i=s.call(arguments,2),n=function(){if(!(this instanceof n))return t.apply(e,i.concat(s.call(arguments)));P.prototype=t.prototype;var r=new P;P.prototype=null;var o=t.apply(r,i.concat(s.call(arguments)));return Object(o)===o?o:r}},x.partial=function(t){var e=s.call(arguments,1);return function(){return t.apply(this,e.concat(s.call(arguments)))}},x.bindAll=function(t){var e=s.call(arguments,1);if(0===e.length)throw new Error("bindAll must be passed function names");return w(e,function(e){t[e]=x.bind(t[e],t)}),t},x.memoize=function(t,e){var i={};return e||(e=x.identity),function(){var n=e.apply(this,arguments);return x.has(i,n)?i[n]:i[n]=t.apply(this,arguments)}},x.delay=function(t,e){var i=s.call(arguments,2);return setTimeout(function(){return t.apply(null,i)},e)},x.defer=function(t){return x.delay.apply(x,[t,1].concat(s.call(arguments,1)))},x.throttle=function(t,e,i){var n,r,o,a=null,s=0;i||(i={});var c=function(){s=i.leading===!1?0:new Date,a=null,o=t.apply(n,r)};return function(){var l=new Date;s||i.leading!==!1||(s=l);var h=e-(l-s);return n=this,r=arguments,0>=h?(clearTimeout(a),a=null,s=l,o=t.apply(n,r)):a||i.trailing===!1||(a=setTimeout(c,h)),o}},x.debounce=function(t,e,i){var n,r=null;return function(){var o=this,a=arguments,s=function(){r=null,i||(n=t.apply(o,a))},c=i&&!r;return clearTimeout(r),r=setTimeout(s,e),c&&(n=t.apply(o,a)),n}},x.once=function(t){var e,i=!1;return function(){return i?e:(i=!0,e=t.apply(this,arguments),t=null,e)}},x.wrap=function(t,e){return function(){var i=[t];return a.apply(i,arguments),e.apply(this,i)}},x.compose=function(){var t=arguments;return function(){for(var e=arguments,i=t.length-1;i>=0;i--)e=[t[i].apply(this,e)];return e[0]}},x.after=function(t,e){return function(){return--t<1?e.apply(this,arguments):void 0}},x.keys=_||function(t){if(t!==Object(t))throw new TypeError("Invalid object");var e=[];for(var i in t)x.has(t,i)&&e.push(i);return e},x.values=function(t){var e=[];for(var i in t)x.has(t,i)&&e.push(t[i]);return e},x.pairs=function(t){var e=[];for(var i in t)x.has(t,i)&&e.push([i,t[i]]);return e},x.invert=function(t){var e={};for(var i in t)x.has(t,i)&&(e[t[i]]=i);return e},x.functions=x.methods=function(t){var e=[];for(var i in t)x.isFunction(t[i])&&e.push(i);return e.sort()},x.extend=function(t){return w(s.call(arguments,1),function(e){if(e)for(var i in e)t[i]=e[i]}),t},x.pick=function(t){var e={},i=c.apply(n,s.call(arguments,1));return w(i,function(i){i in t&&(e[i]=t[i])}),e},x.omit=function(t){var e={},i=c.apply(n,s.call(arguments,1));for(var r in t)x.contains(i,r)||(e[r]=t[r]);return e},x.defaults=function(t){return w(s.call(arguments,1),function(e){if(e)for(var i in e)void 0===t[i]&&(t[i]=e[i])}),t},x.clone=function(t){return x.isObject(t)?x.isArray(t)?t.slice():x.extend({},t):t},x.tap=function(t,e){return e(t),t};var M=function(t,e,i,n){if(t===e)return 0!==t||1/t==1/e;if(null==t||null==e)return t===e;t instanceof x&&(t=t._wrapped),e instanceof x&&(e=e._wrapped);var r=l.call(t);if(r!=l.call(e))return!1;switch(r){case"[object String]":return t==String(e);case"[object Number]":return t!=+t?e!=+e:0==t?1/t==1/e:t==+e;case"[object Date]":case"[object Boolean]":return+t==+e;case"[object RegExp]":return t.source==e.source&&t.global==e.global&&t.multiline==e.multiline&&t.ignoreCase==e.ignoreCase}if("object"!=typeof t||"object"!=typeof e)return!1;for(var o=i.length;o--;)if(i[o]==t)return n[o]==e;var a=t.constructor,s=e.constructor;if(a!==s&&!(x.isFunction(a)&&a instanceof a&&x.isFunction(s)&&s instanceof s))return!1;i.push(t),n.push(e);var c=0,h=!0;if("[object Array]"==r){if(c=t.length,h=c==e.length)for(;c--&&(h=M(t[c],e[c],i,n)););}else{for(var u in t)if(x.has(t,u)&&(c++,!(h=x.has(e,u)&&M(t[u],e[u],i,n))))break;if(h){for(u in e)if(x.has(e,u)&&!c--)break;h=!c}}return i.pop(),n.pop(),h};x.isEqual=function(t,e){return M(t,e,[],[])},x.isEmpty=function(t){if(null==t)return!0;if(x.isArray(t)||x.isString(t))return 0===t.length;for(var e in t)if(x.has(t,e))return!1;return!0},x.isElement=function(t){return!(!t||1!==t.nodeType)},x.isArray=A||function(t){return"[object Array]"==l.call(t)},x.isObject=function(t){return t===Object(t)},w(["Arguments","Function","String","Number","Date","RegExp"],function(t){x["is"+t]=function(e){return l.call(e)=="[object "+t+"]"}}),x.isArguments(arguments)||(x.isArguments=function(t){return!(!t||!x.has(t,"callee"))}),"function"!=typeof/./&&(x.isFunction=function(t){return"function"==typeof t}),x.isFinite=function(t){return isFinite(t)&&!isNaN(parseFloat(t))},x.isNaN=function(t){return x.isNumber(t)&&t!=+t},x.isBoolean=function(t){return t===!0||t===!1||"[object Boolean]"==l.call(t)},x.isNull=function(t){return null===t},x.isUndefined=function(t){return void 0===t},x.has=function(t,e){return h.call(t,e)},x.noConflict=function(){return t._=e,this},x.identity=function(t){return t},x.times=function(t,e,i){for(var n=Array(Math.max(0,t)),r=0;t>r;r++)n[r]=e.call(i,r);return n},x.random=function(t,e){return null==e&&(e=t,t=0),t+Math.floor(Math.random()*(e-t+1))};var k={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;"}};k.unescape=x.invert(k.escape);var L={escape:new RegExp("["+x.keys(k.escape).join("")+"]","g"),unescape:new RegExp("("+x.keys(k.unescape).join("|")+")","g")};x.each(["escape","unescape"],function(t){x[t]=function(e){return null==e?"":(""+e).replace(L[t],function(e){return k[t][e]})}}),x.result=function(t,e){if(null!=t){var i=t[e];return x.isFunction(i)?i.call(t):i}},x.mixin=function(t){w(x.functions(t),function(e){var i=x[e]=t[e];x.prototype[e]=function(){var t=[this._wrapped];return a.apply(t,arguments),V.call(this,i.apply(x,t))}})};var R=0;x.uniqueId=function(t){var e=++R+"";return t?t+e:e},x.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var I=/(.)^/,O={"'":"'","\\":"\\","\r":"r","\n":"n","	":"t","\u2028":"u2028","\u2029":"u2029"},T=/\\|'|\r|\n|\t|\u2028|\u2029/g;x.template=function(t,e,i){var n;i=x.defaults({},i,x.templateSettings);var r=new RegExp([(i.escape||I).source,(i.interpolate||I).source,(i.evaluate||I).source].join("|")+"|$","g"),o=0,a="__p+='";t.replace(r,function(e,i,n,r,s){return a+=t.slice(o,s).replace(T,function(t){return"\\"+O[t]}),i&&(a+="'+\n((__t=("+i+"))==null?'':_.escape(__t))+\n'"),n&&(a+="'+\n((__t=("+n+"))==null?'':__t)+\n'"),r&&(a+="';\n"+r+"\n__p+='"),o=s+e.length,e}),a+="';\n",i.variable||(a="with(obj||{}){\n"+a+"}\n"),a="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+a+"return __p;\n";try{n=new Function(i.variable||"obj","_",a)}catch(s){throw s.source=a,s}if(e)return n(e,x);var c=function(t){return n.call(this,t,x)};return c.source="function("+(i.variable||"obj")+"){\n"+a+"}",c},x.chain=function(t){return x(t).chain()};var V=function(t){return this._chain?x(t).chain():t};x.mixin(x),w(["pop","push","reverse","shift","sort","splice","unshift"],function(t){var e=n[t];x.prototype[t]=function(){var i=this._wrapped;return e.apply(i,arguments),"shift"!=t&&"splice"!=t||0!==i.length||delete i[0],V.call(this,i)}}),w(["concat","join","slice"],function(t){var e=n[t];x.prototype[t]=function(){return V.call(this,e.apply(this._wrapped,arguments))}}),x.extend(x.prototype,{chain:function(){return this._chain=!0,this},value:function(){return this._wrapped}})}).call(this);var Backbone=Backbone||{};!function(){var t=[],e=t.slice,i=function(t,e,i){var n,r=-1,o=e.length;switch(i.length){case 0:for(;++r<o;)(n=e[r]).callback.call(n.ctx);return;case 1:for(;++r<o;)(n=e[r]).callback.call(n.ctx,i[0]);return;case 2:for(;++r<o;)(n=e[r]).callback.call(n.ctx,i[0],i[1]);return;case 3:for(;++r<o;)(n=e[r]).callback.call(n.ctx,i[0],i[1],i[2]);return;default:for(;++r<o;)(n=e[r]).callback.apply(n.ctx,i)}},n=Backbone.Events={on:function(t,e,i){this._events||(this._events={});var n=this._events[t]||(this._events[t]=[]);return n.push({callback:e,context:i,ctx:i||this}),this},once:function(t,e,i){var n=this,r=_.once(function(){n.off(t,r),e.apply(this,arguments)});return r._callback=e,this.on(t,r,i),this},off:function(t,e,i){var n,r,o,a,s,c,l,h;if(!this._events)return this;if(!t&&!e&&!i)return this._events={},this;for(a=t?[t]:_.keys(this._events),s=0,c=a.length;c>s;s++)if(t=a[s],n=this._events[t]){if(o=[],e||i)for(l=0,h=n.length;h>l;l++)r=n[l],(e&&e!==(r.callback._callback||r.callback)||i&&i!==r.context)&&o.push(r);this._events[t]=o}return this},trigger:function(t){if(!this._events)return this;var n=e.call(arguments,1),r=this._events[t],o=this._events.all;return r&&i(this,r,n),o&&i(this,o,arguments),this},listenTo:function(t,e,i){var n=this._listeners||(this._listeners={}),r=t._listenerId||(t._listenerId=_.uniqueId("l"));return n[r]=t,t.on(e,i||this,this),this},stopListening:function(t,e,i){var n=this._listeners;if(n){if(t)t.off(e,i,this),e||i||delete n[t._listenerId];else{for(var r in n)n[r].off(null,null,this);this._listeners={}}return this}}};n.bind=n.on,n.unbind=n.off,"undefined"!=typeof exports&&("undefined"!=typeof module&&module.exports&&(exports=module.exports=n),exports.Backbone=exports.Backbone||Backbone)}(),function(){function t(t,n){var r=(new Date).getTime(),o=Math.max(0,16-(r-i)),a=e.setTimeout(function(){t(r+o)},o);return i=r+o,a}var e=this,i=0,n=["ms","moz","webkit","o"];if("undefined"!=typeof exports)return"undefined"!=typeof module&&module.exports&&(exports=module.exports=t),void(exports.requestAnimationFrame=t);for(var r=0;r<n.length&&!e.requestAnimationFrame;++r)e.requestAnimationFrame=e[n[r]+"RequestAnimationFrame"],e.cancelAnimationFrame=e[n[r]+"CancelAnimationFrame"]||e[n[r]+"CancelRequestAnimationFrame"];e.requestAnimationFrame||(e.requestAnimationFrame=t),e.cancelAnimationFrame||(e.cancelAnimationFrame=function(t){clearTimeout(t)})}(),function(t,e,i,n){function r(){var t=document.body.getBoundingClientRect(),e=this.width=t.width,i=this.height=t.height;this.renderer.setSize(e,i,this.ratio),this.trigger(b.Events.resize,e,i)}function o(){return(a.performance&&a.performance.now?a.performance:Date).now()}var a=this,s=Math.sin,c=Math.cos,l=Math.atan2,h=Math.sqrt,u=(Math.round,Math.abs,Math.PI),p=2*u,d=u/2,f=Math.pow,v=Math.min,m=Math.max,g=0,y={temp:document.createElement("div"),hasEventListeners:e.isFunction(a.addEventListener),bind:function(t,e,i,n){return this.hasEventListeners?t.addEventListener(e,i,!!n):t.attachEvent("on"+e,i),this},unbind:function(t,e,i,n){return this.hasEventListeners?t.removeEventListeners(e,i,!!n):t.detachEvent("on"+e,i),this}},b=a.Two=function(t){var i=e.defaults(t||{},{fullscreen:!1,width:640,height:480,type:b.Types.svg,autostart:!1});if(e.each(i,function(t,e){"fullscreen"!==e&&"width"!==e&&"height"!==e&&"autostart"!==e&&(this[e]=t)},this),e.isElement(i.domElement)&&(this.type=b.Types[i.domElement.tagName.toLowerCase()]),this.renderer=new b[this.type](this),b.Utils.setPlaying.call(this,i.autostart),this.frameCount=0,i.fullscreen){var n=e.bind(r,this);e.extend(document.body.style,{overflow:"hidden",margin:0,padding:0,top:0,left:0,right:0,bottom:0,position:"fixed"}),e.extend(this.renderer.domElement.style,{display:"block",top:0,left:0,right:0,bottom:0,position:"fixed"}),y.bind(a,"resize",n),n()}else e.isElement(i.domElement)||(this.renderer.setSize(i.width,i.height,this.ratio),this.width=i.width,this.height=i.height);this.scene=this.renderer.scene,b.Instances.push(this)};e.extend(b,{Array:a.Float32Array||Array,Types:{webgl:"WebGLRenderer",svg:"SVGRenderer",canvas:"CanvasRenderer"},Version:"v0.5.0",Identifier:"two_",Properties:{hierarchy:"hierarchy",demotion:"demotion"},Events:{play:"play",pause:"pause",update:"update",render:"render",resize:"resize",change:"change",remove:"remove",insert:"insert",order:"order"},Commands:{move:"M",line:"L",curve:"C",close:"Z"},Resolution:8,Instances:[],noConflict:function(){return a.Two=t,this},uniqueId:function(){var t=g;return g++,t},Utils:{defineProperty:function(t){var e=this,i="_"+t,n="_flag"+t.charAt(0).toUpperCase()+t.slice(1);Object.defineProperty(e,t,{get:function(){return this[i]},set:function(t){this[i]=t,this[n]=!0}})},release:function(t){e.isObject(t)&&(e.isFunction(t.unbind)&&t.unbind(),t.vertices&&(e.isFunction(t.vertices.unbind)&&t.vertices.unbind(),e.each(t.vertices,function(t){e.isFunction(t.unbind)&&t.unbind()})),t.children&&e.each(t.children,function(t){b.Utils.release(t)}))},xhr:function(t,e){var i=new XMLHttpRequest;return i.open("GET",t),i.onreadystatechange=function(){4===i.readyState&&200===i.status&&e(i.responseText)},i.send(),i},Curve:{CollinearityEpsilon:f(10,-30),RecursionLimit:16,CuspLimit:0,Tolerance:{distance:.25,angle:0,epsilon:.01},abscissas:[[.5773502691896257],[0,.7745966692414834],[.33998104358485626,.8611363115940526],[0,.5384693101056831,.906179845938664],[.2386191860831969,.6612093864662645,.932469514203152],[0,.4058451513773972,.7415311855993945,.9491079123427585],[.1834346424956498,.525532409916329,.7966664774136267,.9602898564975363],[0,.3242534234038089,.6133714327005904,.8360311073266358,.9681602395076261],[.14887433898163122,.4333953941292472,.6794095682990244,.8650633666889845,.9739065285171717],[0,.26954315595234496,.5190961292068118,.7301520055740494,.8870625997680953,.978228658146057],[.1252334085114689,.3678314989981802,.5873179542866175,.7699026741943047,.9041172563704749,.9815606342467192],[0,.2304583159551348,.44849275103644687,.6423493394403402,.8015780907333099,.9175983992229779,.9841830547185881],[.10805494870734367,.31911236892788974,.5152486363581541,.6872929048116855,.827201315069765,.9284348836635735,.9862838086968123],[0,.20119409399743451,.3941513470775634,.5709721726085388,.7244177313601701,.8482065834104272,.937273392400706,.9879925180204854],[.09501250983763744,.2816035507792589,.45801677765722737,.6178762444026438,.755404408355003,.8656312023878318,.9445750230732326,.9894009349916499]],weights:[[1],[.8888888888888888,.5555555555555556],[.6521451548625461,.34785484513745385],[.5688888888888889,.47862867049936647,.23692688505618908],[.46791393457269104,.3607615730481386,.17132449237917036],[.4179591836734694,.3818300505051189,.27970539148927664,.1294849661688697],[.362683783378362,.31370664587788727,.22238103445337448,.10122853629037626],[.3302393550012598,.31234707704000286,.26061069640293544,.1806481606948574,.08127438836157441],[.29552422471475287,.26926671930999635,.21908636251598204,.1494513491505806,.06667134430868814],[.2729250867779006,.26280454451024665,.23319376459199048,.18629021092773426,.1255803694649046,.05566856711617366],[.24914704581340277,.2334925365383548,.20316742672306592,.16007832854334622,.10693932599531843,.04717533638651183],[.2325515532308739,.22628318026289723,.2078160475368885,.17814598076194574,.13887351021978725,.09212149983772845,.04048400476531588],[.2152638534631578,.2051984637212956,.18553839747793782,.15720316715819355,.12151857068790319,.08015808715976021,.03511946033175186],[.2025782419255613,.19843148532711158,.1861610000155622,.16626920581699392,.13957067792615432,.10715922046717194,.07036604748810812,.03075324199611727],[.1894506104550685,.18260341504492358,.16915651939500254,.14959598881657674,.12462897125553388,.09515851168249279,.062253523938647894,.027152459411754096]]},devicePixelRatio:a.devicePixelRatio||1,getBackingStoreRatio:function(t){return t.webkitBackingStorePixelRatio||t.mozBackingStorePixelRatio||t.msBackingStorePixelRatio||t.oBackingStorePixelRatio||t.backingStorePixelRatio||1},getRatio:function(t){return b.Utils.devicePixelRatio/F(t)},setPlaying:function(t){return this.playing=!!t,this},getComputedMatrix:function(t,i){i=i&&i.identity()||new b.Matrix;for(var n=t,r=[];n&&n._matrix;)r.push(n._matrix),n=n.parent;return r.reverse(),e.each(r,function(t){var e=t.elements;i.multiply(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9])}),i},deltaTransformPoint:function(t,e,i){var n=e*t.a+i*t.c+0,r=e*t.b+i*t.d+0;return new b.Vector(n,r)},decomposeMatrix:function(t){var e=b.Utils.deltaTransformPoint(t,0,1),i=b.Utils.deltaTransformPoint(t,1,0),n=180/Math.PI*Math.atan2(e.y,e.x)-90,r=180/Math.PI*Math.atan2(i.y,i.x);return{translateX:t.e,translateY:t.f,scaleX:Math.sqrt(t.a*t.a+t.b*t.b),scaleY:Math.sqrt(t.c*t.c+t.d*t.d),skewX:n,skewY:r,rotation:n}},applySvgAttributes:function(t,i){var n,r,o,a,s={},c={};if(getComputedStyle){var l=getComputedStyle(t);for(n=l.length;n--;)r=l[n],o=l[r],void 0!==o&&(c[r]=o)}for(n=t.attributes.length;n--;)a=t.attributes[n],s[a.nodeName]=a.value;e.isUndefined(c.opacity)||(c["stroke-opacity"]=c.opacity,c["fill-opacity"]=c.opacity),e.extend(c,s),c.visible=!(e.isUndefined(c.display)&&"none"===c.display)||e.isUndefined(c.visibility)&&"hidden"===c.visibility;for(r in c)switch(o=c[r],r){case"transform":if("none"===o)break;var h=t.getCTM();if(null===h)break;var u=b.Utils.decomposeMatrix(t.getCTM());i.translation.set(u.translateX,u.translateY),i.rotation=u.rotation,i.scale=u.scaleX,c.x&&(i.translation.x=c.x),c.y&&(i.translation.y=c.y);break;case"visible":i.visible=o;break;case"stroke-linecap":i.cap=o;break;case"stroke-linejoin":i.join=o;break;case"stroke-miterlimit":i.miter=o;break;case"stroke-width":i.linewidth=parseFloat(o);break;case"stroke-opacity":case"fill-opacity":case"opacity":i.opacity=parseFloat(o);break;case"fill":case"stroke":/url\(\#.*\)/i.test(o)?i[r]=this.getById(o.replace(/url\(\#(.*)\)/i,"$1")):i[r]="none"===o?"transparent":o;break;case"id":i.id=o;break;case"class":i.classList=o.split(" ")}return i},read:{svg:function(){return b.Utils.read.g.apply(this,arguments)},g:function(t){var e=new b.Group;b.Utils.applySvgAttributes.call(this,t,e);for(var i=0,n=t.childNodes.length;n>i;i++){var r=t.childNodes[i],o=r.nodeName;if(!o)return;var a=o.replace(/svg\:/gi,"").toLowerCase();if(a in b.Utils.read){var s=b.Utils.read[a].call(e,r);e.add(s)}}return e},polygon:function(t,e){var i=t.getAttribute("points"),n=[];i.replace(/(-?[\d\.?]+),(-?[\d\.?]+)/g,function(t,e,i){n.push(new b.Anchor(parseFloat(e),parseFloat(i)))});var r=new b.Path(n,!e).noStroke();return r.fill="black",b.Utils.applySvgAttributes.call(this,t,r)},polyline:function(t){return b.Utils.read.polygon.call(this,t,!0)},path:function(t){var i,n,r=t.getAttribute("d"),o=new b.Anchor,a=!1,s=!1,c=r.match(/[a-df-z][^a-df-z]*/gi),l=c.length-1;e.each(c.slice(0),function(t,e){var i,n=t[0],r=n.toLowerCase(),o=t.slice(1).trim().split(/[\s,]+|(?=\s?[+\-])/),a=[];switch(0>=e&&(c=[]),r){case"h":case"v":o.length>1&&(i=1);break;case"m":case"l":case"t":o.length>2&&(i=2);break;case"s":case"q":o.length>4&&(i=4);break;case"c":o.length>6&&(i=6);break;case"a":}if(i){for(var s=0,l=o.length,h=0;l>s;s+=i){var u=n;if(h>0)switch(n){case"m":u="l";break;case"M":u="L"}a.push([u].concat(o.slice(s,s+i)).join(" ")),h++}c=Array.prototype.concat.apply(c,a)}else c.push(t)});var h=e.flatten(e.map(c,function(t,r){var c,h,u,p=t[0],d=p.toLowerCase();n=t.slice(1).trim(),n=n.replace(/(-?\d+(?:\.\d*)?)[eE]([+\-]?\d+)/g,function(t,e,i){return parseFloat(e)*f(10,i)}),n=n.split(/[\s,]+|(?=\s?[+\-])/),s=p===d;var v,m,g,y,A,_,E,x,F;switch(d){case"z":r>=l?a=!0:(h=o.x,u=o.y,c=new b.Anchor(h,u,void 0,void 0,void 0,void 0,b.Commands.close));break;case"m":case"l":h=parseFloat(n[0]),u=parseFloat(n[1]),c=new b.Anchor(h,u,void 0,void 0,void 0,void 0,"m"===d?b.Commands.move:b.Commands.line),s&&c.addSelf(o),o=c;break;case"h":case"v":var B="h"===d?"x":"y",q="x"===B?"y":"x";c=new b.Anchor(void 0,void 0,void 0,void 0,void 0,void 0,b.Commands.line),c[B]=parseFloat(n[0]),c[q]=o[q],s&&(c[B]+=o[B]),o=c;break;case"c":case"s":v=o.x,m=o.y,i||(i=new b.Vector),"c"===d?(g=parseFloat(n[0]),y=parseFloat(n[1]),A=parseFloat(n[2]),_=parseFloat(n[3]),E=parseFloat(n[4]),x=parseFloat(n[5])):(F=C(o,i,s),g=F.x,y=F.y,A=parseFloat(n[0]),_=parseFloat(n[1]),E=parseFloat(n[2]),x=parseFloat(n[3])),s&&(g+=v,y+=m,A+=v,_+=m,E+=v,x+=m),e.isObject(o.controls)||b.Anchor.AppendCurveProperties(o),o.controls.right.set(g-o.x,y-o.y),c=new b.Anchor(E,x,A-E,_-x,void 0,void 0,b.Commands.curve),o=c,i=c.controls.left;break;case"t":case"q":v=o.x,m=o.y,i||(i=new b.Vector),i.isZero()?(g=v,y=m):(g=i.x,m=i.y),"q"===d?(A=parseFloat(n[0]),_=parseFloat(n[1]),E=parseFloat(n[1]),x=parseFloat(n[2])):(F=C(o,i,s),A=F.x,_=F.y,E=parseFloat(n[0]),x=parseFloat(n[1])),s&&(g+=v,y+=m,A+=v,_+=m,E+=v,x+=m),e.isObject(o.controls)||b.Anchor.AppendCurveProperties(o),o.controls.right.set(g-o.x,y-o.y),c=new b.Anchor(E,x,A-E,_-x,void 0,void 0,b.Commands.curve),o=c,i=c.controls.left;break;case"a":v=o.x,m=o.y;var S=parseFloat(n[0]),P=parseFloat(n[1]),M=parseFloat(n[2])*Math.PI/180,k=parseFloat(n[3]),L=parseFloat(n[4]);E=parseFloat(n[5]),x=parseFloat(n[6]),s&&(E+=v,x+=m);var R=(E-v)/2,I=(x-m)/2,O=R*Math.cos(M)+I*Math.sin(M),T=-R*Math.sin(M)+I*Math.cos(M),V=S*S,N=P*P,U=O*O,G=T*T,D=U/V+G/N;D>1&&(S*=Math.sqrt(D),P*=Math.sqrt(D));var j=Math.sqrt((V*N-V*G-N*U)/(V*G+N*U));e.isNaN(j)?j=0:k!=L&&j>0&&(j*=-1);var z=j*S*T/P,X=-j*P*O/S,H=z*Math.cos(M)-X*Math.sin(M)+(v+E)/2,W=z*Math.sin(M)+X*Math.cos(M)+(m+x)/2,Y=function(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2))},K=function(t,e){return(t[0]*e[0]+t[1]*e[1])/(Y(t)*Y(e))},B=function(t,e){return(t[0]*e[1]<t[1]*e[0]?-1:1)*Math.acos(K(t,e))},Z=B([1,0],[(O-z)/S,(T-X)/P]),J=[(O-z)/S,(T-X)/P],Q=[(-O-z)/S,(-T-X)/P],$=B(J,Q);K(J,Q)<=-1&&($=Math.PI),K(J,Q)>=1&&($=0),k&&($=w($,2*Math.PI)),L&&$>0&&($-=2*Math.PI);var tt=b.Resolution,et=(new b.Matrix).translate(H,W).rotate(M);c=e.map(e.range(tt),function(t){var e=1-t/(tt-1),i=e*$+Z,n=S*Math.cos(i),r=P*Math.sin(i),o=et.multiply(n,r,1);return new b.Anchor(o.x,o.y,!1,!1,!1,!1,b.Commands.line)}),c.push(new b.Anchor(E,x,!1,!1,!1,!1,b.Commands.line)),o=c[c.length-1],i=o.controls.left}return c}));if(!(h.length<=1)){h=e.compact(h);var u=new b.Path(h,a,void 0,!0).noStroke();return u.fill="black",b.Utils.applySvgAttributes.call(this,t,u)}},circle:function(t){var i=parseFloat(t.getAttribute("cx")),n=parseFloat(t.getAttribute("cy")),r=parseFloat(t.getAttribute("r")),o=b.Resolution,a=e.map(e.range(o),function(t){var e=t/o,i=e*p,n=r*c(i),a=r*s(i);return new b.Anchor(n,a)}),l=new b.Path(a,!0,!0).noStroke();return l.translation.set(i,n),l.fill="black",b.Utils.applySvgAttributes.call(this,t,l)},ellipse:function(t){var i=parseFloat(t.getAttribute("cx")),n=parseFloat(t.getAttribute("cy")),r=parseFloat(t.getAttribute("rx")),o=parseFloat(t.getAttribute("ry")),a=b.Resolution,l=e.map(e.range(a),function(t){var e=t/a,i=e*p,n=r*c(i),l=o*s(i);return new b.Anchor(n,l)}),h=new b.Path(l,!0,!0).noStroke();return h.translation.set(i,n),h.fill="black",b.Utils.applySvgAttributes.call(this,t,h)},rect:function(t){var e=parseFloat(t.getAttribute("x"))||0,i=parseFloat(t.getAttribute("y"))||0,n=parseFloat(t.getAttribute("width")),r=parseFloat(t.getAttribute("height")),o=n/2,a=r/2,s=[new b.Anchor(o,a),new b.Anchor(-o,a),new b.Anchor(-o,-a),new b.Anchor(o,-a)],c=new b.Path(s,!0).noStroke();return c.translation.set(e+o,i+a),c.fill="black",b.Utils.applySvgAttributes.call(this,t,c)},line:function(t){var e=parseFloat(t.getAttribute("x1")),i=parseFloat(t.getAttribute("y1")),n=parseFloat(t.getAttribute("x2")),r=parseFloat(t.getAttribute("y2")),o=n-e,a=r-i,s=o/2,c=a/2,l=[new b.Anchor(-s,-c),new b.Anchor(s,c)],h=new b.Path(l).noFill();return h.translation.set(e+s,i+c),b.Utils.applySvgAttributes.call(this,t,h)},lineargradient:function(t){for(var i=parseFloat(t.getAttribute("x1")),n=parseFloat(t.getAttribute("y1")),r=parseFloat(t.getAttribute("x2")),o=parseFloat(t.getAttribute("y2")),a=(r+i)/2,s=(o+n)/2,c=[],l=0;l<t.children.length;l++){var h=t.children[l],u=parseFloat(h.getAttribute("offset")),p=h.getAttribute("stop-color"),d=h.getAttribute("stop-opacity"),f=h.getAttribute("style");if(e.isNull(p)){var v=f.match(/stop\-color\:\s?([\#a-fA-F0-9]*)/);p=v&&v.length>1?v[1]:void 0}if(e.isNull(d)){var v=f.match(/stop\-opacity\:\s?([0-1\.\-]*)/);d=v&&v.length>1?parseFloat(v[1]):1}c.push(new b.Gradient.Stop(u,p,d))}var m=new b.LinearGradient(i-a,n-s,r-a,o-s,c);return b.Utils.applySvgAttributes.call(this,t,m)},radialgradient:function(t){var i=parseFloat(t.getAttribute("cx"))||0,n=parseFloat(t.getAttribute("cy"))||0,r=parseFloat(t.getAttribute("r")),o=parseFloat(t.getAttribute("fx")),a=parseFloat(t.getAttribute("fy"));e.isNaN(o)&&(o=i),e.isNaN(a)&&(a=n);for(var s=Math.abs(i+o)/2,c=Math.abs(n+a)/2,l=[],h=0;h<t.children.length;h++){var u=t.children[h],p=parseFloat(u.getAttribute("offset")),d=u.getAttribute("stop-color"),f=u.getAttribute("stop-opacity"),v=u.getAttribute("style");if(e.isNull(d)){var m=v.match(/stop\-color\:\s?([\#a-fA-F0-9]*)/);d=m&&m.length>1?m[1]:void 0}if(e.isNull(f)){var m=v.match(/stop\-opacity\:\s?([0-1\.\-]*)/);f=m&&m.length>1?parseFloat(m[1]):1}l.push(new b.Gradient.Stop(p,d,f))}var g=new b.RadialGradient(i-s,n-c,r,l,o-s,a-c);return b.Utils.applySvgAttributes.call(this,t,g)}},subdivide:function(t,i,n,r,o,a,s,c,l){l=l||b.Utils.Curve.RecursionLimit;var h=l+1;return t===s&&i===c?[new b.Anchor(s,c)]:e.map(e.range(0,h),function(e){var l=e/h,u=B(l,t,n,o,s),p=B(l,i,r,a,c);return new b.Anchor(u,p)})},getPointOnCubicBezier:function(t,e,i,n,r){var o=1-t;return o*o*o*e+3*o*o*t*i+3*o*t*t*n+t*t*t*r},getCurveLength:function(t,e,i,n,r,o,a,s,c){if(t===i&&e===n&&r===a&&o===s){var l=a-t,u=s-e;return h(l*l+u*u)}var p=9*(i-r)+3*(a-t),d=6*(t+r)-12*i,f=3*(i-t),v=9*(n-o)+3*(s-e),m=6*(e+o)-12*n,g=3*(n-e),y=function(t){var e=(p*t+d)*t+f,i=(v*t+m)*t+g;return h(e*e+i*i)};return q(y,0,1,c||b.Utils.Curve.RecursionLimit)},integrate:function(t,e,i,n){for(var r=b.Utils.Curve.abscissas[n-2],o=b.Utils.Curve.weights[n-2],a=.5*(i-e),s=a+e,c=0,l=n+1>>1,h=1&n?o[c++]*t(s):0;l>c;){var u=a*r[c];h+=o[c++]*(t(s+u)+t(s-u))}return a*h},getCurveFromPoints:function(t,i){
for(var n=t.length,r=n-1,o=0;n>o;o++){var a=t[o];e.isObject(a.controls)||b.Anchor.AppendCurveProperties(a);var s=i?w(o-1,n):m(o-1,0),c=i?w(o+1,n):v(o+1,r),l=t[s],h=a,u=t[c];x(l,h,u),h._command=0===o?b.Commands.move:b.Commands.curve,h.controls.left.x=e.isNumber(h.controls.left.x)?h.controls.left.x:h.x,h.controls.left.y=e.isNumber(h.controls.left.y)?h.controls.left.y:h.y,h.controls.right.x=e.isNumber(h.controls.right.x)?h.controls.right.x:h.x,h.controls.right.y=e.isNumber(h.controls.right.y)?h.controls.right.y:h.y}},getControlPoints:function(t,i,n){var r=E(t,i),o=E(n,i),a=A(t,i),l=A(n,i),h=(r+o)/2;return i.u=e.isObject(i.controls.left)?i.controls.left:new b.Vector(0,0),i.v=e.isObject(i.controls.right)?i.controls.right:new b.Vector(0,0),1e-4>a||1e-4>l?(i._relative||(i.controls.left.copy(i),i.controls.right.copy(i)),i):(a*=.33,l*=.33,r>o?h+=d:h-=d,i.controls.left.x=c(h)*a,i.controls.left.y=s(h)*a,h-=u,i.controls.right.x=c(h)*l,i.controls.right.y=s(h)*l,i._relative||(i.controls.left.x+=i.x,i.controls.left.y+=i.y,i.controls.right.x+=i.x,i.controls.right.y+=i.y),i)},getReflection:function(t,e,i){return new b.Vector(2*t.x-(e.x+t.x)-(i?t.x:0),2*t.y-(e.y+t.y)-(i?t.y:0))},getAnchorsFromArcData:function(t,i,n,r,o,a,s){var c=((new b.Matrix).translate(t.x,t.y).rotate(i),b.Resolution);return e.map(e.range(c),function(t){var e=(t+1)/c;s&&(e=1-e);var i=e*a+o,l=n*Math.cos(i),h=r*Math.sin(i),u=new b.Anchor(l,h);return b.Anchor.AppendCurveProperties(u),u.command=b.Commands.line,u})},ratioBetween:function(t,e){return(t.x*e.x+t.y*e.y)/(t.length()*e.length())},angleBetween:function(t,e){var i,n;return arguments.length>=4?(i=arguments[0]-arguments[2],n=arguments[1]-arguments[3],l(n,i)):(i=t.x-e.x,n=t.y-e.y,l(n,i))},distanceBetweenSquared:function(t,e){var i=t.x-e.x,n=t.y-e.y;return i*i+n*n},distanceBetween:function(t,e){return h(_(t,e))},toFixed:function(t){return Math.floor(1e3*t)/1e3},mod:function(t,e){for(;0>t;)t+=e;return t%e},Collection:function(){Array.call(this),arguments.length>1?Array.prototype.push.apply(this,arguments):arguments[0]&&Array.isArray(arguments[0])&&Array.prototype.push.apply(this,arguments[0])},Error:function(t){this.name="two.js",this.message=t}}}),b.Utils.Error.prototype=new Error,b.Utils.Error.prototype.constructor=b.Utils.Error,b.Utils.Collection.prototype=new Array,b.Utils.Collection.constructor=b.Utils.Collection,e.extend(b.Utils.Collection.prototype,i.Events,{pop:function(){var t=Array.prototype.pop.apply(this,arguments);return this.trigger(b.Events.remove,[t]),t},shift:function(){var t=Array.prototype.shift.apply(this,arguments);return this.trigger(b.Events.remove,[t]),t},push:function(){var t=Array.prototype.push.apply(this,arguments);return this.trigger(b.Events.insert,arguments),t},unshift:function(){var t=Array.prototype.unshift.apply(this,arguments);return this.trigger(b.Events.insert,arguments),t},splice:function(){var t,e=Array.prototype.splice.apply(this,arguments);return this.trigger(b.Events.remove,e),arguments.length>2&&(t=this.slice(arguments[0],arguments.length-2),this.trigger(b.Events.insert,t),this.trigger(b.Events.order)),e},sort:function(){return Array.prototype.sort.apply(this,arguments),this.trigger(b.Events.order),this},reverse:function(){return Array.prototype.reverse.apply(this,arguments),this.trigger(b.Events.order),this}});var A=b.Utils.distanceBetween,_=(b.Utils.getAnchorsFromArcData,b.Utils.distanceBetweenSquared),E=(b.Utils.ratioBetween,b.Utils.angleBetween),x=b.Utils.getControlPoints,w=(b.Utils.getCurveFromPoints,b.Utils.solveSegmentIntersection,b.Utils.decoupleShapes,b.Utils.mod),F=b.Utils.getBackingStoreRatio,B=b.Utils.getPointOnCubicBezier,q=(b.Utils.getCurveLength,b.Utils.integrate),C=b.Utils.getReflection;e.extend(b.prototype,i.Events,{appendTo:function(t){return t.appendChild(this.renderer.domElement),this},play:function(){return b.Utils.setPlaying.call(this,!0),this.trigger(b.Events.play)},pause:function(){return this.playing=!1,this.trigger(b.Events.pause)},update:function(){var t=!!this._lastFrame,e=o();this.frameCount++,t&&(this.timeDelta=parseFloat((e-this._lastFrame).toFixed(3))),this._lastFrame=e;var i=this.width,n=this.height,r=this.renderer;return(i!==r.width||n!==r.height)&&r.setSize(i,n,this.ratio),this.trigger(b.Events.update,this.frameCount,this.timeDelta),this.render()},render:function(){return this.renderer.render(),this.trigger(b.Events.render,this.frameCount)},add:function(t){var i=t;return i instanceof Array||(i=e.toArray(arguments)),this.scene.add(i),this},remove:function(t){var i=t;return i instanceof Array||(i=e.toArray(arguments)),this.scene.remove(i),this},clear:function(){return this.scene.remove(e.toArray(this.scene.children)),this},makeLine:function(t,e,i,n){var r=new b.Line(t,e,i,n);return this.scene.add(r),r},makeRectangle:function(t,e,i,n){var r=new b.Rectangle(t,e,i,n);return this.scene.add(r),r},makeRoundedRectangle:function(t,e,i,n,r){var o=new b.RoundedRectangle(t,e,i,n,r);return this.scene.add(o),o},makeCircle:function(t,e,i){return this.makeEllipse(t,e,i,i)},makeEllipse:function(t,e,i,n){var r=new b.Ellipse(t,e,i,n);return this.scene.add(r),r},makeStar:function(t,e,i,n,r){var o=new b.Star(t,e,i,n,r);return this.scene.add(o),o},makeCurve:function(t){var i=arguments.length,n=t;if(!e.isArray(t)){n=[];for(var r=0;i>r;r+=2){var o=arguments[r];if(!e.isNumber(o))break;var a=arguments[r+1];n.push(new b.Anchor(o,a))}}var s=arguments[i-1],c=new b.Path(n,!(e.isBoolean(s)?s:void 0),!0),l=c.getBoundingClientRect();return c.center().translation.set(l.left+l.width/2,l.top+l.height/2),this.scene.add(c),c},makePolygon:function(t,e,i,n){var r=new b.Polygon(t,e,i,n);return this.scene.add(r),r},makeArcSegment:function(t,e,i,n,r,o,a){var s=new b.ArcSegment(t,e,i,n,r,o,a);return this.scene.add(s),s},makePath:function(t){var i=arguments.length,n=t;if(!e.isArray(t)){n=[];for(var r=0;i>r;r+=2){var o=arguments[r];if(!e.isNumber(o))break;var a=arguments[r+1];n.push(new b.Anchor(o,a))}}var s=arguments[i-1],c=new b.Path(n,!(e.isBoolean(s)?s:void 0)),l=c.getBoundingClientRect();return c.center().translation.set(l.left+l.width/2,l.top+l.height/2),this.scene.add(c),c},makeLinearGradient:function(t,e,i,n){var r=Array.prototype.slice.call(arguments,4),o=new b.LinearGradient(t,e,i,n,r);return this.add(o),o},makeRadialGradient:function(t,e,i){var n=Array.prototype.slice.call(arguments,3),r=new b.RadialGradient(t,e,i,n);return this.add(r),r},makeGroup:function(t){var i=t;i instanceof Array||(i=e.toArray(arguments));var n=new b.Group;return this.scene.add(n),n.add(i),n},interpret:function(t,e){var i=t.tagName.toLowerCase();if(!(i in b.Utils.read))return null;var n=b.Utils.read[i].call(this,t);return e&&n instanceof b.Group?this.add(n.children):this.add(n),n},load:function(t,i){var n,r,o=[];if(/.*\.svg/gi.test(t))return b.Utils.xhr(t,e.bind(function(t){for(y.temp.innerHTML=t,r=0;r<y.temp.children.length;r++)n=y.temp.children[r],o.push(this.interpret(n));i(o.length<=1?o[0]:o,y.temp.children.length<=1?y.temp.children[0]:y.temp.children)},this)),this;for(y.temp.innerHTML=t,r=0;r<y.temp.children.length;r++)n=y.temp.children[r],o.push(this.interpret(n));return i(o.length<=1?o[0]:o,y.temp.children.length<=1?y.temp.children[0]:y.temp.children),this}}),function(){n(arguments.callee),b.Instances.forEach(function(t){t.playing&&t.update()})}(),"function"==typeof define&&define.amd?define(function(){return b}):"undefined"!=typeof module&&module.exports&&(module.exports=b)}(this.Two||{},"function"==typeof require?require("underscore"):_,"function"==typeof require?require("backbone"):Backbone,"function"==typeof require?require("requestAnimationFrame"):requestAnimationFrame),function(t,e,i,n){var r=t.Vector=function(t,e){this.x=t||0,this.y=e||0};e.extend(r,{zero:new t.Vector}),e.extend(r.prototype,i.Events,{set:function(t,e){return this.x=t,this.y=e,this},copy:function(t){return this.x=t.x,this.y=t.y,this},clear:function(){return this.x=0,this.y=0,this},clone:function(){return new r(this.x,this.y)},add:function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this},addSelf:function(t){return this.x+=t.x,this.y+=t.y,this},sub:function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this},subSelf:function(t){return this.x-=t.x,this.y-=t.y,this},multiplySelf:function(t){return this.x*=t.x,this.y*=t.y,this},multiplyScalar:function(t){return this.x*=t,this.y*=t,this},divideScalar:function(t){return t?(this.x/=t,this.y/=t):this.set(0,0),this},negate:function(){return this.multiplyScalar(-1)},dot:function(t){return this.x*t.x+this.y*t.y},lengthSquared:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.lengthSquared())},normalize:function(){return this.divideScalar(this.length())},distanceTo:function(t){return Math.sqrt(this.distanceToSquared(t))},distanceToSquared:function(t){var e=this.x-t.x,i=this.y-t.y;return e*e+i*i},setLength:function(t){return this.normalize().multiplyScalar(t)},equals:function(t,e){return e="undefined"==typeof e?1e-4:e,this.distanceTo(t)<e},lerp:function(t,e){var i=(t.x-this.x)*e+this.x,n=(t.y-this.y)*e+this.y;return this.set(i,n)},isZero:function(t){return t="undefined"==typeof t?1e-4:t,this.length()<t},toString:function(){return this.x+","+this.y},toObject:function(){return{x:this.x,y:this.y}}});var o={set:function(e,i){return this._x=e,this._y=i,this.trigger(t.Events.change)},copy:function(e){return this._x=e.x,this._y=e.y,this.trigger(t.Events.change)},clear:function(){return this._x=0,this._y=0,this.trigger(t.Events.change)},clone:function(){return new r(this._x,this._y)},add:function(e,i){return this._x=e.x+i.x,this._y=e.y+i.y,this.trigger(t.Events.change)},addSelf:function(e){return this._x+=e.x,this._y+=e.y,this.trigger(t.Events.change)},sub:function(e,i){return this._x=e.x-i.x,this._y=e.y-i.y,this.trigger(t.Events.change)},subSelf:function(e){return this._x-=e.x,this._y-=e.y,this.trigger(t.Events.change)},multiplySelf:function(e){return this._x*=e.x,this._y*=e.y,this.trigger(t.Events.change)},multiplyScalar:function(e){return this._x*=e,this._y*=e,this.trigger(t.Events.change)},divideScalar:function(e){return e?(this._x/=e,this._y/=e,this.trigger(t.Events.change)):this.clear()},negate:function(){return this.multiplyScalar(-1)},dot:function(t){return this._x*t.x+this._y*t.y},lengthSquared:function(){return this._x*this._x+this._y*this._y},length:function(){return Math.sqrt(this.lengthSquared())},normalize:function(){return this.divideScalar(this.length())},distanceTo:function(t){return Math.sqrt(this.distanceToSquared(t))},distanceToSquared:function(t){var e=this._x-t.x,i=this._y-t.y;return e*e+i*i},setLength:function(t){return this.normalize().multiplyScalar(t)},equals:function(t,e){return e="undefined"==typeof e?1e-4:e,this.distanceTo(t)<e},lerp:function(t,e){var i=(t.x-this._x)*e+this._x,n=(t.y-this._y)*e+this._y;return this.set(i,n)},isZero:function(t){return t="undefined"==typeof t?1e-4:t,this.length()<t},toString:function(){return this._x+","+this._y},toObject:function(){return{x:this._x,y:this._y}}},a={get:function(){return this._x},set:function(e){this._x=e,this.trigger(t.Events.change,"x")}},s={get:function(){return this._y},set:function(e){this._y=e,this.trigger(t.Events.change,"y")}};t.Vector.prototype.bind=t.Vector.prototype.on=function(){return this._bound||(this._x=this.x,this._y=this.y,Object.defineProperty(this,"x",a),Object.defineProperty(this,"y",s),e.extend(this,o),this._bound=!0),i.Events.bind.apply(this,arguments),this}}(Two,"function"==typeof require?require("underscore"):_,"function"==typeof require?require("backbone"):Backbone,"function"==typeof require?require("requestAnimationFrame"):requestAnimationFrame),function(t,e,i,n){var r=t.Commands,o=t.Anchor=function(i,n,a,s,c,l,h){return t.Vector.call(this,i,n),this._broadcast=e.bind(function(){this.trigger(t.Events.change)},this),this._command=h||r.move,this._relative=!0,h?(o.AppendCurveProperties(this),e.isNumber(a)&&(this.controls.left.x=a),e.isNumber(s)&&(this.controls.left.y=s),e.isNumber(c)&&(this.controls.right.x=c),void(e.isNumber(l)&&(this.controls.right.y=l))):this};e.extend(o,{AppendCurveProperties:function(e){e.controls={left:new t.Vector(0,0),right:new t.Vector(0,0)}}});var a={listen:function(){return e.isObject(this.controls)||o.AppendCurveProperties(this),this.controls.left.bind(t.Events.change,this._broadcast),this.controls.right.bind(t.Events.change,this._broadcast),this},ignore:function(){return this.controls.left.unbind(t.Events.change,this._broadcast),this.controls.right.unbind(t.Events.change,this._broadcast),this},clone:function(){var e=this.controls,i=new t.Anchor(this.x,this.y,e&&e.left.x,e&&e.left.y,e&&e.right.x,e&&e.right.y,this.command);return i.relative=this._relative,i},toObject:function(){var t={x:this.x,y:this.y};return this._command&&(t.command=this._command),this._relative&&(t.relative=this._relative),this.controls&&(t.controls={left:this.controls.left.toObject(),right:this.controls.right.toObject()}),t}};Object.defineProperty(o.prototype,"command",{get:function(){return this._command},set:function(i){return this._command=i,this._command!==r.curve||e.isObject(this.controls)||o.AppendCurveProperties(this),this.trigger(t.Events.change)}}),Object.defineProperty(o.prototype,"relative",{get:function(){return this._relative},set:function(e){return this._relative==e?this:(this._relative=!!e,this.trigger(t.Events.change))}}),e.extend(o.prototype,t.Vector.prototype,a),t.Anchor.prototype.bind=t.Anchor.prototype.on=function(){t.Vector.prototype.bind.apply(this,arguments),e.extend(this,a)},t.Anchor.prototype.unbind=t.Anchor.prototype.off=function(){t.Vector.prototype.unbind.apply(this,arguments),e.extend(this,a)}}(Two,"function"==typeof require?require("underscore"):_,"function"==typeof require?require("backbone"):Backbone,"function"==typeof require?require("requestAnimationFrame"):requestAnimationFrame),function(t,e,i,n){var r=Math.cos,o=Math.sin,a=Math.tan,s=t.Matrix=function(i,n,r,o,a,s){this.elements=new t.Array(9);var c=i;e.isArray(c)||(c=e.toArray(arguments)),this.identity().set(c)};e.extend(s,{Identity:[1,0,0,0,1,0,0,0,1],Multiply:function(e,i,n){if(i.length<=3){var r,o,a,s=e,c=i[0]||0,l=i[1]||0,h=i[2]||0;return r=s[0]*c+s[1]*l+s[2]*h,o=s[3]*c+s[4]*l+s[5]*h,a=s[6]*c+s[7]*l+s[8]*h,{x:r,y:o,z:a}}var u=e[0],p=e[1],d=e[2],f=e[3],v=e[4],m=e[5],g=e[6],y=e[7],b=e[8],A=i[0],_=i[1],E=i[2],x=i[3],w=i[4],F=i[5],B=i[6],q=i[7],C=i[8];return n=n||new t.Array(9),n[0]=u*A+p*x+d*B,n[1]=u*_+p*w+d*q,n[2]=u*E+p*F+d*C,n[3]=f*A+v*x+m*B,n[4]=f*_+v*w+m*q,n[5]=f*E+v*F+m*C,n[6]=g*A+y*x+b*B,n[7]=g*_+y*w+b*q,n[8]=g*E+y*F+b*C,n}}),e.extend(s.prototype,i.Events,{set:function(i){var n=i;return e.isArray(n)||(n=e.toArray(arguments)),e.extend(this.elements,n),this.trigger(t.Events.change)},identity:function(){return this.set(s.Identity),this},multiply:function(i,n,r,o,a,s,c,l,h){var u=arguments,p=u.length;if(1>=p)return e.each(this.elements,function(t,e){this.elements[e]=t*i},this),this.trigger(t.Events.change);if(3>=p){var d,f,v;return i=i||0,n=n||0,r=r||0,a=this.elements,d=a[0]*i+a[1]*n+a[2]*r,f=a[3]*i+a[4]*n+a[5]*r,v=a[6]*i+a[7]*n+a[8]*r,{x:d,y:f,z:v}}var m=this.elements,g=u,y=m[0],b=m[1],A=m[2],_=m[3],E=m[4],x=m[5],w=m[6],F=m[7],B=m[8],q=g[0],C=g[1],S=g[2],P=g[3],M=g[4],k=g[5],L=g[6],R=g[7],I=g[8];return this.elements[0]=y*q+b*P+A*L,this.elements[1]=y*C+b*M+A*R,this.elements[2]=y*S+b*k+A*I,this.elements[3]=_*q+E*P+x*L,this.elements[4]=_*C+E*M+x*R,this.elements[5]=_*S+E*k+x*I,this.elements[6]=w*q+F*P+B*L,this.elements[7]=w*C+F*M+B*R,this.elements[8]=w*S+F*k+B*I,this.trigger(t.Events.change)},inverse:function(e){var i=this.elements;e=e||new t.Matrix;var n=i[0],r=i[1],o=i[2],a=i[3],s=i[4],c=i[5],l=i[6],h=i[7],u=i[8],p=u*s-c*h,d=-u*a+c*l,f=h*a-s*l,v=n*p+r*d+o*f;return v?(v=1/v,e.elements[0]=p*v,e.elements[1]=(-u*r+o*h)*v,e.elements[2]=(c*r-o*s)*v,e.elements[3]=d*v,e.elements[4]=(u*n-o*l)*v,e.elements[5]=(-c*n+o*a)*v,e.elements[6]=f*v,e.elements[7]=(-h*n+r*l)*v,e.elements[8]=(s*n-r*a)*v,e):null},scale:function(t,e){var i=arguments.length;return 1>=i&&(e=t),this.multiply(t,0,0,0,e,0,0,0,1)},rotate:function(t){var e=r(t),i=o(t);return this.multiply(e,-i,0,i,e,0,0,0,1)},translate:function(t,e){return this.multiply(1,0,t,0,1,e,0,0,1)},skewX:function(t){var e=a(t);return this.multiply(1,e,0,0,1,0,0,0,1)},skewY:function(t){var e=a(t);return this.multiply(1,0,0,e,1,0,0,0,1)},toString:function(t){var e=[];return this.toArray(t,e),e.join(" ")},toArray:function(t,e){var i=this.elements,n=!!e,r=parseFloat(i[0].toFixed(3)),o=parseFloat(i[1].toFixed(3)),a=parseFloat(i[2].toFixed(3)),s=parseFloat(i[3].toFixed(3)),c=parseFloat(i[4].toFixed(3)),l=parseFloat(i[5].toFixed(3));if(t){var h=parseFloat(i[6].toFixed(3)),u=parseFloat(i[7].toFixed(3)),p=parseFloat(i[8].toFixed(3));return n?(e[0]=r,e[1]=s,e[2]=h,e[3]=o,e[4]=c,e[5]=u,e[6]=a,e[7]=l,void(e[8]=p)):[r,s,h,o,c,u,a,l,p]}return n?(e[0]=r,e[1]=s,e[2]=o,e[3]=c,e[4]=a,void(e[5]=l)):[r,s,o,c,a,l]},clone:function(){var e,i,n,r,o,a,s,c,l;return e=this.elements[0],i=this.elements[1],n=this.elements[2],r=this.elements[3],o=this.elements[4],a=this.elements[5],s=this.elements[6],c=this.elements[7],l=this.elements[8],new t.Matrix(e,i,n,r,o,a,s,c,l)}})}(Two,"function"==typeof require?require("underscore"):_,"function"==typeof require?require("backbone"):Backbone,"function"==typeof require?require("requestAnimationFrame"):requestAnimationFrame),function(t,e,i,n){var r=t.Utils.mod,o=t.Utils.toFixed,a={version:1.1,ns:"http://www.w3.org/2000/svg",xlink:"http://www.w3.org/1999/xlink",createElement:function(t,i){var n=t,r=document.createElementNS(this.ns,n);return"svg"===n&&(i=e.defaults(i||{},{version:this.version})),e.isEmpty(i)||a.setAttributes(r,i),r},setAttributes:function(t,e){for(var i=Object.keys(e),n=0;n<i.length;n++)t.setAttribute(i[n],e[i[n]]);return this},removeAttributes:function(t,e){for(var i in e)t.removeAttribute(i);return this},toString:function(e,i){for(var n,a=e.length,s=a-1,c="",l=0;a>l;l++){var h,u,p,d,f,v,m,g,y,b=e[l],A=i?r(l-1,a):Math.max(l-1,0),_=i?r(l+1,a):Math.min(l+1,s),E=e[A],x=e[_],w=o(b._x),F=o(b._y);switch(b._command){case t.Commands.close:h=t.Commands.close;break;case t.Commands.curve:v=E.controls&&E.controls.right||E,m=b.controls&&b.controls.left||b,E._relative?(u=o(v.x+E.x),p=o(v.y+E.y)):(u=o(v.x),p=o(v.y)),b._relative?(d=o(m.x+b.x),f=o(m.y+b.y)):(d=o(m.x),f=o(m.y)),h=(0===l?t.Commands.move:t.Commands.curve)+" "+u+" "+p+" "+d+" "+f+" "+w+" "+F;break;case t.Commands.move:n=b,h=t.Commands.move+" "+w+" "+F;break;default:h=b._command+" "+w+" "+F}l>=s&&i&&(b._command===t.Commands.curve&&(x=n,g=b.controls&&b.controls.right||b,y=x.controls&&x.controls.left||x,b._relative?(u=o(g.x+b.x),p=o(g.y+b.y)):(u=o(g.x),p=o(g.y)),x._relative?(d=o(y.x+x.x),f=o(y.y+x.y)):(d=o(y.x),f=o(y.y)),w=o(x.x),F=o(x.y),h+=" C "+u+" "+p+" "+d+" "+f+" "+w+" "+F),h+=" Z"),c+=h+" "}return c},getClip:function(t){var e=t._renderer.clip;if(!e){for(var i=t;i.parent;)i=i.parent;e=t._renderer.clip=a.createElement("clipPath"),i.defs.appendChild(e)}return e},group:{appendChild:function(t){var e=t._renderer.elem;if(e){var i=e.nodeName;!i||/(radial|linear)gradient/i.test(i)||t._clip||this.elem.appendChild(e)}},removeChild:function(t){var e=t._renderer.elem;if(e&&e.parentElement==this.elem){var i=e.nodeName;i&&(t._clip||this.elem.removeChild(e))}},orderChild:function(t){this.elem.appendChild(t._renderer.elem)},renderChild:function(t){a[t._renderer.type].render.call(t,this)},render:function(t){if(this._update(),0===this._opacity&&!this._flagOpacity)return this;this._renderer.elem||(this._renderer.elem=a.createElement("g",{id:this.id}),t.appendChild(this._renderer.elem));var e=this._matrix.manual||this._flagMatrix,i={domElement:t,elem:this._renderer.elem};e&&this._renderer.elem.setAttribute("transform","matrix("+this._matrix.toString()+")");for(var n=0;n<this.children.length;n++){var r=this.children[n];a[r._renderer.type].render.call(r,t)}return this._flagOpacity&&this._renderer.elem.setAttribute("opacity",this._opacity),this._flagAdditions&&this.additions.forEach(a.group.appendChild,i),this._flagSubtractions&&this.subtractions.forEach(a.group.removeChild,i),this._flagOrder&&this.children.forEach(a.group.orderChild,i),this._flagMask&&(this._mask?this._renderer.elem.setAttribute("clip-path","url(#"+this._mask.id+")"):this._renderer.elem.removeAttribute("clip-path")),this.flagReset()}},path:{render:function(t){if(this._update(),0===this._opacity&&!this._flagOpacity)return this;var e={},i=this._matrix.manual||this._flagMatrix;if(i&&(e.transform="matrix("+this._matrix.toString()+")"),this._flagVertices){var n=a.toString(this._vertices,this._closed);e.d=n}if(this._flagFill&&(e.fill=this._fill&&this._fill.id?"url(#"+this._fill.id+")":this._fill),this._flagStroke&&(e.stroke=this._stroke),this._flagLinewidth&&(e["stroke-width"]=this._linewidth),this._flagOpacity&&(e["stroke-opacity"]=this._opacity,e["fill-opacity"]=this._opacity),this._flagVisible&&(e.visibility=this._visible?"visible":"hidden"),this._flagCap&&(e["stroke-linecap"]=this._cap),this._flagJoin&&(e["stroke-linejoin"]=this._join),this._flagMiter&&(e["stroke-miterlimit"]=this._miter),this._renderer.elem?a.setAttributes(this._renderer.elem,e):(e.id=this.id,this._renderer.elem=a.createElement("path",e),t.appendChild(this._renderer.elem)),this._flagClip){var r=a.getClip(this),o=this._renderer.elem;this._clip?(o.removeAttribute("id"),r.setAttribute("id",this.id),r.appendChild(o)):(r.removeAttribute("id"),o.setAttribute("id",this.id),this.parent._renderer.elem.appendChild(o))}return this.flagReset()}},"linear-gradient":{render:function(t){this._update();var e={};if(this._flagEndPoints&&(e.x1=this.left._x,e.y1=this.left._y,e.x2=this.right._x,e.y2=this.right._y),this._flagSpread&&(e.spreadMethod=this._spread),this._renderer.elem?a.setAttributes(this._renderer.elem,e):(e.id=this.id,e.gradientUnits="userSpaceOnUse",this._renderer.elem=a.createElement("linearGradient",e),t.defs.appendChild(this._renderer.elem)),this._flagStops){this._renderer.elem.childNodes.length=0;for(var i=0;i<this.stops.length;i++){var n=this.stops[i],r={};n._flagOffset&&(r.offset=100*n._offset+"%"),n._flagColor&&(r["stop-color"]=n._color),n._flagOpacity&&(r["stop-opacity"]=n._opacity),n._renderer.elem?a.setAttributes(n._renderer.elem,r):n._renderer.elem=a.createElement("stop",r),this._renderer.elem.appendChild(n._renderer.elem),n.flagReset()}}return this.flagReset()}},"radial-gradient":{render:function(t){this._update();var e={};if(this._flagCenter&&(e.cx=this.center._x,e.cy=this.center._y),this._flagFocal&&(e.fx=this.focal._x,e.fy=this.focal._y),this._flagRadius&&(e.r=this._radius),this._flagSpread&&(e.spreadMethod=this._spread),this._renderer.elem?a.setAttributes(this._renderer.elem,e):(e.id=this.id,e.gradientUnits="userSpaceOnUse",this._renderer.elem=a.createElement("radialGradient",e),t.defs.appendChild(this._renderer.elem)),this._flagStops){this._renderer.elem.childNodes.length=0;for(var i=0;i<this.stops.length;i++){var n=this.stops[i],r={};n._flagOffset&&(r.offset=100*n._offset+"%"),n._flagColor&&(r["stop-color"]=n._color),n._flagOpacity&&(r["stop-opacity"]=n._opacity),n._renderer.elem?a.setAttributes(n._renderer.elem,r):n._renderer.elem=a.createElement("stop",r),this._renderer.elem.appendChild(n._renderer.elem),n.flagReset()}}return this.flagReset()}}},s=t[t.Types.svg]=function(e){this.domElement=e.domElement||a.createElement("svg"),this.scene=new t.Group,this.scene.parent=this,this.defs=a.createElement("defs"),this.domElement.appendChild(this.defs),this.domElement.defs=this.defs,this.domElement.style.overflow="hidden"};e.extend(s,{Utils:a}),e.extend(s.prototype,i.Events,{setSize:function(t,e){return this.width=t,this.height=e,a.setAttributes(this.domElement,{width:t,height:e}),this},render:function(){return a.group.render.call(this.scene,this.domElement),this}})}(Two,"function"==typeof require?require("underscore"):_,"function"==typeof require?require("backbone"):Backbone,"function"==typeof require?require("requestAnimationFrame"):requestAnimationFrame),function(t,e,i,n){var r=t.Utils.mod,o=t.Utils.toFixed,a=t.Utils.getRatio,s=function(t){return 1==t[0]&&0==t[3]&&0==t[1]&&1==t[4]&&0==t[2]&&0==t[5]},c={isHidden:/(none|transparent)/i,group:{renderChild:function(t){c[t._renderer.type].render.call(t,this.ctx,!0,this.clip)},render:function(t){this._update();var e=this._matrix.elements,i=this.parent;this._renderer.opacity=this._opacity*(i&&i._renderer?i._renderer.opacity:1);var n=s(e),r=this._mask;this._renderer.context||(this._renderer.context={}),this._renderer.context.ctx=t,n||(t.save(),t.transform(e[0],e[3],e[1],e[4],e[2],e[5])),r&&c[r._renderer.type].render.call(r,t,!0);for(var o=0;o<this.children.length;o++){var a=this.children[o];c[a._renderer.type].render.call(a,t)}return n||t.restore(),this.flagReset()}},path:{render:function(i,n,a){var l,h,u,p,d,f,v,m,g,y,b,A,_,E,x,w,F,B,q,C,S,P,M,k,L,R,I,O,T,V,N;if(this._update(),l=this._matrix.elements,h=this._stroke,u=this._linewidth,p=this._fill,d=this._opacity*this.parent._renderer.opacity,f=this._visible,v=this._cap,m=this._join,g=this._miter,y=this._closed,b=this._vertices,A=b.length,_=A-1,N=s(l),V=this._clip,!n&&(!f||V))return this;N||(i.save(),i.transform(l[0],l[3],l[1],l[4],l[2],l[5])),p&&(e.isString(p)?i.fillStyle=p:(c[p._renderer.type].render.call(p,i),i.fillStyle=p._renderer.gradient)),h&&(e.isString(h)?i.strokeStyle=h:(c[h._renderer.type].render.call(h,i),i.strokeStyle=h._renderer.gradient)),u&&(i.lineWidth=u),g&&(i.miterLimit=g),m&&(i.lineJoin=m),v&&(i.lineCap=v),e.isNumber(d)&&(i.globalAlpha=d),i.beginPath();for(var U=0;U<b.length;U++)switch(F=b[U],O=o(F._x),T=o(F._y),F._command){case t.Commands.close:i.closePath();break;case t.Commands.curve:x=y?r(U-1,A):Math.max(U-1,0),E=y?r(U+1,A):Math.min(U+1,_),w=b[x],B=b[E],k=w.controls&&w.controls.right||w,L=F.controls&&F.controls.left||F,w._relative?(P=k.x+o(w._x),M=k.y+o(w._y)):(P=o(k.x),M=o(k.y)),F._relative?(C=L.x+o(F._x),S=L.y+o(F._y)):(C=o(L.x),S=o(L.y)),i.bezierCurveTo(P,M,C,S,O,T),U>=_&&y&&(B=q,R=F.controls&&F.controls.right||F,I=B.controls&&B.controls.left||B,F._relative?(P=R.x+o(F._x),M=R.y+o(F._y)):(P=o(R.x),M=o(R.y)),B._relative?(C=I.x+o(B._x),S=I.y+o(B._y)):(C=o(I.x),S=o(I.y)),O=o(B._x),T=o(B._y),i.bezierCurveTo(P,M,C,S,O,T));break;case t.Commands.line:i.lineTo(O,T);break;case t.Commands.move:q=F,i.moveTo(O,T)}return y&&i.closePath(),V||a||(c.isHidden.test(p)||i.fill(),c.isHidden.test(h)||i.stroke()),N||i.restore(),V&&!a&&i.clip(),this.flagReset()}},"linear-gradient":{render:function(t){if(this._update(),!this._renderer.gradient||this._flagEndPoints||this._flagStops){this._renderer.gradient=t.createLinearGradient(this.left._x,this.left._y,this.right._x,this.right._y);for(var e=0;e<this.stops.length;e++){var i=this.stops[e];this._renderer.gradient.addColorStop(i._offset,i._color)}}return this.flagReset()}},"radial-gradient":{render:function(t){if(this._update(),!this._renderer.gradient||this._flagCenter||this._flagFocal||this._flagRadius||this._flagStops){this._renderer.gradient=t.createRadialGradient(this.center._x,this.center._y,0,this.focal._x,this.focal._y,this._radius);for(var e=0;e<this.stops.length;e++){var i=this.stops[e];this._renderer.gradient.addColorStop(i._offset,i._color)}}return this.flagReset()}}},l=t[t.Types.canvas]=function(e){var i=e.smoothing!==!1;this.domElement=e.domElement||document.createElement("canvas"),this.ctx=this.domElement.getContext("2d"),this.overdraw=e.overdraw||!1,this.ctx.imageSmoothingEnabled=i,this.ctx.mozImageSmoothingEnabled=i,this.ctx.oImageSmoothingEnabled=i,this.ctx.webkitImageSmoothingEnabled=i,this.ctx.imageSmoothingEnabled=i,this.scene=new t.Group,this.scene.parent=this};e.extend(l,{Utils:c}),e.extend(l.prototype,i.Events,{setSize:function(t,i,n){return this.width=t,this.height=i,this.ratio=e.isUndefined(n)?a(this.ctx):n,this.domElement.width=t*this.ratio,this.domElement.height=i*this.ratio,e.extend(this.domElement.style,{width:t+"px",height:i+"px"}),this},render:function(){var t=1===this.ratio;return t||(this.ctx.save(),this.ctx.scale(this.ratio,this.ratio)),this.overdraw||this.ctx.clearRect(0,0,this.width,this.height),c.group.render.call(this.scene,this.ctx),t||this.ctx.restore(),this}})}(Two,"function"==typeof require?require("underscore"):_,"function"==typeof require?require("backbone"):Backbone,"function"==typeof require?require("requestAnimationFrame"):requestAnimationFrame),function(t,e,i,n){var r=t.Matrix.Multiply,o=t.Utils.mod,a=[1,0,0,0,1,0,0,0,1],s=new t.Array(9),c=t.Utils.getRatio,l=(t.Utils.getComputedMatrix,t.Utils.toFixed),h={isHidden:/(none|transparent)/i,canvas:document.createElement("canvas"),matrix:new t.Matrix,uv:new t.Array([0,0,1,0,0,1,0,1,1,0,1,1]),group:{removeChild:function(t,e){if(t.children)for(var i=0;i<t.children.length;i++)h.group.removeChild(t.children[i],e);else e.deleteTexture(t._renderer.texture),delete t._renderer.texture},renderChild:function(t){h[t._renderer.type].render.call(t,this.gl,this.program)},render:function(e,i){this._update();var n=this.parent,o=n._matrix&&n._matrix.manual||n._flagMatrix,a=this._matrix.manual||this._flagMatrix;if((o||a)&&(this._renderer.matrix||(this._renderer.matrix=new t.Array(9)),this._matrix.toArray(!0,s),r(s,n._renderer.matrix,this._renderer.matrix),this._renderer.scale=this._scale*n._renderer.scale,o&&(this._flagMatrix=!0)),this._mask&&(e.enable(e.STENCIL_TEST),e.stencilFunc(e.ALWAYS,1,1),e.colorMask(!1,!1,!1,!0),e.stencilOp(e.KEEP,e.KEEP,e.INCR),h[this._mask._renderer.type].render.call(this._mask,e,i,this),e.colorMask(!0,!0,!0,!0),e.stencilFunc(e.NOTEQUAL,0,1),e.stencilOp(e.KEEP,e.KEEP,e.KEEP)),this._flagOpacity=n._flagOpacity||this._flagOpacity,this._renderer.opacity=this._opacity*(n&&n._renderer?n._renderer.opacity:1),this._flagSubtractions)for(var c=0;c<this.subtractions.length;c++)h.group.removeChild(this.subtractions[c],e);return this.children.forEach(h.group.renderChild,{gl:e,program:i}),this._mask&&(e.colorMask(!1,!1,!1,!1),e.stencilOp(e.KEEP,e.KEEP,e.DECR),h[this._mask._renderer.type].render.call(this._mask,e,i,this),e.colorMask(!0,!0,!0,!0),e.stencilFunc(e.NOTEQUAL,0,1),e.stencilOp(e.KEEP,e.KEEP,e.KEEP),e.disable(e.STENCIL_TEST)),this.flagReset()}},path:{render:function(e,i,n){if(!this._visible||!this._opacity)return this;var o=this.parent,a=o._matrix.manual||o._flagMatrix,c=this._matrix.manual||this._flagMatrix,l=this._flagVertices||this._flagFill||this._fill instanceof t.LinearGradient&&(this._fill._flagSpread||this._fill._flagStops||this._fill._flagEndPoints)||this._fill instanceof t.RadialGradient&&(this._fill._flagSpread||this._fill._flagStops||this._fill._flagRadius||this._fill._flagCenter||this._fill._flagFocal)||this._stroke instanceof t.LinearGradient&&(this._stroke._flagSpread||this._stroke._flagStops||this._stroke._flagEndPoints)||this._stroke instanceof t.RadialGradient&&(this._stroke._flagSpread||this._stroke._flagStops||this._stroke._flagRadius||this._stroke._flagCenter||this._stroke._flagFocal)||this._flagStroke||this._flagLinewidth||this._flagOpacity||o._flagOpacity||this._flagVisible||this._flagCap||this._flagJoin||this._flagMiter||this._flagScale||!this._renderer.texture;return this._update(),(a||c)&&(this._renderer.matrix||(this._renderer.matrix=new t.Array(9)),this._matrix.toArray(!0,s),r(s,o._renderer.matrix,this._renderer.matrix),this._renderer.scale=this._scale*o._renderer.scale),l&&(this._renderer.rect||(this._renderer.rect={}),this._renderer.triangles||(this._renderer.triangles=new t.Array(12)),this._renderer.opacity=this._opacity*o._renderer.opacity,h.getBoundingClientRect(this._vertices,this._linewidth,this._renderer.rect),h.getTriangles(this._renderer.rect,this._renderer.triangles),h.updateBuffer(e,this,i),h.updateTexture(e,this)),!this._clip||n?(e.bindBuffer(e.ARRAY_BUFFER,this._renderer.textureCoordsBuffer),e.vertexAttribPointer(i.textureCoords,2,e.FLOAT,!1,0,0),e.bindTexture(e.TEXTURE_2D,this._renderer.texture),e.uniformMatrix3fv(i.matrix,!1,this._renderer.matrix),e.bindBuffer(e.ARRAY_BUFFER,this._renderer.buffer),e.vertexAttribPointer(i.position,2,e.FLOAT,!1,0,0),
e.drawArrays(e.TRIANGLES,0,6),this.flagReset()):void 0}},"linear-gradient":{render:function(t,e){if(t.canvas.getContext("2d")){if(this._update(),!this._renderer.gradient||this._flagEndPoints||this._flagStops){var i=t.canvas.width/2,n=t.canvas.height/2,r=e._renderer.scale;this._renderer.gradient=t.createLinearGradient(this.left._x*r+i,this.left._y*r+n,this.right._x*r+i,this.right._y*r+n);for(var o=0;o<this.stops.length;o++){var a=this.stops[o];this._renderer.gradient.addColorStop(a._offset,a._color)}}return this.flagReset()}}},"radial-gradient":{render:function(t,e){if(t.canvas.getContext("2d")){if(this._update(),!this._renderer.gradient||this._flagCenter||this._flagFocal||this._flagRadius||this._flagStops){var i=t.canvas.width/2,n=t.canvas.height/2;this._renderer.gradient=t.createRadialGradient(this.center._x+i,this.center._y+n,0,this.focal._x+i,this.focal._y+n,this._radius*e._renderer.scale);for(var r=0;r<this.stops.length;r++){var o=this.stops[r];this._renderer.gradient.addColorStop(o._offset,o._color)}}return this.flagReset()}}},getBoundingClientRect:function(t,i,n){var r,o,a=1/0,s=-(1/0),c=1/0,l=-(1/0);t.forEach(function(t){var e,i,n,r,o,h,u=t.x,p=t.y,d=t.controls;c=Math.min(p,c),a=Math.min(u,a),s=Math.max(u,s),l=Math.max(p,l),t.controls&&(o=d.left,h=d.right,o&&h&&(e=t._relative?o.x+u:o.x,i=t._relative?o.y+p:o.y,n=t._relative?h.x+u:h.x,r=t._relative?h.y+p:h.y,e&&i&&n&&r&&(c=Math.min(i,r,c),a=Math.min(e,n,a),s=Math.max(e,n,s),l=Math.max(i,r,l))))}),e.isNumber(i)&&(c-=i,a-=i,s+=i,l+=i),r=s-a,o=l-c,n.top=c,n.left=a,n.right=s,n.bottom=l,n.width=r,n.height=o,n.centroid||(n.centroid={}),n.centroid.x=-a,n.centroid.y=-c},getTriangles:function(t,e){var i=t.top,n=t.left,r=t.right,o=t.bottom;e[0]=n,e[1]=i,e[2]=r,e[3]=i,e[4]=n,e[5]=o,e[6]=n,e[7]=o,e[8]=r,e[9]=i,e[10]=r,e[11]=o},updateCanvas:function(i){var n,r,a,s,c,u,p,d,f,v,m,g,y,A,_=i._vertices,E=this.canvas,x=this.ctx,w=i._renderer.scale,F=i._stroke,B=i._linewidth*w,q=i._fill,C=i._renderer.opacity||i._opacity,S=i._cap,P=i._join,M=i._miter,k=i._closed,L=_.length,R=L-1;E.width=Math.max(Math.ceil(i._renderer.rect.width*w),1),E.height=Math.max(Math.ceil(i._renderer.rect.height*w),1);var I=i._renderer.rect.centroid,O=I.x*w,T=I.y*w;x.clearRect(0,0,E.width,E.height),q&&(e.isString(q)?x.fillStyle=q:(h[q._renderer.type].render.call(q,x,i),x.fillStyle=q._renderer.gradient)),F&&(e.isString(F)?x.strokeStyle=F:(h[F._renderer.type].render.call(F,x,i),x.strokeStyle=F._renderer.gradient)),B&&(x.lineWidth=B),M&&(x.miterLimit=M),P&&(x.lineJoin=P),S&&(x.lineCap=S),e.isNumber(C)&&(x.globalAlpha=C);var V;x.beginPath();for(var N=0;N<_.length;N++)switch(b=_[N],y=l(b._x*w+O),A=l(b._y*w+T),b._command){case t.Commands.close:x.closePath();break;case t.Commands.curve:r=k?o(N-1,L):Math.max(N-1,0),n=k?o(N+1,L):Math.min(N+1,R),a=_[r],s=_[n],f=a.controls&&a.controls.right||a,v=b.controls&&b.controls.left||b,a._relative?(p=l((f.x+a._x)*w+O),d=l((f.y+a._y)*w+T)):(p=l(f.x*w+O),d=l(f.y*w+T)),b._relative?(c=l((v.x+b._x)*w+O),u=l((v.y+b._y)*w+T)):(c=l(v.x*w+O),u=l(v.y*w+T)),x.bezierCurveTo(p,d,c,u,y,A),N>=R&&k&&(s=V,m=b.controls&&b.controls.right||b,g=s.controls&&s.controls.left||s,b._relative?(p=l((m.x+b._x)*w+O),d=l((m.y+b._y)*w+T)):(p=l(m.x*w+O),d=l(m.y*w+T)),s._relative?(c=l((g.x+s._x)*w+O),u=l((g.y+s._y)*w+T)):(c=l(g.x*w+O),u=l(g.y*w+T)),y=l(s._x*w+O),A=l(s._y*w+T),x.bezierCurveTo(p,d,c,u,y,A));break;case t.Commands.line:x.lineTo(y,A);break;case t.Commands.move:V=b,x.moveTo(y,A)}k&&x.closePath(),h.isHidden.test(q)||x.fill(),h.isHidden.test(F)||x.stroke()},updateTexture:function(t,e){this.updateCanvas(e),e._renderer.texture&&t.deleteTexture(e._renderer.texture),t.bindBuffer(t.ARRAY_BUFFER,e._renderer.textureCoordsBuffer),e._renderer.texture=t.createTexture(),t.bindTexture(t.TEXTURE_2D,e._renderer.texture),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),this.canvas.width<=0||this.canvas.height<=0||t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,this.canvas)},updateBuffer:function(t,i,n){e.isObject(i._renderer.buffer)&&t.deleteBuffer(i._renderer.buffer),i._renderer.buffer=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,i._renderer.buffer),t.enableVertexAttribArray(n.position),t.bufferData(t.ARRAY_BUFFER,i._renderer.triangles,t.STATIC_DRAW),e.isObject(i._renderer.textureCoordsBuffer)&&t.deleteBuffer(i._renderer.textureCoordsBuffer),i._renderer.textureCoordsBuffer=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,i._renderer.textureCoordsBuffer),t.enableVertexAttribArray(n.textureCoords),t.bufferData(t.ARRAY_BUFFER,this.uv,t.STATIC_DRAW)},program:{create:function(i,n){var r,o,a;if(r=i.createProgram(),e.each(n,function(t){i.attachShader(r,t)}),i.linkProgram(r),o=i.getProgramParameter(r,i.LINK_STATUS),!o)throw a=i.getProgramInfoLog(r),i.deleteProgram(r),new t.Utils.Error("unable to link program: "+a);return r}},shaders:{create:function(e,i,n){var r,o,a;if(r=e.createShader(e[n]),e.shaderSource(r,i),e.compileShader(r),o=e.getShaderParameter(r,e.COMPILE_STATUS),!o)throw a=e.getShaderInfoLog(r),e.deleteShader(r),new t.Utils.Error("unable to compile shader "+r+": "+a);return r},types:{vertex:"VERTEX_SHADER",fragment:"FRAGMENT_SHADER"},vertex:["attribute vec2 a_position;","attribute vec2 a_textureCoords;","","uniform mat3 u_matrix;","uniform vec2 u_resolution;","","varying vec2 v_textureCoords;","","void main() {","   vec2 projected = (u_matrix * vec3(a_position, 1.0)).xy;","   vec2 normal = projected / u_resolution;","   vec2 clipspace = (normal * 2.0) - 1.0;","","   gl_Position = vec4(clipspace * vec2(1.0, -1.0), 0.0, 1.0);","   v_textureCoords = a_textureCoords;","}"].join("\n"),fragment:["precision mediump float;","","uniform sampler2D u_image;","varying vec2 v_textureCoords;","","void main() {","  gl_FragColor = texture2D(u_image, v_textureCoords);","}"].join("\n")}};h.ctx=h.canvas.getContext("2d");var u=t[t.Types.webgl]=function(i){var n,r,o,s;if(this.domElement=i.domElement||document.createElement("canvas"),this.scene=new t.Group,this.scene.parent=this,this._renderer={matrix:new t.Array(a),scale:1,opacity:1},this._flagMatrix=!0,n=e.defaults(i||{},{antialias:!1,alpha:!0,premultipliedAlpha:!0,stencil:!0,preserveDrawingBuffer:!0,overdraw:!1}),this.overdraw=n.overdraw,r=this.ctx=this.domElement.getContext("webgl",n)||this.domElement.getContext("experimental-webgl",n),!this.ctx)throw new t.Utils.Error("unable to create a webgl context. Try using another renderer.");o=h.shaders.create(r,h.shaders.vertex,h.shaders.types.vertex),s=h.shaders.create(r,h.shaders.fragment,h.shaders.types.fragment),this.program=h.program.create(r,[o,s]),r.useProgram(this.program),this.program.position=r.getAttribLocation(this.program,"a_position"),this.program.matrix=r.getUniformLocation(this.program,"u_matrix"),this.program.textureCoords=r.getAttribLocation(this.program,"a_textureCoords"),r.disable(r.DEPTH_TEST),r.enable(r.BLEND),r.blendEquationSeparate(r.FUNC_ADD,r.FUNC_ADD),r.blendFuncSeparate(r.SRC_ALPHA,r.ONE_MINUS_SRC_ALPHA,r.ONE,r.ONE_MINUS_SRC_ALPHA)};e.extend(u.prototype,i.Events,{setSize:function(t,i,n){this.width=t,this.height=i,this.ratio=e.isUndefined(n)?c(this.ctx):n,this.domElement.width=t*this.ratio,this.domElement.height=i*this.ratio,e.extend(this.domElement.style,{width:t+"px",height:i+"px"}),t*=this.ratio,i*=this.ratio,this._renderer.matrix[0]=this._renderer.matrix[4]=this._renderer.scale=this.ratio,this._flagMatrix=!0,this.ctx.viewport(0,0,t,i);var r=this.ctx.getUniformLocation(this.program,"u_resolution");return this.ctx.uniform2f(r,t,i),this},render:function(){var t=this.ctx;return this.overdraw||t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT),h.group.render.call(this.scene,t,this.program),this._flagMatrix=!1,this}})}(Two,"function"==typeof require?require("underscore"):_,"function"==typeof require?require("backbone"):Backbone,"function"==typeof require?require("requestAnimationFrame"):requestAnimationFrame),function(t,e,i,n){var r=t.Shape=function(){this._renderer={},this.id=t.Identifier+t.uniqueId(),this.classList=[],this._matrix=new t.Matrix,this.translation=new t.Vector,this.translation.bind(t.Events.change,e.bind(r.FlagMatrix,this)),this.rotation=0,this.scale=1};e.extend(r,i.Events,{FlagMatrix:function(){this._flagMatrix=!0},MakeObservable:function(t){Object.defineProperty(t,"rotation",{get:function(){return this._rotation},set:function(t){this._rotation=t,this._flagMatrix=!0}}),Object.defineProperty(t,"scale",{get:function(){return this._scale},set:function(t){this._scale=t,this._flagMatrix=!0,this._flagScale=!0}})}}),e.extend(r.prototype,{_flagMatrix:!0,_rotation:0,_scale:1,addTo:function(t){return t.add(this),this},clone:function(){var t=new r;return t.translation.copy(this.translation),t.rotation=this.rotation,t.scale=this.scale,e.each(r.Properties,function(e){t[e]=this[e]},this),t._update()},_update:function(t){return!this._matrix.manual&&this._flagMatrix&&this._matrix.identity().translate(this.translation.x,this.translation.y).scale(this.scale).rotate(this.rotation),t&&this.parent&&this.parent._update&&this.parent._update(),this},flagReset:function(){return this._flagMatrix=this._flagScale=!1,this}}),r.MakeObservable(r.prototype)}(Two,"function"==typeof require?require("underscore"):_,"function"==typeof require?require("backbone"):Backbone,"function"==typeof require?require("requestAnimationFrame"):requestAnimationFrame),function(t,e,i,n){function r(e,i,n){var r,o,a,s,c,l,h,u,p=i.controls&&i.controls.right,d=e.controls&&e.controls.left;return r=i.x,c=i.y,o=(p||i).x,l=(p||i).y,a=(d||e).x,h=(d||e).y,s=e.x,u=e.y,p&&i._relative&&(o+=i.x,l+=i.y),d&&e._relative&&(a+=e.x,h+=e.y),t.Utils.getCurveLength(r,c,o,l,a,h,s,u,n)}function o(e,i,n){var r,o,a,s,c,l,h,u,p=i.controls&&i.controls.right,d=e.controls&&e.controls.left;return r=i.x,c=i.y,o=(p||i).x,l=(p||i).y,a=(d||e).x,h=(d||e).y,s=e.x,u=e.y,p&&i._relative&&(o+=i.x,l+=i.y),d&&e._relative&&(a+=e.x,h+=e.y),t.Utils.subdivide(r,c,o,l,a,h,s,u,n)}var a=Math.min,s=Math.max,c=Math.round,l=t.Utils.getComputedMatrix,h={};e.each(t.Commands,function(t,e){h[e]=new RegExp(t)});var u=t.Path=function(e,i,n,r){t.Shape.call(this),this._renderer.type="path",this._closed=!!i,this._curved=!!n,this.beginning=0,this.ending=1,this.fill="#fff",this.stroke="#000",this.linewidth=1,this.opacity=1,this.visible=!0,this.cap="butt",this.join="miter",this.miter=4,this._vertices=[],this.vertices=e,this.automatic=!r};e.extend(u,{Properties:["fill","stroke","linewidth","opacity","visible","cap","join","miter","closed","curved","automatic","beginning","ending"],FlagVertices:function(){this._flagVertices=!0,this._flagLength=!0},MakeObservable:function(i){t.Shape.MakeObservable(i),e.each(u.Properties.slice(0,8),function(t){var e="_"+t,n="_flag"+t.charAt(0).toUpperCase()+t.slice(1);Object.defineProperty(i,t,{get:function(){return this[e]},set:function(t){this[e]=t,this[n]=!0}})}),Object.defineProperty(i,"length",{get:function(){return this._flagLength&&this._updateLength(),this._length}}),Object.defineProperty(i,"closed",{get:function(){return this._closed},set:function(t){this._closed=!!t,this._flagVertices=!0}}),Object.defineProperty(i,"curved",{get:function(){return this._curved},set:function(t){this._curved=!!t,this._flagVertices=!0}}),Object.defineProperty(i,"automatic",{get:function(){return this._automatic},set:function(t){if(t!==this._automatic){this._automatic=!!t;var i=this._automatic?"ignore":"listen";e.each(this.vertices,function(t){t[i]()})}}}),Object.defineProperty(i,"beginning",{get:function(){return this._beginning},set:function(t){this._beginning=a(s(t,0),this._ending),this._flagVertices=!0}}),Object.defineProperty(i,"ending",{get:function(){return this._ending},set:function(t){this._ending=a(s(t,this._beginning),1),this._flagVertices=!0}}),Object.defineProperty(i,"vertices",{get:function(){return this._collection},set:function(i){var n=e.bind(u.FlagVertices,this),r=e.bind(function(e){for(var i=e.length;i--;)e[i].bind(t.Events.change,n);n()},this),o=e.bind(function(i){e.each(i,function(e){e.unbind(t.Events.change,n)},this),n()},this);this._collection&&this._collection.unbind(),this._collection=new t.Utils.Collection((i||[]).slice(0)),this._collection.bind(t.Events.insert,r),this._collection.bind(t.Events.remove,o),r(this._collection)}}),Object.defineProperty(i,"clip",{get:function(){return this._clip},set:function(t){this._clip=t,this._flagClip=!0}})}}),e.extend(u.prototype,t.Shape.prototype,{_flagVertices:!0,_flagLength:!0,_flagFill:!0,_flagStroke:!0,_flagLinewidth:!0,_flagOpacity:!0,_flagVisible:!0,_flagCap:!0,_flagJoin:!0,_flagMiter:!0,_flagClip:!1,_length:0,_fill:"#fff",_stroke:"#000",_linewidth:1,_opacity:1,_visible:!0,_cap:"round",_join:"round",_miter:4,_closed:!0,_curved:!1,_automatic:!0,_beginning:0,_ending:1,_clip:!1,clone:function(i){i=i||this.parent;var n=e.map(this.vertices,function(t){return t.clone()}),r=new u(n,this.closed,this.curved,!this.automatic);return e.each(t.Path.Properties,function(t){r[t]=this[t]},this),r.translation.copy(this.translation),r.rotation=this.rotation,r.scale=this.scale,i.add(r),r},toObject:function(){var i={vertices:e.map(this.vertices,function(t){return t.toObject()})};return e.each(t.Shape.Properties,function(t){i[t]=this[t]},this),i.translation=this.translation.toObject,i.rotation=this.rotation,i.scale=this.scale,i},noFill:function(){return this.fill="transparent",this},noStroke:function(){return this.stroke="transparent",this},corner:function(){var t=this.getBoundingClientRect(!0);return t.centroid={x:t.left+t.width/2,y:t.top+t.height/2},e.each(this.vertices,function(e){e.addSelf(t.centroid)}),this},center:function(){var t=this.getBoundingClientRect(!0);return t.centroid={x:t.left+t.width/2,y:t.top+t.height/2},e.each(this.vertices,function(e){e.subSelf(t.centroid)}),this},remove:function(){return this.parent?(this.parent.remove(this),this):this},getBoundingClientRect:function(t){var e,i,n,r,o,c,h,u=1/0,p=-(1/0),d=1/0,f=-(1/0);for(this._update(!0),e=t?this._matrix:l(this),i=this.linewidth/2,n=this._vertices.length,c=0;n>c;c++)h=this._vertices[c],r=h.x,o=h.y,h=e.multiply(r,o,1),d=a(h.y-i,d),u=a(h.x-i,u),p=s(h.x+i,p),f=s(h.y+i,f);return{top:d,left:u,right:p,bottom:f,width:p-u,height:f-d}},getPointAt:function(i,n){for(var r,o,a,s,c,l,h,u,p,d,f,v,m=this.length*Math.min(Math.max(i,0),1),g=this.vertices.length,y=g-1,b=null,A=null,_=0,E=this._lengths.length,x=0;E>_;_++){if(x+this._lengths[_]>m){b=this.vertices[this.closed?t.Utils.mod(_,g):_],A=this.vertices[Math.min(Math.max(_-1,0),y)],m-=x,i=m/this._lengths[_];break}x+=this._lengths[_]}return e.isNull(b)||e.isNull(A)?null:(v=A.controls&&A.controls.right,f=b.controls&&b.controls.left,o=A.x,h=A.y,a=(v||A).x,u=(v||A).y,s=(f||b).x,p=(f||b).y,c=b.x,d=b.y,v&&A._relative&&(a+=A.x,u+=A.y),f&&b._relative&&(s+=b.x,p+=b.y),r=t.Utils.getPointOnCubicBezier(i,o,a,s,c),l=t.Utils.getPointOnCubicBezier(i,h,u,p,d),e.isObject(n)?(n.x=r,n.y=l,n):new t.Vector(r,l))},plot:function(){if(this.curved)return t.Utils.getCurveFromPoints(this._vertices,this.closed),this;for(var e=0;e<this._vertices.length;e++)this._vertices[e]._command=0===e?t.Commands.move:t.Commands.line;return this},subdivide:function(i){this._update();var n=this.vertices.length-1,r=this.vertices[n],a=this._closed||this.vertices[n]._command===t.Commands.close,s=[];return e.each(this.vertices,function(c,l){if(0>=l&&!a)return void(r=c);if(c.command===t.Commands.move)return s.push(new t.Anchor(r.x,r.y)),l>0&&(s[s.length-1].command=t.Commands.line),void(r=c);var h=o(c,r,i);s=s.concat(h),e.each(h,function(e,i){0>=i&&r.command===t.Commands.move?e.command=t.Commands.move:e.command=t.Commands.line}),l>=n&&(this._closed&&this._automatic?(r=c,h=o(c,r,i),s=s.concat(h),e.each(h,function(e,i){0>=i&&r.command===t.Commands.move?e.command=t.Commands.move:e.command=t.Commands.line})):a&&s.push(new t.Anchor(c.x,c.y)),s[s.length-1].command=a?t.Commands.close:t.Commands.line),r=c},this),this._automatic=!1,this._curved=!1,this.vertices=s,this},_updateLength:function(i){this._update();var n=this.vertices.length-1,o=this.vertices[n],a=this._closed||this.vertices[n]._command===t.Commands.close,s=0;return e.isUndefined(this._lengths)&&(this._lengths=[]),e.each(this.vertices,function(e,c){return 0>=c&&!a||e.command===t.Commands.move?(o=e,void(this._lengths[c]=0)):(this._lengths[c]=r(e,o,i),s+=this._lengths[c],c>=n&&a&&(o=e,this._lengths[c+1]=r(e,o,i),s+=this._lengths[c+1]),void(o=e))},this),this._length=s,this},_update:function(){if(this._flagVertices){var e,i=this.vertices.length,n=i-1,r=c(this._beginning*n),o=c(this._ending*n);this._vertices.length=0;for(var a=r;o+1>a;a++)e=this.vertices[a],this._vertices.push(e);this._automatic&&this.plot()}return t.Shape.prototype._update.apply(this,arguments),this},flagReset:function(){return this._flagVertices=this._flagFill=this._flagStroke=this._flagLinewidth=this._flagOpacity=this._flagVisible=this._flagCap=this._flagJoin=this._flagMiter=this._flagClip=!1,t.Shape.prototype.flagReset.call(this),this}}),u.MakeObservable(u.prototype)}(Two,"function"==typeof require?require("underscore"):_,"function"==typeof require?require("backbone"):Backbone,"function"==typeof require?require("requestAnimationFrame"):requestAnimationFrame),function(t,e,i,n){var r=t.Path,o=t.Line=function(e,i,n,o){var a=n-e,s=o-i,c=a/2,l=s/2;r.call(this,[new t.Anchor(-c,-l),new t.Anchor(c,l)]),this.translation.set(e+c,i+l)};e.extend(o.prototype,r.prototype),r.MakeObservable(o.prototype)}(Two,"function"==typeof require?require("underscore"):_,"function"==typeof require?require("backbone"):Backbone,"function"==typeof require?require("requestAnimationFrame"):requestAnimationFrame),function(t,e,i,n){var r=t.Path,o=t.Rectangle=function(e,i,n,o){var a=n/2,s=o/2;r.call(this,[new t.Anchor(-a,-s),new t.Anchor(a,-s),new t.Anchor(a,s),new t.Anchor(-a,s)],!0),this.translation.set(e,i)};e.extend(o.prototype,r.prototype),r.MakeObservable(o.prototype)}(Two,"function"==typeof require?require("underscore"):_,"function"==typeof require?require("backbone"):Backbone,"function"==typeof require?require("requestAnimationFrame"):requestAnimationFrame),function(t,e,i,n){var r=t.Path,o=2*Math.PI,a=Math.cos,s=Math.sin,c=t.Ellipse=function(i,n,c,l){e.isNumber(l)||(l=c);var h=t.Resolution,u=e.map(e.range(h),function(e){var i=e/h,n=i*o,r=c*a(n),u=l*s(n);return new t.Anchor(r,u)},this);r.call(this,u,!0,!0),this.translation.set(i,n)};e.extend(c.prototype,r.prototype),r.MakeObservable(c.prototype)}(Two,"function"==typeof require?require("underscore"):_,"function"==typeof require?require("backbone"):Backbone,"function"==typeof require?require("requestAnimationFrame"):requestAnimationFrame),function(t,e,i,n){var r=t.Path,o=2*Math.PI,a=Math.cos,s=Math.sin,c=t.Polygon=function(i,n,c,l){l=Math.max(l||0,3);var h=e.map(e.range(l),function(e){var i=(e+.5)/l,n=o*i+Math.PI/2,r=c*a(n),h=c*s(n);return new t.Anchor(r,h)});r.call(this,h,!0),this.translation.set(i,n)};e.extend(c.prototype,r.prototype),r.MakeObservable(c.prototype)}(Two,"function"==typeof require?require("underscore"):_,"function"==typeof require?require("backbone"):Backbone,"function"==typeof require?require("requestAnimationFrame"):requestAnimationFrame),function(t,e,i,n){var r=t.Path,o=Math.PI,a=(2*Math.PI,Math.PI/2),s=Math.cos,c=Math.sin,l=(Math.abs,t.ArcSegment=function(e,i,n,l,h,u,p){h>u&&(u+=2*Math.PI),p=p||8;var d=u-h,f=d/p,v=t.Commands.move,m=[];m.push(new t.Anchor(Math.sin(0)*l,Math.cos(0)*l,0,0,0,0,v));var g,y,b,A,_,E,x;v=t.Commands.curve;for(var w=0;p+1>w;w++)g=w*f,y=c(g)*l,b=s(g)*l,A=c(g-a)*(f/o)*l,_=s(g-a)*(f/o)*l,E=c(g+a)*(f/o)*l,x=s(g+a)*(f/o)*l,0===w&&(A=_=0),w===p&&(E=x=0),m.push(new t.Anchor(y,b,A,_,E,x,v));for(var F=0;p+1>F;F++)g=d-f*F,y=c(g)*n,b=s(g)*n,A=c(g-1.5*o)*(f/o)*n,_=s(g-1.5*o)*(f/o)*n,E=c(g+1.5*o)*(f/o)*n,x=s(g+1.5*o)*(f/o)*n,0===F&&(A=_=0),F===p&&(E=x=0),m.push(new t.Anchor(y,b,A,_,E,x,v));v=t.Commands.close,m.push(new t.Anchor(Math.sin(0)*l,Math.cos(0)*l,0,0,0,0,v)),r.call(this,m,!0,!1,!0),this.rotation=h,this.translation.set(e,i)});e.extend(l.prototype,r.prototype),r.MakeObservable(l.prototype)}(Two,"function"==typeof require?require("underscore"):_,"function"==typeof require?require("backbone"):Backbone,"function"==typeof require?require("requestAnimationFrame"):requestAnimationFrame),function(t,e,i,n){var r=t.Path,o=Math.PI,a=(2*Math.PI,Math.cos),s=Math.sin,c=(Math.abs,t.SineRing=function(e,i,n,c,l,h){var u=2*c+1,p=Math.PI/c,d=o*n/c/2;h=h||1;var f,v,m,g,y,b,A=[],_=o;A.push(new t.Anchor(s(_)*(n+l/2),a(_)*(n+l/2),0,0,0,0,t.Commands.move));for(var E=0;u>E;E++)_=p*E+o,E%2===0?(f=Math.sin(_)*(n+l/2),v=Math.cos(_)*(n+l/2)):(f=Math.sin(_)*(n-l/2),v=Math.cos(_)*(n-l/2)),m=Math.sin(_-Math.PI/2)*d*h,g=Math.cos(_-Math.PI/2)*d*h,y=Math.sin(_+Math.PI/2)*d*h,b=Math.cos(_+Math.PI/2)*d*h,0===E&&(m=g=0),E===u-1&&(y=b=0),A.push(new t.Anchor(f,v,m,g,y,b,t.Commands.curve));r.call(this,A,!0,!1,!0),this.translation.set(e,i)});e.extend(c.prototype,r.prototype),r.MakeObservable(c.prototype)}(Two,"function"==typeof require?require("underscore"):_,"function"==typeof require?require("backbone"):Backbone,"function"==typeof require?require("requestAnimationFrame"):requestAnimationFrame),function(t,e,i,n){var r=t.Path,o=2*Math.PI,a=Math.cos,s=Math.sin,c=t.Star=function(i,n,c,l,h){e.isNumber(l)||(l=c/2),(!e.isNumber(h)||0>=h)&&(h=5);var u=2*h,p=e.map(e.range(u),function(e){var i=(e-.5)/u,n=i*o,r=e%2?l:c,h=r*a(n),p=r*s(n);return new t.Anchor(h,p)});r.call(this,p,!0),this.translation.set(i,n)};e.extend(c.prototype,r.prototype),r.MakeObservable(c.prototype)}(Two,"function"==typeof require?require("underscore"):_,"function"==typeof require?require("backbone"):Backbone,"function"==typeof require?require("requestAnimationFrame"):requestAnimationFrame),function(t,e,i,n){function r(i,n,r,a,s){var c=0,l=0,h=t.Resolution,u=(i[i.length-1],new t.Anchor(n,r),0>n?-a:a),p=0>r?-a:a;switch(s){case 1:c=-Math.PI/2,l=0;break;case 2:c=-Math.PI,l=-Math.PI/2;break;case 3:c=1.5*-Math.PI,l=-Math.PI;break;case 4:c=0,l=Math.PI/2}var d=e.map(e.range(h),function(e){var i=o(h-e,0,h,c,l),s=a*Math.cos(i)+n-u,d=a*Math.sin(i)+r-p,f=new t.Anchor(s,d);return f}).reverse();return i.concat(d)}function o(t,e,i,n,r){return n+(r-n)*((t-e)/(i-e))}var a=t.Path,s=t.RoundedRectangle=function(i,n,o,s,c){var l,h,u=o/2,p=s/2;e.isNumber(c)||(c=Math.floor(Math.min(o,s)/12));var d=[new t.Anchor(-u+c,-p),new t.Anchor(u-c,-p)];l=u,h=-p,d=r(d,l,h,c,1),d.push(new t.Anchor(u,p-c)),l=u,h=p,d=r(d,l,h,c,4),d.push(new t.Anchor(-u+c,p)),l=-u,h=p,d=r(d,l,h,c,3),d.push(new t.Anchor(-u,-p+c)),l=-u,h=-p,d=r(d,l,h,c,2),d.pop(),a.call(this,d,!0),this.translation.set(i,n)};e.extend(s.prototype,a.prototype),a.MakeObservable(s.prototype)}(Two,"function"==typeof require?require("underscore"):_,"function"==typeof require?require("backbone"):Backbone,"function"==typeof require?require("requestAnimationFrame"):requestAnimationFrame),function(t,e,i,n){var r=t.Stop=function(t,i,n){this._renderer={},this.offset=e.isNumber(t)?t:r.Index<=0?0:1,this.opacity=e.isNumber(n)?n:1,this.color=e.isString(i)?i:r.Index<=0?"#fff":"#000",r.Index=(r.Index+1)%2};e.extend(r,{Index:0,Properties:["offset","opacity","color"],MakeObservable:function(i){e.each(r.Properties,function(e){var n="_"+e,r="_flag"+e.charAt(0).toUpperCase()+e.slice(1);Object.defineProperty(i,e,{get:function(){return this[n]},set:function(e){this[n]=e,this[r]=!0,this.trigger(t.Events.change)}})})}}),e.extend(r.prototype,i.Events,{clone:function(){var t=new r;return e.each(r.Properties,function(e){t[e]=this[e]},this),t},toObject:function(){var t={};return e.each(r.Properties,function(e){t[e]=this[e]},this),t},flagReset:function(){return this._flagOffset=this._flagColor=this._flagOpacity=!1,this}}),r.MakeObservable(r.prototype);var o=t.Gradient=function(e){t.Shape.call(this),this._renderer.type="gradient",this.spread="pad",this.stops=e};e.extend(o,{Stop:r,Properties:["spread"],MakeObservable:function(i){t.Shape.MakeObservable(i),e.each(o.Properties,t.Utils.defineProperty,i),Object.defineProperty(i,"stops",{get:function(){return this._stops},set:function(i){var n=e.bind(o.FlagStops,this),r=e.bind(function(e){for(var i=e.length;i--;)e[i].bind(t.Events.change,n);n()},this),a=e.bind(function(i){e.each(i,function(e){e.unbind(t.Events.change,n)},this),n()},this);this._stops&&this._stops.unbind(),this._stops=new t.Utils.Collection((i||[]).slice(0)),this._stops.bind(t.Events.insert,r),this._stops.bind(t.Events.remove,a),r(this._stops)}})},FlagStops:function(){this._flagStops=!0}}),e.extend(o.prototype,t.Shape.prototype,{clone:function(i){i=i||this.parent;var n=e.map(this.stops,function(t){return t.clone()}),r=new o(n);return e.each(t.Gradient.Properties,function(t){r[t]=this[t]},this),r.translation.copy(this.translation),r.rotation=this.rotation,r.scale=this.scale,i.add(r),r},toObject:function(){var t={stops:e.map(this.stops,function(t){return t.toObject()})};return e.each(o.Properties,function(e){t[e]=this[e]},this),t},flagReset:function(){return this._flagSpread=this._flagStops=!1,t.Shape.prototype.flagReset.call(this),this}}),o.MakeObservable(o.prototype)}(Two,"function"==typeof require?require("underscore"):_,"function"==typeof require?require("backbone"):Backbone,"function"==typeof require?require("requestAnimationFrame"):requestAnimationFrame),function(t,e,i,n){var r=t.LinearGradient=function(i,n,o,a,s){t.Gradient.call(this,s),this._renderer.type="linear-gradient";var c=e.bind(r.FlagEndPoints,this);this.left=(new t.Vector).bind(t.Events.change,c),this.right=(new t.Vector).bind(t.Events.change,c),e.isNumber(i)&&(this.left.x=i),e.isNumber(n)&&(this.left.y=n),e.isNumber(o)&&(this.right.x=o),e.isNumber(a)&&(this.right.y=a)};e.extend(r,{Stop:t.Gradient.Stop,MakeObservable:function(e){t.Gradient.MakeObservable(e)},FlagEndPoints:function(){this._flagEndPoints=!0}}),e.extend(r.prototype,t.Gradient.prototype,{_flagEndPoints:!1,clone:function(i){i=i||this.parent;var n=e.map(this.stops,function(t){return t.clone()}),o=new r(this.left._x,this.left._y,this.right._x,this.right._y,n);return e.each(t.Gradient.Properties,function(t){o[t]=this[t]},this),i.add(o),o},toObject:function(){var e=t.Gradient.prototype.toObject.call(this);return e.left=this.left.toObject(),e.right=this.right.toObject(),e},flagReset:function(){return this._flagEndPoints=!1,t.Gradient.prototype.flagReset.call(this),this}}),r.MakeObservable(r.prototype)}(Two,"function"==typeof require?require("underscore"):_,"function"==typeof require?require("backbone"):Backbone,"function"==typeof require?require("requestAnimationFrame"):requestAnimationFrame),function(t,e,i,n){var r=t.RadialGradient=function(i,n,r,o,a,s){t.Gradient.call(this,o),this._renderer.type="radial-gradient",this.center=(new t.Vector).bind(t.Events.change,e.bind(function(){this._flagCenter=!0},this)),this.radius=e.isNumber(r)?r:20,this.focal=(new t.Vector).bind(t.Events.change,e.bind(function(){this._flagFocal=!0},this)),e.isNumber(i)&&(this.center.x=i),e.isNumber(n)&&(this.center.y=n),this.focal.copy(this.center),e.isNumber(a)&&(this.focal.x=a),e.isNumber(s)&&(this.focal.y=s)};e.extend(r,{Stop:t.Gradient.Stop,Properties:["radius"],MakeObservable:function(i){t.Gradient.MakeObservable(i),e.each(r.Properties,t.Utils.defineProperty,i)}}),e.extend(r.prototype,t.Gradient.prototype,{_flagEndPoints:!1,clone:function(i){i=i||this.parent;var n=e.map(this.stops,function(t){return t.clone()}),o=new r(this.center._x,this.center._y,this._radius,n,this.focal._x,this.focal._y);return e.each(t.Gradient.Properties.concat(r.Properties),function(t){o[t]=this[t]},this),i.add(o),o},toObject:function(){var i=t.Gradient.prototype.toObject.call(this);return e.each(r.Properties,function(t){i[t]=this[t]},this),i.center=this.center.toObject(),i.focal=this.focal.toObject(),i},flagReset:function(){return this._flagRadius=this._flagCenter=this._flagFocal=!1,t.Gradient.prototype.flagReset.call(this),this}}),r.MakeObservable(r.prototype)}(Two,"function"==typeof require?require("underscore"):_,"function"==typeof require?require("backbone"):Backbone,"function"==typeof require?require("requestAnimationFrame"):requestAnimationFrame),function(t,e,i,n){function r(t,i){var n,r=t.parent;return r&&r.children.ids[t.id]&&(n=e.indexOf(r.children,t),r.children.splice(n,1),n=e.indexOf(r.additions,t),n>=0?r.additions.splice(n,1):(r.subtractions.push(t),r._flagSubtractions=!0)),i?(t.parent=i,this.additions.push(t),void(this._flagAdditions=!0)):(n=e.indexOf(this.additions,t),n>=0?this.additions.splice(n,1):(this.subtractions.push(t),this._flagSubtractions=!0),void delete t.parent)}var o=Math.min,a=Math.max,s=function(){t.Utils.Collection.apply(this,arguments),Object.defineProperty(this,"_events",{value:{},enumerable:!1}),this.ids={},this.on(t.Events.insert,this.attach),this.on(t.Events.remove,this.detach),s.prototype.attach.apply(this,arguments)};s.prototype=new t.Utils.Collection,s.constructor=s,e.extend(s.prototype,{attach:function(t){for(var e=0;e<t.length;e++)this.ids[t[e].id]=t[e];return this},detach:function(t){for(var e=0;e<t.length;e++)delete this.ids[t[e].id];return this}});var c=t.Group=function(){t.Shape.call(this,!0),this._renderer.type="group",this.additions=[],this.subtractions=[],this._children=[],this.children=arguments};e.extend(c,{Children:s,InsertChildren:function(t){for(var e=0;e<t.length;e++)r.call(this,t[e],this)},RemoveChildren:function(t){for(var e=0;e<t.length;e++)r.call(this,t[e])},OrderChildren:function(t){this._flagOrder=!0},MakeObservable:function(i){var n=t.Path.Properties.slice(0),r=e.indexOf(n,"opacity");r>=0&&(n.splice(r,1),Object.defineProperty(i,"opacity",{get:function(){return this._opacity},set:function(t){this._flagOpacity=this._opacity!=t,this._opacity=t}})),t.Shape.MakeObservable(i),c.MakeGetterSetters(i,n),Object.defineProperty(i,"children",{get:function(){return this._collection},set:function(i){var n=e.bind(c.InsertChildren,this),r=e.bind(c.RemoveChildren,this),o=e.bind(c.OrderChildren,this);this._collection&&this._collection.unbind(),this._collection=new s(i),this._collection.bind(t.Events.insert,n),this._collection.bind(t.Events.remove,r),this._collection.bind(t.Events.order,o)}}),Object.defineProperty(i,"mask",{get:function(){return this._mask},set:function(t){this._mask=t,this._flagMask=!0,t.clip||(t.clip=!0)}})},MakeGetterSetters:function(t,i){e.isArray(i)||(i=[i]),e.each(i,function(e){c.MakeGetterSetter(t,e)})},MakeGetterSetter:function(t,i){var n="_"+i;Object.defineProperty(t,i,{get:function(){return this[n]},set:function(t){this[n]=t,e.each(this.children,function(e){e[i]=t})}})}}),e.extend(c.prototype,t.Shape.prototype,{_flagAdditions:!1,_flagSubtractions:!1,_flagOrder:!1,_flagOpacity:!0,_flagMask:!1,_fill:"#fff",_stroke:"#000",_linewidth:1,_opacity:1,_visible:!0,_cap:"round",_join:"round",_miter:4,_closed:!0,_curved:!1,_automatic:!0,_beginning:0,_ending:1,_mask:null,clone:function(t){t=t||this.parent;var i=new c;t.add(i);e.map(this.children,function(t){return t.clone(i)});return i.translation.copy(this.translation),i.rotation=this.rotation,i.scale=this.scale,i},toObject:function(){var t={children:{},translation:this.translation.toObject(),rotation:this.rotation,scale:this.scale};return e.each(this.children,function(e,i){t.children[i]=e.toObject()},this),t},corner:function(){var t=this.getBoundingClientRect(!0),e={x:t.left,y:t.top};return this.children.forEach(function(t){t.translation.subSelf(e)}),this},center:function(){var t=this.getBoundingClientRect(!0);return t.centroid={x:t.left+t.width/2,y:t.top+t.height/2},this.children.forEach(function(e){e.translation.subSelf(t.centroid)}),this},getById:function(t){var e=function(t,i){if(t.id===i)return t;if(t.children)for(var n=t.children.length;n--;){var r=e(t.children[n],i);if(r)return r}};return e(this,t)||null},getByClassName:function(t){var e=[],i=function(t,n){return-1!=t.classList.indexOf(n)?e.push(t):t.children&&t.children.forEach(function(t){i(t,n)}),e};return i(this,t)},getByType:function(e){var i=[],n=function(e,r){for(var o in e.children)e.children[o]instanceof r?i.push(e.children[o]):e.children[o]instanceof t.Group&&n(e.children[o],r);
return i};return n(this,e)},add:function(t){t=t instanceof Array?t.slice():e.toArray(arguments);for(var i=0;i<t.length;i++)t[i]&&t[i].id&&this.children.push(t[i]);return this},remove:function(t){var i=arguments.length,n=this.parent;if(0>=i&&n)return n.remove(this),this;t=t instanceof Array?t.slice():e.toArray(arguments);for(var r=0;r<t.length;r++)t[r]&&this.children.ids[t[r].id]&&this.children.splice(e.indexOf(this.children,t[r]),1);return this},getBoundingClientRect:function(t){var i;this._update(!0);var n=1/0,r=-(1/0),s=1/0,c=-(1/0);return this.children.forEach(function(l){/(linear-gradient|radial-gradient|gradient)/.test(l._renderer.type)||(i=l.getBoundingClientRect(t),e.isNumber(i.top)&&e.isNumber(i.left)&&e.isNumber(i.right)&&e.isNumber(i.bottom)&&(s=o(i.top,s),n=o(i.left,n),r=a(i.right,r),c=a(i.bottom,c)))},this),{top:s,left:n,right:r,bottom:c,width:r-n,height:c-s}},noFill:function(){return this.children.forEach(function(t){t.noFill()}),this},noStroke:function(){return this.children.forEach(function(t){t.noStroke()}),this},subdivide:function(){var t=arguments;return this.children.forEach(function(e){e.subdivide.apply(e,t)}),this},flagReset:function(){return this._flagAdditions&&(this.additions.length=0,this._flagAdditions=!1),this._flagSubtractions&&(this.subtractions.length=0,this._flagSubtractions=!1),this._flagOrder=this._flagMask=this._flagOpacity=!1,t.Shape.prototype.flagReset.call(this),this}}),c.MakeObservable(c.prototype)}(Two,"function"==typeof require?require("underscore"):_,"function"==typeof require?require("backbone"):Backbone,"function"==typeof require?require("requestAnimationFrame"):requestAnimationFrame),!function(t){if("object"==typeof exports)module.exports=t();else if("function"==typeof define,1){var e;"undefined"!=typeof window?e=window:"undefined"!=typeof global?e=global:"undefined"!=typeof self&&(e=self),e.p2=t()}else define(t)}(function(){return function t(e,i,n){function r(a,s){if(!i[a]){if(!e[a]){var c="function"==typeof require&&require;if(!s&&c)return c(a,!0);if(o)return o(a,!0);throw new Error("Cannot find module '"+a+"'")}var l=i[a]={exports:{}};e[a][0].call(l.exports,function(t){var i=e[a][1][t];return r(i?i:t)},l,l.exports,t,e,i,n)}return i[a].exports}for(var o="function"==typeof require&&require,a=0;a<n.length;a++)r(n[a]);return r}({1:[function(t,e,i){function n(){}var r=t("./Scalar");e.exports=n,n.lineInt=function(t,e,i){i=i||0;var n,o,a,s,c,l,h,u=[0,0];return n=t[1][1]-t[0][1],o=t[0][0]-t[1][0],a=n*t[0][0]+o*t[0][1],s=e[1][1]-e[0][1],c=e[0][0]-e[1][0],l=s*e[0][0]+c*e[0][1],h=n*c-s*o,r.eq(h,0,i)||(u[0]=(c*a-o*l)/h,u[1]=(n*l-s*a)/h),u},n.segmentsIntersect=function(t,e,i,n){var r=e[0]-t[0],o=e[1]-t[1],a=n[0]-i[0],s=n[1]-i[1];if(a*o-s*r==0)return!1;var c=(r*(i[1]-t[1])+o*(t[0]-i[0]))/(a*o-s*r),l=(a*(t[1]-i[1])+s*(i[0]-t[0]))/(s*r-a*o);return c>=0&&1>=c&&l>=0&&1>=l}},{"./Scalar":4}],2:[function(t,e,i){function n(){}e.exports=n,n.area=function(t,e,i){return(e[0]-t[0])*(i[1]-t[1])-(i[0]-t[0])*(e[1]-t[1])},n.left=function(t,e,i){return n.area(t,e,i)>0},n.leftOn=function(t,e,i){return n.area(t,e,i)>=0},n.right=function(t,e,i){return n.area(t,e,i)<0},n.rightOn=function(t,e,i){return n.area(t,e,i)<=0};var r=[],o=[];n.collinear=function(t,e,i,a){if(a){var s=r,c=o;s[0]=e[0]-t[0],s[1]=e[1]-t[1],c[0]=i[0]-e[0],c[1]=i[1]-e[1];var l=s[0]*c[0]+s[1]*c[1],h=Math.sqrt(s[0]*s[0]+s[1]*s[1]),u=Math.sqrt(c[0]*c[0]+c[1]*c[1]),p=Math.acos(l/(h*u));return a>p}return 0==n.area(t,e,i)},n.sqdist=function(t,e){var i=e[0]-t[0],n=e[1]-t[1];return i*i+n*n}},{}],3:[function(t,e,i){function n(){this.vertices=[]}function r(t,e,i,n,r){r=r||0;var o=e[1]-t[1],a=t[0]-e[0],c=o*t[0]+a*t[1],l=n[1]-i[1],h=i[0]-n[0],u=l*i[0]+h*i[1],p=o*h-l*a;return s.eq(p,0,r)?[0,0]:[(h*c-a*u)/p,(o*u-l*c)/p]}var o=t("./Line"),a=t("./Point"),s=t("./Scalar");e.exports=n,n.prototype.at=function(t){var e=this.vertices,i=e.length;return e[0>t?t%i+i:t%i]},n.prototype.first=function(){return this.vertices[0]},n.prototype.last=function(){return this.vertices[this.vertices.length-1]},n.prototype.clear=function(){this.vertices.length=0},n.prototype.append=function(t,e,i){if("undefined"==typeof e)throw new Error("From is not given!");if("undefined"==typeof i)throw new Error("To is not given!");if(e>i-1)throw new Error("lol1");if(i>t.vertices.length)throw new Error("lol2");if(0>e)throw new Error("lol3");for(var n=e;i>n;n++)this.vertices.push(t.vertices[n])},n.prototype.makeCCW=function(){for(var t=0,e=this.vertices,i=1;i<this.vertices.length;++i)(e[i][1]<e[t][1]||e[i][1]==e[t][1]&&e[i][0]>e[t][0])&&(t=i);a.left(this.at(t-1),this.at(t),this.at(t+1))||this.reverse()},n.prototype.reverse=function(){for(var t=[],e=0,i=this.vertices.length;e!==i;e++)t.push(this.vertices.pop());this.vertices=t},n.prototype.isReflex=function(t){return a.right(this.at(t-1),this.at(t),this.at(t+1))};var c=[],l=[];n.prototype.canSee=function(t,e){var i,n,r=c,s=l;if(a.leftOn(this.at(t+1),this.at(t),this.at(e))&&a.rightOn(this.at(t-1),this.at(t),this.at(e)))return!1;n=a.sqdist(this.at(t),this.at(e));for(var h=0;h!==this.vertices.length;++h)if((h+1)%this.vertices.length!==t&&h!==t&&a.leftOn(this.at(t),this.at(e),this.at(h+1))&&a.rightOn(this.at(t),this.at(e),this.at(h))&&(r[0]=this.at(t),r[1]=this.at(e),s[0]=this.at(h),s[1]=this.at(h+1),i=o.lineInt(r,s),a.sqdist(this.at(t),i)<n))return!1;return!0},n.prototype.copy=function(t,e,i){var r=i||new n;if(r.clear(),e>t)for(var o=t;e>=o;o++)r.vertices.push(this.vertices[o]);else{for(var o=0;e>=o;o++)r.vertices.push(this.vertices[o]);for(var o=t;o<this.vertices.length;o++)r.vertices.push(this.vertices[o])}return r},n.prototype.getCutEdges=function(){for(var t=[],e=[],i=[],r=new n,o=Number.MAX_VALUE,a=0;a<this.vertices.length;++a)if(this.isReflex(a))for(var s=0;s<this.vertices.length;++s)if(this.canSee(a,s)){e=this.copy(a,s,r).getCutEdges(),i=this.copy(s,a,r).getCutEdges();for(var c=0;c<i.length;c++)e.push(i[c]);e.length<o&&(t=e,o=e.length,t.push([this.at(a),this.at(s)]))}return t},n.prototype.decomp=function(){var t=this.getCutEdges();return t.length>0?this.slice(t):[this]},n.prototype.slice=function(t){if(0==t.length)return[this];if(t instanceof Array&&t.length&&t[0]instanceof Array&&2==t[0].length&&t[0][0]instanceof Array){for(var e=[this],i=0;i<t.length;i++)for(var n=t[i],r=0;r<e.length;r++){var o=e[r],a=o.slice(n);if(a){e.splice(r,1),e.push(a[0],a[1]);break}}return e}var n=t,i=this.vertices.indexOf(n[0]),r=this.vertices.indexOf(n[1]);return-1!=i&&-1!=r?[this.copy(i,r),this.copy(r,i)]:!1},n.prototype.isSimple=function(){for(var t=this.vertices,e=0;e<t.length-1;e++)for(var i=0;e-1>i;i++)if(o.segmentsIntersect(t[e],t[e+1],t[i],t[i+1]))return!1;for(var e=1;e<t.length-2;e++)if(o.segmentsIntersect(t[0],t[t.length-1],t[e],t[e+1]))return!1;return!0},n.prototype.quickDecomp=function(t,e,i,o,s,c){s=s||100,c=c||0,o=o||25,t="undefined"!=typeof t?t:[],e=e||[],i=i||[];var l=[0,0],h=[0,0],u=[0,0],p=0,d=0,f=0,v=0,m=0,g=0,y=0,b=new n,A=new n,_=this,E=this.vertices;if(E.length<3)return t;if(c++,c>s)return console.warn("quickDecomp: max level ("+s+") reached."),t;for(var x=0;x<this.vertices.length;++x)if(_.isReflex(x)){e.push(_.vertices[x]),p=d=Number.MAX_VALUE;for(var w=0;w<this.vertices.length;++w)a.left(_.at(x-1),_.at(x),_.at(w))&&a.rightOn(_.at(x-1),_.at(x),_.at(w-1))&&(u=r(_.at(x-1),_.at(x),_.at(w),_.at(w-1)),a.right(_.at(x+1),_.at(x),u)&&(f=a.sqdist(_.vertices[x],u),d>f&&(d=f,h=u,g=w))),a.left(_.at(x+1),_.at(x),_.at(w+1))&&a.rightOn(_.at(x+1),_.at(x),_.at(w))&&(u=r(_.at(x+1),_.at(x),_.at(w),_.at(w+1)),a.left(_.at(x-1),_.at(x),u)&&(f=a.sqdist(_.vertices[x],u),p>f&&(p=f,l=u,m=w)));if(g==(m+1)%this.vertices.length)u[0]=(h[0]+l[0])/2,u[1]=(h[1]+l[1])/2,i.push(u),m>x?(b.append(_,x,m+1),b.vertices.push(u),A.vertices.push(u),0!=g&&A.append(_,g,_.vertices.length),A.append(_,0,x+1)):(0!=x&&b.append(_,x,_.vertices.length),b.append(_,0,m+1),b.vertices.push(u),A.vertices.push(u),A.append(_,g,x+1));else{if(g>m&&(m+=this.vertices.length),v=Number.MAX_VALUE,g>m)return t;for(var w=g;m>=w;++w)a.leftOn(_.at(x-1),_.at(x),_.at(w))&&a.rightOn(_.at(x+1),_.at(x),_.at(w))&&(f=a.sqdist(_.at(x),_.at(w)),v>f&&(v=f,y=w%this.vertices.length));y>x?(b.append(_,x,y+1),0!=y&&A.append(_,y,E.length),A.append(_,0,x+1)):(0!=x&&b.append(_,x,E.length),b.append(_,0,y+1),A.append(_,y,x+1))}return b.vertices.length<A.vertices.length?(b.quickDecomp(t,e,i,o,s,c),A.quickDecomp(t,e,i,o,s,c)):(A.quickDecomp(t,e,i,o,s,c),b.quickDecomp(t,e,i,o,s,c)),t}return t.push(this),t},n.prototype.removeCollinearPoints=function(t){for(var e=0,i=this.vertices.length-1;this.vertices.length>3&&i>=0;--i)a.collinear(this.at(i-1),this.at(i),this.at(i+1),t)&&(this.vertices.splice(i%this.vertices.length,1),i--,e++);return e}},{"./Line":1,"./Point":2,"./Scalar":4}],4:[function(t,e,i){function n(){}e.exports=n,n.eq=function(t,e,i){return i=i||0,Math.abs(t-e)<i}},{}],5:[function(t,e,i){e.exports={Polygon:t("./Polygon"),Point:t("./Point")}},{"./Point":2,"./Polygon":3}],6:[function(t,e,i){e.exports={name:"p2",version:"0.7.1",description:"A JavaScript 2D physics engine.",author:"Stefan Hedman <schteppe@gmail.com> (http://steffe.se)",keywords:["p2.js","p2","physics","engine","2d"],main:"./src/p2.js",engines:{node:"*"},repository:{type:"git",url:"https://github.com/schteppe/p2.js.git"},bugs:{url:"https://github.com/schteppe/p2.js/issues"},licenses:[{type:"MIT"}],devDependencies:{grunt:"^0.4.5","grunt-contrib-jshint":"^0.11.2","grunt-contrib-nodeunit":"^0.4.1","grunt-contrib-uglify":"~0.4.0","grunt-contrib-watch":"~0.5.0","grunt-browserify":"~2.0.1","grunt-contrib-concat":"^0.4.0"},dependencies:{"poly-decomp":"0.1.1"}}},{}],7:[function(t,e,i){function n(t){this.lowerBound=r.create(),t&&t.lowerBound&&r.copy(this.lowerBound,t.lowerBound),this.upperBound=r.create(),t&&t.upperBound&&r.copy(this.upperBound,t.upperBound)}var r=t("../math/vec2");t("../utils/Utils");e.exports=n;var o=r.create();n.prototype.setFromPoints=function(t,e,i,n){var a=this.lowerBound,s=this.upperBound;"number"!=typeof i&&(i=0),0!==i?r.rotate(a,t[0],i):r.copy(a,t[0]),r.copy(s,a);for(var c=Math.cos(i),l=Math.sin(i),h=1;h<t.length;h++){var u=t[h];if(0!==i){var p=u[0],d=u[1];o[0]=c*p-l*d,o[1]=l*p+c*d,u=o}for(var f=0;2>f;f++)u[f]>s[f]&&(s[f]=u[f]),u[f]<a[f]&&(a[f]=u[f])}e&&(r.add(this.lowerBound,this.lowerBound,e),r.add(this.upperBound,this.upperBound,e)),n&&(this.lowerBound[0]-=n,this.lowerBound[1]-=n,this.upperBound[0]+=n,this.upperBound[1]+=n)},n.prototype.copy=function(t){r.copy(this.lowerBound,t.lowerBound),r.copy(this.upperBound,t.upperBound)},n.prototype.extend=function(t){for(var e=2;e--;){var i=t.lowerBound[e];this.lowerBound[e]>i&&(this.lowerBound[e]=i);var n=t.upperBound[e];this.upperBound[e]<n&&(this.upperBound[e]=n)}},n.prototype.overlaps=function(t){var e=this.lowerBound,i=this.upperBound,n=t.lowerBound,r=t.upperBound;return(n[0]<=i[0]&&i[0]<=r[0]||e[0]<=r[0]&&r[0]<=i[0])&&(n[1]<=i[1]&&i[1]<=r[1]||e[1]<=r[1]&&r[1]<=i[1])},n.prototype.containsPoint=function(t){var e=this.lowerBound,i=this.upperBound;return e[0]<=t[0]&&t[0]<=i[0]&&e[1]<=t[1]&&t[1]<=i[1]},n.prototype.overlapsRay=function(t){var e=1/t.direction[0],i=1/t.direction[1],n=(this.lowerBound[0]-t.from[0])*e,r=(this.upperBound[0]-t.from[0])*e,o=(this.lowerBound[1]-t.from[1])*i,a=(this.upperBound[1]-t.from[1])*i,s=Math.max(Math.max(Math.min(n,r),Math.min(o,a))),c=Math.min(Math.min(Math.max(n,r),Math.max(o,a)));return 0>c?-1:s>c?-1:s}},{"../math/vec2":30,"../utils/Utils":57}],8:[function(t,e,i){function n(t){this.type=t,this.result=[],this.world=null,this.boundingVolumeType=n.AABB}var r=t("../math/vec2"),o=t("../objects/Body");e.exports=n,n.AABB=1,n.BOUNDING_CIRCLE=2,n.prototype.setWorld=function(t){this.world=t},n.prototype.getCollisionPairs=function(t){};var a=r.create();n.boundingRadiusCheck=function(t,e){r.sub(a,t.position,e.position);var i=r.squaredLength(a),n=t.boundingRadius+e.boundingRadius;return n*n>=i},n.aabbCheck=function(t,e){return t.getAABB().overlaps(e.getAABB())},n.prototype.boundingVolumeCheck=function(t,e){var i;switch(this.boundingVolumeType){case n.BOUNDING_CIRCLE:i=n.boundingRadiusCheck(t,e);break;case n.AABB:i=n.aabbCheck(t,e);break;default:throw new Error("Bounding volume type not recognized: "+this.boundingVolumeType)}return i},n.canCollide=function(t,e){var i=o.KINEMATIC,n=o.STATIC;return t.type===n&&e.type===n?!1:t.type===i&&e.type===n||t.type===n&&e.type===i?!1:t.type===i&&e.type===i?!1:t.sleepState===o.SLEEPING&&e.sleepState===o.SLEEPING?!1:t.sleepState===o.SLEEPING&&e.type===n||e.sleepState===o.SLEEPING&&t.type===n?!1:!0},n.NAIVE=1,n.SAP=2},{"../math/vec2":30,"../objects/Body":31}],9:[function(t,e,i){function n(){r.call(this,r.NAIVE)}var r=(t("../shapes/Circle"),t("../shapes/Plane"),t("../shapes/Shape"),t("../shapes/Particle"),t("../collision/Broadphase"));t("../math/vec2");e.exports=n,n.prototype=new r,n.prototype.constructor=n,n.prototype.getCollisionPairs=function(t){var e=t.bodies,i=this.result;i.length=0;for(var n=0,o=e.length;n!==o;n++)for(var a=e[n],s=0;n>s;s++){var c=e[s];r.canCollide(a,c)&&this.boundingVolumeCheck(a,c)&&i.push(a,c)}return i},n.prototype.aabbQuery=function(t,e,i){i=i||[];for(var n=t.bodies,r=0;r<n.length;r++){var o=n[r];o.aabbNeedsUpdate&&o.updateAABB(),o.aabb.overlaps(e)&&i.push(o)}return i}},{"../collision/Broadphase":8,"../math/vec2":30,"../shapes/Circle":39,"../shapes/Particle":43,"../shapes/Plane":44,"../shapes/Shape":45}],10:[function(t,e,i){function n(){this.contactEquations=[],this.frictionEquations=[],this.enableFriction=!0,this.enabledEquations=!0,this.slipForce=10,this.frictionCoefficient=.3,this.surfaceVelocity=0,this.contactEquationPool=new h({size:32}),this.frictionEquationPool=new u({size:64}),this.restitution=0,this.stiffness=d.DEFAULT_STIFFNESS,this.relaxation=d.DEFAULT_RELAXATION,this.frictionStiffness=d.DEFAULT_STIFFNESS,this.frictionRelaxation=d.DEFAULT_RELAXATION,this.enableFrictionReduction=!0,this.collidingBodiesLastStep=new p,this.contactSkinSize=.01}function r(t,e){a.set(t.vertices[0],.5*-e.length,-e.radius),a.set(t.vertices[1],.5*e.length,-e.radius),a.set(t.vertices[2],.5*e.length,e.radius),a.set(t.vertices[3],.5*-e.length,e.radius)}function o(t,e,i,n){for(var r=X,o=H,l=W,h=Y,u=t,p=e.vertices,d=null,f=0;f!==p.length+1;f++){var v=p[f%p.length],m=p[(f+1)%p.length];a.rotate(r,v,n),a.rotate(o,m,n),c(r,r,i),c(o,o,i),s(l,r,u),s(h,o,u);var g=a.crossLength(l,h);if(null===d&&(d=g),0>=g*d)return!1;d=g}return!0}var a=t("../math/vec2"),s=a.sub,c=a.add,l=a.dot,h=(t("../utils/Utils"),t("../utils/ContactEquationPool")),u=t("../utils/FrictionEquationPool"),p=t("../utils/TupleDictionary"),d=t("../equations/Equation"),f=(t("../equations/ContactEquation"),t("../equations/FrictionEquation"),t("../shapes/Circle")),v=t("../shapes/Convex"),m=t("../shapes/Shape"),g=(t("../objects/Body"),t("../shapes/Box"));e.exports=n;var y=a.fromValues(0,1),b=a.fromValues(0,0),A=a.fromValues(0,0),_=a.fromValues(0,0),E=a.fromValues(0,0),x=a.fromValues(0,0),w=a.fromValues(0,0),F=a.fromValues(0,0),B=a.fromValues(0,0),q=a.fromValues(0,0),C=a.fromValues(0,0),S=a.fromValues(0,0),P=a.fromValues(0,0),M=a.fromValues(0,0),k=a.fromValues(0,0),L=a.fromValues(0,0),R=a.fromValues(0,0),I=a.fromValues(0,0),O=a.fromValues(0,0),T=[],V=a.create(),N=a.create();n.prototype.bodiesOverlap=function(t,e){for(var i=V,n=N,r=0,o=t.shapes.length;r!==o;r++){var a=t.shapes[r];t.toWorldFrame(i,a.position);for(var s=0,c=e.shapes.length;s!==c;s++){var l=e.shapes[s];if(e.toWorldFrame(n,l.position),this[a.type|l.type](t,a,i,a.angle+t.angle,e,l,n,l.angle+e.angle,!0))return!0}}return!1},n.prototype.collidedLastStep=function(t,e){var i=0|t.id,n=0|e.id;return!!this.collidingBodiesLastStep.get(i,n)},n.prototype.reset=function(){this.collidingBodiesLastStep.reset();for(var t=this.contactEquations,e=t.length;e--;){var i=t[e],n=i.bodyA.id,r=i.bodyB.id;this.collidingBodiesLastStep.set(n,r,!0)}for(var o=this.contactEquations,a=this.frictionEquations,s=0;s<o.length;s++)this.contactEquationPool.release(o[s]);for(var s=0;s<a.length;s++)this.frictionEquationPool.release(a[s]);this.contactEquations.length=this.frictionEquations.length=0},n.prototype.createContactEquation=function(t,e,i,n){var r=this.contactEquationPool.get();return r.bodyA=t,r.bodyB=e,r.shapeA=i,r.shapeB=n,r.restitution=this.restitution,r.firstImpact=!this.collidedLastStep(t,e),r.stiffness=this.stiffness,r.relaxation=this.relaxation,r.needsUpdate=!0,r.enabled=this.enabledEquations,r.offset=this.contactSkinSize,r},n.prototype.createFrictionEquation=function(t,e,i,n){var r=this.frictionEquationPool.get();return r.bodyA=t,r.bodyB=e,r.shapeA=i,r.shapeB=n,r.setSlipForce(this.slipForce),r.frictionCoefficient=this.frictionCoefficient,r.relativeVelocity=this.surfaceVelocity,r.enabled=this.enabledEquations,r.needsUpdate=!0,r.stiffness=this.frictionStiffness,r.relaxation=this.frictionRelaxation,r.contactEquations.length=0,r},n.prototype.createFrictionFromContact=function(t){var e=this.createFrictionEquation(t.bodyA,t.bodyB,t.shapeA,t.shapeB);return a.copy(e.contactPointA,t.contactPointA),a.copy(e.contactPointB,t.contactPointB),a.rotate90cw(e.t,t.normalA),e.contactEquations.push(t),e},n.prototype.createFrictionFromAverage=function(t){var e=this.contactEquations[this.contactEquations.length-1],i=this.createFrictionEquation(e.bodyA,e.bodyB,e.shapeA,e.shapeB),n=e.bodyA;e.bodyB;a.set(i.contactPointA,0,0),a.set(i.contactPointB,0,0),a.set(i.t,0,0);for(var r=0;r!==t;r++)e=this.contactEquations[this.contactEquations.length-1-r],e.bodyA===n?(a.add(i.t,i.t,e.normalA),a.add(i.contactPointA,i.contactPointA,e.contactPointA),a.add(i.contactPointB,i.contactPointB,e.contactPointB)):(a.sub(i.t,i.t,e.normalA),a.add(i.contactPointA,i.contactPointA,e.contactPointB),a.add(i.contactPointB,i.contactPointB,e.contactPointA)),i.contactEquations.push(e);var o=1/t;return a.scale(i.contactPointA,i.contactPointA,o),a.scale(i.contactPointB,i.contactPointB,o),a.normalize(i.t,i.t),a.rotate90cw(i.t,i.t),i},n.prototype[m.LINE|m.CONVEX]=n.prototype.convexLine=function(t,e,i,n,r,o,a,s,c){return c?!1:0},n.prototype[m.LINE|m.BOX]=n.prototype.lineBox=function(t,e,i,n,r,o,a,s,c){return c?!1:0};var U=new g({width:1,height:1}),G=a.create();n.prototype[m.CAPSULE|m.CONVEX]=n.prototype[m.CAPSULE|m.BOX]=n.prototype.convexCapsule=function(t,e,i,n,o,s,c,l,h){var u=G;a.set(u,s.length/2,0),a.rotate(u,u,l),a.add(u,u,c);var p=this.circleConvex(o,s,u,l,t,e,i,n,h,s.radius);a.set(u,-s.length/2,0),a.rotate(u,u,l),a.add(u,u,c);var d=this.circleConvex(o,s,u,l,t,e,i,n,h,s.radius);if(h&&(p||d))return!0;var f=U;r(f,s);var v=this.convexConvex(t,e,i,n,o,f,c,l,h);return v+p+d},n.prototype[m.CAPSULE|m.LINE]=n.prototype.lineCapsule=function(t,e,i,n,r,o,a,s,c){return c?!1:0};var D=a.create(),j=a.create(),z=new g({width:1,height:1});n.prototype[m.CAPSULE|m.CAPSULE]=n.prototype.capsuleCapsule=function(t,e,i,n,o,s,c,l,h){for(var u,p=D,d=j,f=0,v=0;2>v;v++){a.set(p,(0===v?-1:1)*e.length/2,0),a.rotate(p,p,n),a.add(p,p,i);for(var m=0;2>m;m++){a.set(d,(0===m?-1:1)*s.length/2,0),a.rotate(d,d,l),a.add(d,d,c),this.enableFrictionReduction&&(u=this.enableFriction,this.enableFriction=!1);var g=this.circleCircle(t,e,p,n,o,s,d,l,h,e.radius,s.radius);if(this.enableFrictionReduction&&(this.enableFriction=u),h&&g)return!0;f+=g}}this.enableFrictionReduction&&(u=this.enableFriction,this.enableFriction=!1);var y=z;r(y,e);var b=this.convexCapsule(t,y,i,n,o,s,c,l,h);if(this.enableFrictionReduction&&(this.enableFriction=u),h&&b)return!0;if(f+=b,this.enableFrictionReduction){var u=this.enableFriction;this.enableFriction=!1}r(y,s);var A=this.convexCapsule(o,y,c,l,t,e,i,n,h);return this.enableFrictionReduction&&(this.enableFriction=u),h&&A?!0:(f+=A,this.enableFrictionReduction&&f&&this.enableFriction&&this.frictionEquations.push(this.createFrictionFromAverage(f)),f)},n.prototype[m.LINE|m.LINE]=n.prototype.lineLine=function(t,e,i,n,r,o,a,s,c){return c?!1:0},n.prototype[m.PLANE|m.LINE]=n.prototype.planeLine=function(t,e,i,n,r,o,h,u,p){var d=b,f=A,v=_,m=E,g=x,C=w,S=F,P=B,M=q,k=T,L=0;a.set(d,-o.length/2,0),a.set(f,o.length/2,0),a.rotate(v,d,u),a.rotate(m,f,u),c(v,v,h),c(m,m,h),a.copy(d,v),a.copy(f,m),s(g,f,d),a.normalize(C,g),a.rotate90cw(M,C),a.rotate(P,y,n),k[0]=d,k[1]=f;for(var R=0;R<k.length;R++){var I=k[R];s(S,I,i);var O=l(S,P);if(0>O){if(p)return!0;var V=this.createContactEquation(t,r,e,o);L++,a.copy(V.normalA,P),a.normalize(V.normalA,V.normalA),a.scale(S,P,O),s(V.contactPointA,I,S),s(V.contactPointA,V.contactPointA,t.position),s(V.contactPointB,I,h),c(V.contactPointB,V.contactPointB,h),s(V.contactPointB,V.contactPointB,r.position),this.contactEquations.push(V),this.enableFrictionReduction||this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(V))}}return p?!1:(this.enableFrictionReduction||L&&this.enableFriction&&this.frictionEquations.push(this.createFrictionFromAverage(L)),L)},n.prototype[m.PARTICLE|m.CAPSULE]=n.prototype.particleCapsule=function(t,e,i,n,r,o,a,s,c){return this.circleLine(t,e,i,n,r,o,a,s,c,o.radius,0)},n.prototype[m.CIRCLE|m.LINE]=n.prototype.circleLine=function(t,e,i,n,r,o,h,u,p,d,f){var d=d||0,f="undefined"!=typeof f?f:e.radius,v=b,m=A,g=_,y=E,L=x,R=w,I=F,O=B,V=q,N=C,U=S,G=P,D=M,j=k,z=T;a.set(O,-o.length/2,0),a.set(V,o.length/2,0),a.rotate(N,O,u),a.rotate(U,V,u),c(N,N,h),c(U,U,h),a.copy(O,N),a.copy(V,U),s(R,V,O),a.normalize(I,R),a.rotate90cw(L,I),s(G,i,O);var X=l(G,L);s(y,O,h),s(D,i,h);var H=f+d;if(Math.abs(X)<H){a.scale(v,L,X),s(g,i,v),a.scale(m,L,l(L,D)),a.normalize(m,m),a.scale(m,m,d),c(g,g,m);var W=l(I,g),Y=l(I,O),K=l(I,V);if(W>Y&&K>W){if(p)return!0;var Z=this.createContactEquation(t,r,e,o);return a.scale(Z.normalA,v,-1),a.normalize(Z.normalA,Z.normalA),a.scale(Z.contactPointA,Z.normalA,f),c(Z.contactPointA,Z.contactPointA,i),s(Z.contactPointA,Z.contactPointA,t.position),s(Z.contactPointB,g,h),c(Z.contactPointB,Z.contactPointB,h),s(Z.contactPointB,Z.contactPointB,r.position),this.contactEquations.push(Z),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(Z)),1}}z[0]=O,z[1]=V;for(var J=0;J<z.length;J++){var Q=z[J];if(s(G,Q,i),a.squaredLength(G)<Math.pow(H,2)){if(p)return!0;var Z=this.createContactEquation(t,r,e,o);return a.copy(Z.normalA,G),a.normalize(Z.normalA,Z.normalA),a.scale(Z.contactPointA,Z.normalA,f),c(Z.contactPointA,Z.contactPointA,i),s(Z.contactPointA,Z.contactPointA,t.position),s(Z.contactPointB,Q,h),a.scale(j,Z.normalA,-d),c(Z.contactPointB,Z.contactPointB,j),c(Z.contactPointB,Z.contactPointB,h),s(Z.contactPointB,Z.contactPointB,r.position),this.contactEquations.push(Z),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(Z)),1}}return 0},n.prototype[m.CIRCLE|m.CAPSULE]=n.prototype.circleCapsule=function(t,e,i,n,r,o,a,s,c){return this.circleLine(t,e,i,n,r,o,a,s,c,o.radius)},n.prototype[m.CIRCLE|m.CONVEX]=n.prototype[m.CIRCLE|m.BOX]=n.prototype.circleConvex=function(t,e,i,n,r,l,h,u,p,d){for(var d="number"==typeof d?d:e.radius,f=b,v=A,m=_,g=E,y=x,w=C,F=S,B=M,q=k,P=L,I=R,O=!1,T=Number.MAX_VALUE,V=l.vertices,N=0;N!==V.length+1;N++){var U=V[N%V.length],G=V[(N+1)%V.length];if(a.rotate(f,U,u),a.rotate(v,G,u),c(f,f,h),c(v,v,h),s(m,v,f),a.normalize(g,m),a.rotate90cw(y,g),a.scale(q,y,-e.radius),c(q,q,i),o(q,l,h,u)){a.sub(P,f,q);var D=Math.abs(a.dot(P,y));T>D&&(a.copy(I,q),T=D,a.scale(B,y,D),a.add(B,B,q),O=!0)}}if(O){if(p)return!0;var j=this.createContactEquation(t,r,e,l);return a.sub(j.normalA,I,i),a.normalize(j.normalA,j.normalA),a.scale(j.contactPointA,j.normalA,d),c(j.contactPointA,j.contactPointA,i),s(j.contactPointA,j.contactPointA,t.position),s(j.contactPointB,B,h),c(j.contactPointB,j.contactPointB,h),s(j.contactPointB,j.contactPointB,r.position),this.contactEquations.push(j),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(j)),1}if(d>0)for(var N=0;N<V.length;N++){var z=V[N];if(a.rotate(F,z,u),c(F,F,h),s(w,F,i),a.squaredLength(w)<Math.pow(d,2)){if(p)return!0;var j=this.createContactEquation(t,r,e,l);return a.copy(j.normalA,w),a.normalize(j.normalA,j.normalA),a.scale(j.contactPointA,j.normalA,d),c(j.contactPointA,j.contactPointA,i),s(j.contactPointA,j.contactPointA,t.position),s(j.contactPointB,F,h),c(j.contactPointB,j.contactPointB,h),s(j.contactPointB,j.contactPointB,r.position),this.contactEquations.push(j),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(j)),1}}return 0};var X=a.create(),H=a.create(),W=a.create(),Y=a.create();n.prototype[m.PARTICLE|m.CONVEX]=n.prototype[m.PARTICLE|m.BOX]=n.prototype.particleConvex=function(t,e,i,n,r,h,u,p,d){var f=b,v=A,m=_,g=E,y=x,B=w,q=F,S=C,P=M,k=I,L=O,R=Number.MAX_VALUE,T=!1,V=h.vertices;if(!o(i,h,u,p))return 0;if(d)return!0;for(var N=0;N!==V.length+1;N++){var U=V[N%V.length],G=V[(N+1)%V.length];a.rotate(f,U,p),a.rotate(v,G,p),c(f,f,u),c(v,v,u),s(m,v,f),a.normalize(g,m),a.rotate90cw(y,g),s(S,i,f);l(S,y);s(B,f,u),s(q,i,u),a.sub(k,f,i);var D=Math.abs(a.dot(k,y));R>D&&(R=D,a.scale(P,y,D),a.add(P,P,i),a.copy(L,y),T=!0)}if(T){var j=this.createContactEquation(t,r,e,h);return a.scale(j.normalA,L,-1),a.normalize(j.normalA,j.normalA),a.set(j.contactPointA,0,0),c(j.contactPointA,j.contactPointA,i),s(j.contactPointA,j.contactPointA,t.position),s(j.contactPointB,P,u),c(j.contactPointB,j.contactPointB,u),s(j.contactPointB,j.contactPointB,r.position),this.contactEquations.push(j),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(j)),1}return 0},n.prototype[m.CIRCLE]=n.prototype.circleCircle=function(t,e,i,n,r,o,l,h,u,p,d){var f=b,p=p||e.radius,d=d||o.radius;s(f,i,l);var v=p+d;if(a.squaredLength(f)>Math.pow(v,2))return 0;if(u)return!0;var m=this.createContactEquation(t,r,e,o);return s(m.normalA,l,i),a.normalize(m.normalA,m.normalA),a.scale(m.contactPointA,m.normalA,p),a.scale(m.contactPointB,m.normalA,-d),c(m.contactPointA,m.contactPointA,i),s(m.contactPointA,m.contactPointA,t.position),c(m.contactPointB,m.contactPointB,l),s(m.contactPointB,m.contactPointB,r.position),this.contactEquations.push(m),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(m)),1},n.prototype[m.PLANE|m.CONVEX]=n.prototype[m.PLANE|m.BOX]=n.prototype.planeConvex=function(t,e,i,n,r,o,h,u,p){var d=b,f=A,v=_,m=0;a.rotate(f,y,n);for(var g=0;g!==o.vertices.length;g++){var E=o.vertices[g];if(a.rotate(d,E,u),c(d,d,h),s(v,d,i),l(v,f)<=0){if(p)return!0;m++;var x=this.createContactEquation(t,r,e,o);s(v,d,i),a.copy(x.normalA,f);var w=l(v,x.normalA);a.scale(v,x.normalA,w),s(x.contactPointB,d,r.position),s(x.contactPointA,d,v),s(x.contactPointA,x.contactPointA,t.position),this.contactEquations.push(x),this.enableFrictionReduction||this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(x))}}return this.enableFrictionReduction&&this.enableFriction&&m&&this.frictionEquations.push(this.createFrictionFromAverage(m)),m},n.prototype[m.PARTICLE|m.PLANE]=n.prototype.particlePlane=function(t,e,i,n,r,o,c,h,u){var p=b,d=A;h=h||0,s(p,i,c),a.rotate(d,y,h);var f=l(p,d);if(f>0)return 0;if(u)return!0;var v=this.createContactEquation(r,t,o,e);return a.copy(v.normalA,d),a.scale(p,v.normalA,f),s(v.contactPointA,i,p),s(v.contactPointA,v.contactPointA,r.position),s(v.contactPointB,i,t.position),this.contactEquations.push(v),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(v)),1},n.prototype[m.CIRCLE|m.PARTICLE]=n.prototype.circleParticle=function(t,e,i,n,r,o,l,h,u){var p=b;if(s(p,l,i),a.squaredLength(p)>Math.pow(e.radius,2))return 0;if(u)return!0;var d=this.createContactEquation(t,r,e,o);return a.copy(d.normalA,p),a.normalize(d.normalA,d.normalA),a.scale(d.contactPointA,d.normalA,e.radius),c(d.contactPointA,d.contactPointA,i),s(d.contactPointA,d.contactPointA,t.position),s(d.contactPointB,l,r.position),this.contactEquations.push(d),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(d)),1};var K=new f({radius:1}),Z=a.create(),J=a.create();a.create();n.prototype[m.PLANE|m.CAPSULE]=n.prototype.planeCapsule=function(t,e,i,n,r,o,s,l,h){var u=Z,p=J,d=K;a.set(u,-o.length/2,0),a.rotate(u,u,l),c(u,u,s),a.set(p,o.length/2,0),a.rotate(p,p,l),c(p,p,s),d.radius=o.radius;var f;this.enableFrictionReduction&&(f=this.enableFriction,this.enableFriction=!1);var v=this.circlePlane(r,d,u,0,t,e,i,n,h),m=this.circlePlane(r,d,p,0,t,e,i,n,h);if(this.enableFrictionReduction&&(this.enableFriction=f),h)return v||m;var g=v+m;return this.enableFrictionReduction&&g&&this.frictionEquations.push(this.createFrictionFromAverage(g)),g},n.prototype[m.CIRCLE|m.PLANE]=n.prototype.circlePlane=function(t,e,i,n,r,o,h,u,p){var d=t,f=e,v=i,m=r,g=h,E=u;E=E||0;var x=b,w=A,F=_;s(x,v,g),a.rotate(w,y,E);var B=l(w,x);if(B>f.radius)return 0;if(p)return!0;var q=this.createContactEquation(m,d,o,e);return a.copy(q.normalA,w),a.scale(q.contactPointB,q.normalA,-f.radius),c(q.contactPointB,q.contactPointB,v),s(q.contactPointB,q.contactPointB,d.position),a.scale(F,q.normalA,B),s(q.contactPointA,x,F),c(q.contactPointA,q.contactPointA,g),s(q.contactPointA,q.contactPointA,m.position),this.contactEquations.push(q),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(q)),1},n.prototype[m.CONVEX]=n.prototype[m.CONVEX|m.BOX]=n.prototype[m.BOX]=n.prototype.convexConvex=function(t,e,i,r,o,h,u,p,d,f){var v=b,m=A,g=_,y=E,w=x,C=F,S=B,P=q,M=0,f="number"==typeof f?f:0,k=n.findSeparatingAxis(e,i,r,h,u,p,v);if(!k)return 0;s(S,u,i),l(v,S)>0&&a.scale(v,v,-1);var L=n.getClosestEdge(e,r,v,!0),R=n.getClosestEdge(h,p,v);if(-1===L||-1===R)return 0;for(var I=0;2>I;I++){var O=L,T=R,V=e,N=h,U=i,G=u,D=r,j=p,z=t,X=o;if(0===I){var H;H=O,O=T,T=H,H=V,V=N,N=H,H=U,U=G,G=H,H=D,D=j,j=H,H=z,z=X,X=H}for(var W=T;T+2>W;W++){var Y=N.vertices[(W+N.vertices.length)%N.vertices.length];a.rotate(m,Y,j),c(m,m,G);for(var K=0,Z=O-1;O+2>Z;Z++){var J=V.vertices[(Z+V.vertices.length)%V.vertices.length],Q=V.vertices[(Z+1+V.vertices.length)%V.vertices.length];a.rotate(g,J,D),a.rotate(y,Q,D),c(g,g,U),c(y,y,U),s(w,y,g),a.rotate90cw(P,w),a.normalize(P,P),s(S,m,g);var $=l(P,S);(Z===O&&f>=$||Z!==O&&0>=$)&&K++}if(K>=3){if(d)return!0;var tt=this.createContactEquation(z,X,V,N);M++;var J=V.vertices[O%V.vertices.length],Q=V.vertices[(O+1)%V.vertices.length];a.rotate(g,J,D),a.rotate(y,Q,D),c(g,g,U),c(y,y,U),s(w,y,g),a.rotate90cw(tt.normalA,w),a.normalize(tt.normalA,tt.normalA),s(S,m,g);var $=l(tt.normalA,S);a.scale(C,tt.normalA,$),s(tt.contactPointA,m,U),s(tt.contactPointA,tt.contactPointA,C),c(tt.contactPointA,tt.contactPointA,U),s(tt.contactPointA,tt.contactPointA,z.position),s(tt.contactPointB,m,G),c(tt.contactPointB,tt.contactPointB,G),s(tt.contactPointB,tt.contactPointB,X.position),this.contactEquations.push(tt),this.enableFrictionReduction||this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(tt))}}}return this.enableFrictionReduction&&this.enableFriction&&M&&this.frictionEquations.push(this.createFrictionFromAverage(M)),M};var Q=a.fromValues(0,0);n.projectConvexOntoAxis=function(t,e,i,n,r){var o,s,c=null,h=null,u=Q;a.rotate(u,n,-i);for(var p=0;p<t.vertices.length;p++)o=t.vertices[p],s=l(o,u),(null===c||s>c)&&(c=s),(null===h||h>s)&&(h=s);if(h>c){var d=h;h=c,c=d}var f=l(e,n);a.set(r,h+f,c+f)};var $=a.fromValues(0,0),tt=a.fromValues(0,0),et=a.fromValues(0,0),it=a.fromValues(0,0),nt=a.fromValues(0,0),rt=a.fromValues(0,0);n.findSeparatingAxis=function(t,e,i,r,o,c,l){var h=null,u=!1,p=!1,d=$,f=tt,v=et,m=it,y=nt,b=rt;if(t instanceof g&&r instanceof g)for(var A=0;2!==A;A++){var _=t,E=i;1===A&&(_=r,E=c);for(var x=0;2!==x;x++){0===x?a.set(m,0,1):1===x&&a.set(m,1,0),0!==E&&a.rotate(m,m,E),n.projectConvexOntoAxis(t,e,i,m,y),n.projectConvexOntoAxis(r,o,c,m,b);var w=y,F=b,B=!1;y[0]>b[0]&&(F=y,w=b,B=!0);var q=F[0]-w[1];u=0>=q,(null===h||q>h)&&(a.copy(l,m),h=q,p=u)}}else for(var A=0;2!==A;A++){var _=t,E=i;1===A&&(_=r,E=c);for(var x=0;x!==_.vertices.length;x++){a.rotate(f,_.vertices[x],E),a.rotate(v,_.vertices[(x+1)%_.vertices.length],E),s(d,v,f),a.rotate90cw(m,d),a.normalize(m,m),n.projectConvexOntoAxis(t,e,i,m,y),n.projectConvexOntoAxis(r,o,c,m,b);var w=y,F=b,B=!1;y[0]>b[0]&&(F=y,w=b,B=!0);var q=F[0]-w[1];
u=0>=q,(null===h||q>h)&&(a.copy(l,m),h=q,p=u)}}return p};var ot=a.fromValues(0,0),at=a.fromValues(0,0),st=a.fromValues(0,0);n.getClosestEdge=function(t,e,i,n){var r=ot,o=at,c=st;a.rotate(r,i,-e),n&&a.scale(r,r,-1);for(var h=-1,u=t.vertices.length,p=-1,d=0;d!==u;d++){s(o,t.vertices[(d+1)%u],t.vertices[d%u]),a.rotate90cw(c,o),a.normalize(c,c);var f=l(c,r);(-1===h||f>p)&&(h=d%u,p=f)}return h};var ct=a.create(),lt=a.create(),ht=a.create(),ut=a.create(),pt=a.create(),dt=a.create(),ft=a.create();n.prototype[m.CIRCLE|m.HEIGHTFIELD]=n.prototype.circleHeightfield=function(t,e,i,n,r,o,l,h,u,p){var d=o.heights,p=p||e.radius,f=o.elementWidth,v=lt,m=ct,g=pt,y=ft,b=dt,A=ht,_=ut,E=Math.floor((i[0]-p-l[0])/f),x=Math.ceil((i[0]+p-l[0])/f);0>E&&(E=0),x>=d.length&&(x=d.length-1);for(var w=d[E],F=d[x],B=E;x>B;B++)d[B]<F&&(F=d[B]),d[B]>w&&(w=d[B]);if(i[1]-p>w)return u?!1:0;for(var q=!1,B=E;x>B;B++){a.set(A,B*f,d[B]),a.set(_,(B+1)*f,d[B+1]),a.add(A,A,l),a.add(_,_,l),a.sub(b,_,A),a.rotate(b,b,Math.PI/2),a.normalize(b,b),a.scale(m,b,-p),a.add(m,m,i),a.sub(v,m,A);var C=a.dot(v,b);if(m[0]>=A[0]&&m[0]<_[0]&&0>=C){if(u)return!0;q=!0,a.scale(v,b,-C),a.add(g,m,v),a.copy(y,b);var S=this.createContactEquation(r,t,o,e);a.copy(S.normalA,y),a.scale(S.contactPointB,S.normalA,-p),c(S.contactPointB,S.contactPointB,i),s(S.contactPointB,S.contactPointB,t.position),a.copy(S.contactPointA,g),a.sub(S.contactPointA,S.contactPointA,r.position),this.contactEquations.push(S),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(S))}}if(q=!1,p>0)for(var B=E;x>=B;B++)if(a.set(A,B*f,d[B]),a.add(A,A,l),a.sub(v,i,A),a.squaredLength(v)<Math.pow(p,2)){if(u)return!0;q=!0;var S=this.createContactEquation(r,t,o,e);a.copy(S.normalA,v),a.normalize(S.normalA,S.normalA),a.scale(S.contactPointB,S.normalA,-p),c(S.contactPointB,S.contactPointB,i),s(S.contactPointB,S.contactPointB,t.position),s(S.contactPointA,A,l),c(S.contactPointA,S.contactPointA,l),s(S.contactPointA,S.contactPointA,r.position),this.contactEquations.push(S),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(S))}return q?1:0};var vt=a.create(),mt=a.create(),gt=a.create(),yt=new v({vertices:[a.create(),a.create(),a.create(),a.create()]});n.prototype[m.BOX|m.HEIGHTFIELD]=n.prototype[m.CONVEX|m.HEIGHTFIELD]=n.prototype.convexHeightfield=function(t,e,i,n,r,o,s,c,l){var h=o.heights,u=o.elementWidth,p=vt,d=mt,f=gt,v=yt,m=Math.floor((t.aabb.lowerBound[0]-s[0])/u),g=Math.ceil((t.aabb.upperBound[0]-s[0])/u);0>m&&(m=0),g>=h.length&&(g=h.length-1);for(var y=h[m],b=h[g],A=m;g>A;A++)h[A]<b&&(b=h[A]),h[A]>y&&(y=h[A]);if(t.aabb.lowerBound[1]>y)return l?!1:0;for(var _=0,A=m;g>A;A++){a.set(p,A*u,h[A]),a.set(d,(A+1)*u,h[A+1]),a.add(p,p,s),a.add(d,d,s);var E=100;a.set(f,.5*(d[0]+p[0]),.5*(d[1]+p[1]-E)),a.sub(v.vertices[0],d,f),a.sub(v.vertices[1],p,f),a.copy(v.vertices[2],v.vertices[1]),a.copy(v.vertices[3],v.vertices[0]),v.vertices[2][1]-=E,v.vertices[3][1]-=E,_+=this.convexConvex(t,e,i,n,r,v,f,0,l)}return _}},{"../equations/ContactEquation":21,"../equations/Equation":22,"../equations/FrictionEquation":23,"../math/vec2":30,"../objects/Body":31,"../shapes/Box":37,"../shapes/Circle":39,"../shapes/Convex":40,"../shapes/Shape":45,"../utils/ContactEquationPool":48,"../utils/FrictionEquationPool":49,"../utils/TupleDictionary":56,"../utils/Utils":57}],11:[function(t,e,i){function n(t){t=t||{},this.from=t.from?o.fromValues(t.from[0],t.from[1]):o.create(),this.to=t.to?o.fromValues(t.to[0],t.to[1]):o.create(),this.checkCollisionResponse=void 0!==t.checkCollisionResponse?t.checkCollisionResponse:!0,this.skipBackfaces=!!t.skipBackfaces,this.collisionMask=void 0!==t.collisionMask?t.collisionMask:-1,this.collisionGroup=void 0!==t.collisionGroup?t.collisionGroup:-1,this.mode=void 0!==t.mode?t.mode:n.ANY,this.callback=t.callback||function(t){},this.direction=o.create(),this.length=1,this.update()}function r(t,e,i){o.sub(s,i,t);var n=o.dot(s,e);return o.scale(c,e,n),o.add(c,c,t),o.squaredDistance(i,c)}e.exports=n;var o=t("../math/vec2");t("../collision/RaycastResult"),t("../shapes/Shape"),t("../collision/AABB");n.prototype.constructor=n,n.CLOSEST=1,n.ANY=2,n.ALL=4,n.prototype.update=function(){var t=this.direction;o.sub(t,this.to,this.from),this.length=o.length(t),o.normalize(t,t)},n.prototype.intersectBodies=function(t,e){for(var i=0,n=e.length;!t.shouldStop(this)&&n>i;i++){var r=e[i],o=r.getAABB();(o.overlapsRay(this)>=0||o.containsPoint(this.from))&&this.intersectBody(t,r)}};var a=o.create();n.prototype.intersectBody=function(t,e){var i=this.checkCollisionResponse;if(!i||e.collisionResponse)for(var n=a,r=0,s=e.shapes.length;s>r;r++){var c=e.shapes[r];if((!i||c.collisionResponse)&&0!==(this.collisionGroup&c.collisionMask)&&0!==(c.collisionGroup&this.collisionMask)){o.rotate(n,c.position,e.angle),o.add(n,n,e.position);var l=c.angle+e.angle;if(this.intersectShape(t,c,l,n,e),t.shouldStop(this))break}}},n.prototype.intersectShape=function(t,e,i,n,o){var a=this.from,s=r(a,this.direction,n);s>e.boundingRadius*e.boundingRadius||(this._currentBody=o,this._currentShape=e,e.raycast(t,this,n,i),this._currentBody=this._currentShape=null)},n.prototype.getAABB=function(t){var e=this.to,i=this.from;o.set(t.lowerBound,Math.min(e[0],i[0]),Math.min(e[1],i[1])),o.set(t.upperBound,Math.max(e[0],i[0]),Math.max(e[1],i[1]))};o.create();n.prototype.reportIntersection=function(t,e,i,r){var a=(this.from,this.to,this._currentShape),s=this._currentBody;if(!(this.skipBackfaces&&o.dot(i,this.direction)>0))switch(this.mode){case n.ALL:t.set(i,a,s,e,r),this.callback(t);break;case n.CLOSEST:(e<t.fraction||!t.hasHit())&&t.set(i,a,s,e,r);break;case n.ANY:t.set(i,a,s,e,r)}};var s=o.create(),c=o.create()},{"../collision/AABB":7,"../collision/RaycastResult":12,"../math/vec2":30,"../shapes/Shape":45}],12:[function(t,e,i){function n(){this.normal=r.create(),this.shape=null,this.body=null,this.faceIndex=-1,this.fraction=-1,this.isStopped=!1}var r=t("../math/vec2"),o=t("../collision/Ray");e.exports=n,n.prototype.reset=function(){r.set(this.normal,0,0),this.shape=null,this.body=null,this.faceIndex=-1,this.fraction=-1,this.isStopped=!1},n.prototype.getHitDistance=function(t){return r.distance(t.from,t.to)*this.fraction},n.prototype.hasHit=function(){return-1!==this.fraction},n.prototype.getHitPoint=function(t,e){r.lerp(t,e.from,e.to,this.fraction)},n.prototype.stop=function(){this.isStopped=!0},n.prototype.shouldStop=function(t){return this.isStopped||-1!==this.fraction&&t.mode===o.ANY},n.prototype.set=function(t,e,i,n,o){r.copy(this.normal,t),this.shape=e,this.body=i,this.fraction=n,this.faceIndex=o}},{"../collision/Ray":11,"../math/vec2":30}],13:[function(t,e,i){function n(){o.call(this,o.SAP),this.axisList=[],this.axisIndex=0;var t=this;this._addBodyHandler=function(e){t.axisList.push(e.body)},this._removeBodyHandler=function(e){var i=t.axisList.indexOf(e.body);-1!==i&&t.axisList.splice(i,1)}}var r=t("../utils/Utils"),o=t("../collision/Broadphase");e.exports=n,n.prototype=new o,n.prototype.constructor=n,n.prototype.setWorld=function(t){this.axisList.length=0,r.appendArray(this.axisList,t.bodies),t.off("addBody",this._addBodyHandler).off("removeBody",this._removeBodyHandler),t.on("addBody",this._addBodyHandler).on("removeBody",this._removeBodyHandler),this.world=t},n.sortAxisList=function(t,e){e=0|e;for(var i=1,n=t.length;n>i;i++){for(var r=t[i],o=i-1;o>=0&&!(t[o].aabb.lowerBound[e]<=r.aabb.lowerBound[e]);o--)t[o+1]=t[o];t[o+1]=r}return t},n.prototype.sortList=function(){var t=this.axisList,e=this.axisIndex;n.sortAxisList(t,e)},n.prototype.getCollisionPairs=function(t){var e=this.axisList,i=this.result,n=this.axisIndex;i.length=0;for(var r=e.length;r--;){var a=e[r];a.aabbNeedsUpdate&&a.updateAABB()}this.sortList();for(var s=0,c=0|e.length;s!==c;s++)for(var l=e[s],h=s+1;c>h;h++){var u=e[h],p=u.aabb.lowerBound[n]<=l.aabb.upperBound[n];if(!p)break;o.canCollide(l,u)&&this.boundingVolumeCheck(l,u)&&i.push(l,u)}return i},n.prototype.aabbQuery=function(t,e,i){i=i||[],this.sortList();var n=this.axisIndex,r="x";1===n&&(r="y"),2===n&&(r="z");for(var o=this.axisList,a=(e.lowerBound[r],e.upperBound[r],0);a<o.length;a++){var s=o[a];s.aabbNeedsUpdate&&s.updateAABB(),s.aabb.overlaps(e)&&i.push(s)}return i}},{"../collision/Broadphase":8,"../utils/Utils":57}],14:[function(t,e,i){function n(t,e,i,n){this.type=i,n=r.defaults(n,{collideConnected:!0,wakeUpBodies:!0}),this.equations=[],this.bodyA=t,this.bodyB=e,this.collideConnected=n.collideConnected,n.wakeUpBodies&&(t&&t.wakeUp(),e&&e.wakeUp())}e.exports=n;var r=t("../utils/Utils");n.prototype.update=function(){throw new Error("method update() not implmemented in this Constraint subclass!")},n.DISTANCE=1,n.GEAR=2,n.LOCK=3,n.PRISMATIC=4,n.REVOLUTE=5,n.prototype.setStiffness=function(t){for(var e=this.equations,i=0;i!==e.length;i++){var n=e[i];n.stiffness=t,n.needsUpdate=!0}},n.prototype.setRelaxation=function(t){for(var e=this.equations,i=0;i!==e.length;i++){var n=e[i];n.relaxation=t,n.needsUpdate=!0}}},{"../utils/Utils":57}],15:[function(t,e,i){function n(t,e,i){i=s.defaults(i,{localAnchorA:[0,0],localAnchorB:[0,0]}),r.call(this,t,e,r.DISTANCE,i),this.localAnchorA=a.fromValues(i.localAnchorA[0],i.localAnchorA[1]),this.localAnchorB=a.fromValues(i.localAnchorB[0],i.localAnchorB[1]);var n=this.localAnchorA,c=this.localAnchorB;if(this.distance=0,"number"==typeof i.distance)this.distance=i.distance;else{var l=a.create(),h=a.create(),u=a.create();a.rotate(l,n,t.angle),a.rotate(h,c,e.angle),a.add(u,e.position,h),a.sub(u,u,l),a.sub(u,u,t.position),this.distance=a.length(u)}var p;p="undefined"==typeof i.maxForce?Number.MAX_VALUE:i.maxForce;var d=new o(t,e,-p,p);this.equations=[d],this.maxForce=p;var u=a.create(),f=a.create(),v=a.create(),m=this;d.computeGq=function(){var t=this.bodyA,e=this.bodyB,i=t.position,r=e.position;return a.rotate(f,n,t.angle),a.rotate(v,c,e.angle),a.add(u,r,v),a.sub(u,u,f),a.sub(u,u,i),a.length(u)-m.distance},this.setMaxForce(p),this.upperLimitEnabled=!1,this.upperLimit=1,this.lowerLimitEnabled=!1,this.lowerLimit=0,this.position=0}var r=t("./Constraint"),o=t("../equations/Equation"),a=t("../math/vec2"),s=t("../utils/Utils");e.exports=n,n.prototype=new r,n.prototype.constructor=n;var c=a.create(),l=a.create(),h=a.create();n.prototype.update=function(){var t=this.equations[0],e=this.bodyA,i=this.bodyB,n=(this.distance,e.position),r=i.position,o=this.equations[0],s=t.G;a.rotate(l,this.localAnchorA,e.angle),a.rotate(h,this.localAnchorB,i.angle),a.add(c,r,h),a.sub(c,c,l),a.sub(c,c,n),this.position=a.length(c);var u=!1;if(this.upperLimitEnabled&&this.position>this.upperLimit&&(o.maxForce=0,o.minForce=-this.maxForce,this.distance=this.upperLimit,u=!0),this.lowerLimitEnabled&&this.position<this.lowerLimit&&(o.maxForce=this.maxForce,o.minForce=0,this.distance=this.lowerLimit,u=!0),(this.lowerLimitEnabled||this.upperLimitEnabled)&&!u)return void(o.enabled=!1);o.enabled=!0,a.normalize(c,c);var p=a.crossLength(l,c),d=a.crossLength(h,c);s[0]=-c[0],s[1]=-c[1],s[2]=-p,s[3]=c[0],s[4]=c[1],s[5]=d},n.prototype.setMaxForce=function(t){var e=this.equations[0];e.minForce=-t,e.maxForce=t},n.prototype.getMaxForce=function(){var t=this.equations[0];return t.maxForce}},{"../equations/Equation":22,"../math/vec2":30,"../utils/Utils":57,"./Constraint":14}],16:[function(t,e,i){function n(t,e,i){i=i||{},r.call(this,t,e,r.GEAR,i),this.ratio=void 0!==i.ratio?i.ratio:1,this.angle=void 0!==i.angle?i.angle:e.angle-this.ratio*t.angle,i.angle=this.angle,i.ratio=this.ratio,this.equations=[new o(t,e,i)],void 0!==i.maxTorque&&this.setMaxTorque(i.maxTorque)}var r=t("./Constraint"),o=(t("../equations/Equation"),t("../equations/AngleLockEquation"));t("../math/vec2");e.exports=n,n.prototype=new r,n.prototype.constructor=n,n.prototype.update=function(){var t=this.equations[0];t.ratio!==this.ratio&&t.setRatio(this.ratio),t.angle=this.angle},n.prototype.setMaxTorque=function(t){this.equations[0].setMaxTorque(t)},n.prototype.getMaxTorque=function(t){return this.equations[0].maxForce}},{"../equations/AngleLockEquation":20,"../equations/Equation":22,"../math/vec2":30,"./Constraint":14}],17:[function(t,e,i){function n(t,e,i){i=i||{},r.call(this,t,e,r.LOCK,i);var n="undefined"==typeof i.maxForce?Number.MAX_VALUE:i.maxForce,s=(i.localAngleB||0,new a(t,e,-n,n)),c=new a(t,e,-n,n),l=new a(t,e,-n,n),h=o.create(),u=o.create(),p=this;s.computeGq=function(){return o.rotate(h,p.localOffsetB,t.angle),o.sub(u,e.position,t.position),o.sub(u,u,h),u[0]},c.computeGq=function(){return o.rotate(h,p.localOffsetB,t.angle),o.sub(u,e.position,t.position),o.sub(u,u,h),u[1]};var d=o.create(),f=o.create();l.computeGq=function(){return o.rotate(d,p.localOffsetB,e.angle-p.localAngleB),o.scale(d,d,-1),o.sub(u,t.position,e.position),o.add(u,u,d),o.rotate(f,d,-Math.PI/2),o.normalize(f,f),o.dot(u,f)},this.localOffsetB=o.create(),i.localOffsetB?o.copy(this.localOffsetB,i.localOffsetB):(o.sub(this.localOffsetB,e.position,t.position),o.rotate(this.localOffsetB,this.localOffsetB,-t.angle)),this.localAngleB=0,"number"==typeof i.localAngleB?this.localAngleB=i.localAngleB:this.localAngleB=e.angle-t.angle,this.equations.push(s,c,l),this.setMaxForce(n)}var r=t("./Constraint"),o=t("../math/vec2"),a=t("../equations/Equation");e.exports=n,n.prototype=new r,n.prototype.constructor=n,n.prototype.setMaxForce=function(t){for(var e=this.equations,i=0;i<this.equations.length;i++)e[i].maxForce=t,e[i].minForce=-t},n.prototype.getMaxForce=function(){return this.equations[0].maxForce};var s=o.create(),c=o.create(),l=o.create(),h=o.fromValues(1,0),u=o.fromValues(0,1);n.prototype.update=function(){var t=this.equations[0],e=this.equations[1],i=this.equations[2],n=this.bodyA,r=this.bodyB;o.rotate(s,this.localOffsetB,n.angle),o.rotate(c,this.localOffsetB,r.angle-this.localAngleB),o.scale(c,c,-1),o.rotate(l,c,Math.PI/2),o.normalize(l,l),t.G[0]=-1,t.G[1]=0,t.G[2]=-o.crossLength(s,h),t.G[3]=1,e.G[0]=0,e.G[1]=-1,e.G[2]=-o.crossLength(s,u),e.G[4]=1,i.G[0]=-l[0],i.G[1]=-l[1],i.G[3]=l[0],i.G[4]=l[1],i.G[5]=o.crossLength(c,l)}},{"../equations/Equation":22,"../math/vec2":30,"./Constraint":14}],18:[function(t,e,i){function n(t,e,i){i=i||{},r.call(this,t,e,r.PRISMATIC,i);var n=s.fromValues(0,0),l=s.fromValues(1,0),h=s.fromValues(0,0);i.localAnchorA&&s.copy(n,i.localAnchorA),i.localAxisA&&s.copy(l,i.localAxisA),i.localAnchorB&&s.copy(h,i.localAnchorB),this.localAnchorA=n,this.localAnchorB=h,this.localAxisA=l;var u=this.maxForce="undefined"!=typeof i.maxForce?i.maxForce:Number.MAX_VALUE,p=new a(t,e,-u,u),d=new s.create,f=new s.create,v=new s.create,m=new s.create;if(p.computeGq=function(){return s.dot(v,m)},p.updateJacobian=function(){var i=this.G,r=t.position,o=e.position;s.rotate(d,n,t.angle),s.rotate(f,h,e.angle),s.add(v,o,f),s.sub(v,v,r),s.sub(v,v,d),s.rotate(m,l,t.angle+Math.PI/2),i[0]=-m[0],i[1]=-m[1],i[2]=-s.crossLength(d,m)+s.crossLength(m,v),i[3]=m[0],i[4]=m[1],i[5]=s.crossLength(f,m)},this.equations.push(p),!i.disableRotationalLock){var g=new c(t,e,-u,u);this.equations.push(g)}this.position=0,this.velocity=0,this.lowerLimitEnabled="undefined"!=typeof i.lowerLimit?!0:!1,this.upperLimitEnabled="undefined"!=typeof i.upperLimit?!0:!1,this.lowerLimit="undefined"!=typeof i.lowerLimit?i.lowerLimit:0,this.upperLimit="undefined"!=typeof i.upperLimit?i.upperLimit:1,this.upperLimitEquation=new o(t,e),this.lowerLimitEquation=new o(t,e),this.upperLimitEquation.minForce=this.lowerLimitEquation.minForce=0,this.upperLimitEquation.maxForce=this.lowerLimitEquation.maxForce=u,this.motorEquation=new a(t,e),this.motorEnabled=!1,this.motorSpeed=0;var y=this,b=this.motorEquation;b.computeGW;b.computeGq=function(){return 0},b.computeGW=function(){var t=this.G,e=this.bodyA,i=this.bodyB,n=e.velocity,r=i.velocity,o=e.angularVelocity,a=i.angularVelocity;return this.gmult(t,n,o,r,a)+y.motorSpeed}}var r=t("./Constraint"),o=t("../equations/ContactEquation"),a=t("../equations/Equation"),s=t("../math/vec2"),c=t("../equations/RotationalLockEquation");e.exports=n,n.prototype=new r,n.prototype.constructor=n;var l=s.create(),h=s.create(),u=s.create(),p=s.create(),d=s.create(),f=s.create();n.prototype.update=function(){var t=this.equations,e=t[0],i=this.upperLimit,n=this.lowerLimit,r=this.upperLimitEquation,o=this.lowerLimitEquation,a=this.bodyA,c=this.bodyB,v=this.localAxisA,m=this.localAnchorA,g=this.localAnchorB;e.updateJacobian(),s.rotate(l,v,a.angle),s.rotate(p,m,a.angle),s.add(h,p,a.position),s.rotate(d,g,c.angle),s.add(u,d,c.position);var y=this.position=s.dot(u,l)-s.dot(h,l);if(this.motorEnabled){var b=this.motorEquation.G;b[0]=l[0],b[1]=l[1],b[2]=s.crossLength(l,d),b[3]=-l[0],b[4]=-l[1],b[5]=-s.crossLength(l,p)}if(this.upperLimitEnabled&&y>i)s.scale(r.normalA,l,-1),s.sub(r.contactPointA,h,a.position),s.sub(r.contactPointB,u,c.position),s.scale(f,l,i),s.add(r.contactPointA,r.contactPointA,f),-1===t.indexOf(r)&&t.push(r);else{var A=t.indexOf(r);-1!==A&&t.splice(A,1)}if(this.lowerLimitEnabled&&n>y)s.scale(o.normalA,l,1),s.sub(o.contactPointA,h,a.position),s.sub(o.contactPointB,u,c.position),s.scale(f,l,n),s.sub(o.contactPointB,o.contactPointB,f),-1===t.indexOf(o)&&t.push(o);else{var A=t.indexOf(o);-1!==A&&t.splice(A,1)}},n.prototype.enableMotor=function(){this.motorEnabled||(this.equations.push(this.motorEquation),this.motorEnabled=!0)},n.prototype.disableMotor=function(){if(this.motorEnabled){var t=this.equations.indexOf(this.motorEquation);this.equations.splice(t,1),this.motorEnabled=!1}},n.prototype.setLimits=function(t,e){"number"==typeof t?(this.lowerLimit=t,this.lowerLimitEnabled=!0):(this.lowerLimit=t,this.lowerLimitEnabled=!1),"number"==typeof e?(this.upperLimit=e,this.upperLimitEnabled=!0):(this.upperLimit=e,this.upperLimitEnabled=!1)}},{"../equations/ContactEquation":21,"../equations/Equation":22,"../equations/RotationalLockEquation":24,"../math/vec2":30,"./Constraint":14}],19:[function(t,e,i){function n(t,e,i){i=i||{},r.call(this,t,e,r.REVOLUTE,i);var n=this.maxForce="undefined"!=typeof i.maxForce?i.maxForce:Number.MAX_VALUE;this.pivotA=c.create(),this.pivotB=c.create(),i.worldPivot?(c.sub(this.pivotA,i.worldPivot,t.position),c.sub(this.pivotB,i.worldPivot,e.position),c.rotate(this.pivotA,this.pivotA,-t.angle),c.rotate(this.pivotB,this.pivotB,-e.angle)):(c.copy(this.pivotA,i.localPivotA),c.copy(this.pivotB,i.localPivotB));var f=this.equations=[new o(t,e,-n,n),new o(t,e,-n,n)],v=f[0],m=f[1],g=this;v.computeGq=function(){return c.rotate(l,g.pivotA,t.angle),c.rotate(h,g.pivotB,e.angle),c.add(d,e.position,h),c.sub(d,d,t.position),c.sub(d,d,l),c.dot(d,u)},m.computeGq=function(){return c.rotate(l,g.pivotA,t.angle),c.rotate(h,g.pivotB,e.angle),c.add(d,e.position,h),c.sub(d,d,t.position),c.sub(d,d,l),c.dot(d,p)},m.minForce=v.minForce=-n,m.maxForce=v.maxForce=n,this.motorEquation=new a(t,e),this.motorEnabled=!1,this.angle=0,this.lowerLimitEnabled=!1,this.upperLimitEnabled=!1,this.lowerLimit=0,this.upperLimit=0,this.upperLimitEquation=new s(t,e),this.lowerLimitEquation=new s(t,e),this.upperLimitEquation.minForce=0,this.lowerLimitEquation.maxForce=0}var r=t("./Constraint"),o=t("../equations/Equation"),a=t("../equations/RotationalVelocityEquation"),s=t("../equations/RotationalLockEquation"),c=t("../math/vec2");e.exports=n;var l=c.create(),h=c.create(),u=c.fromValues(1,0),p=c.fromValues(0,1),d=c.create();n.prototype=new r,n.prototype.constructor=n,n.prototype.setLimits=function(t,e){"number"==typeof t?(this.lowerLimit=t,this.lowerLimitEnabled=!0):(this.lowerLimit=t,this.lowerLimitEnabled=!1),"number"==typeof e?(this.upperLimit=e,this.upperLimitEnabled=!0):(this.upperLimit=e,this.upperLimitEnabled=!1)},n.prototype.update=function(){var t=this.bodyA,e=this.bodyB,i=this.pivotA,n=this.pivotB,r=this.equations,o=(r[0],r[1],r[0]),a=r[1],s=this.upperLimit,d=this.lowerLimit,f=this.upperLimitEquation,v=this.lowerLimitEquation,m=this.angle=e.angle-t.angle;if(this.upperLimitEnabled&&m>s)f.angle=s,-1===r.indexOf(f)&&r.push(f);else{var g=r.indexOf(f);-1!==g&&r.splice(g,1)}if(this.lowerLimitEnabled&&d>m)v.angle=d,-1===r.indexOf(v)&&r.push(v);else{var g=r.indexOf(v);-1!==g&&r.splice(g,1)}c.rotate(l,i,t.angle),c.rotate(h,n,e.angle),o.G[0]=-1,o.G[1]=0,o.G[2]=-c.crossLength(l,u),o.G[3]=1,o.G[4]=0,o.G[5]=c.crossLength(h,u),a.G[0]=0,a.G[1]=-1,a.G[2]=-c.crossLength(l,p),a.G[3]=0,a.G[4]=1,a.G[5]=c.crossLength(h,p)},n.prototype.enableMotor=function(){this.motorEnabled||(this.equations.push(this.motorEquation),this.motorEnabled=!0)},n.prototype.disableMotor=function(){if(this.motorEnabled){var t=this.equations.indexOf(this.motorEquation);this.equations.splice(t,1),this.motorEnabled=!1}},n.prototype.motorIsEnabled=function(){return!!this.motorEnabled},n.prototype.setMotorSpeed=function(t){if(this.motorEnabled){var e=this.equations.indexOf(this.motorEquation);this.equations[e].relativeVelocity=t}},n.prototype.getMotorSpeed=function(){return this.motorEnabled?this.motorEquation.relativeVelocity:!1}},{"../equations/Equation":22,"../equations/RotationalLockEquation":24,"../equations/RotationalVelocityEquation":25,"../math/vec2":30,"./Constraint":14}],20:[function(t,e,i){function n(t,e,i){i=i||{},r.call(this,t,e,-Number.MAX_VALUE,Number.MAX_VALUE),this.angle=i.angle||0,this.ratio="number"==typeof i.ratio?i.ratio:1,this.setRatio(this.ratio)}var r=t("./Equation");t("../math/vec2");e.exports=n,n.prototype=new r,n.prototype.constructor=n,n.prototype.computeGq=function(){return this.ratio*this.bodyA.angle-this.bodyB.angle+this.angle},n.prototype.setRatio=function(t){var e=this.G;e[2]=t,e[5]=-1,this.ratio=t},n.prototype.setMaxTorque=function(t){this.maxForce=t,this.minForce=-t}},{"../math/vec2":30,"./Equation":22}],21:[function(t,e,i){function n(t,e){r.call(this,t,e,0,Number.MAX_VALUE),this.contactPointA=o.create(),this.penetrationVec=o.create(),this.contactPointB=o.create(),this.normalA=o.create(),this.restitution=0,this.firstImpact=!1,this.shapeA=null,this.shapeB=null}var r=t("./Equation"),o=t("../math/vec2");e.exports=n,n.prototype=new r,n.prototype.constructor=n,n.prototype.computeB=function(t,e,i){var n=this.bodyA,r=this.bodyB,a=this.contactPointA,s=this.contactPointB,c=n.position,l=r.position,h=this.penetrationVec,u=this.normalA,p=this.G,d=o.crossLength(a,u),f=o.crossLength(s,u);p[0]=-u[0],p[1]=-u[1],p[2]=-d,p[3]=u[0],p[4]=u[1],p[5]=f,o.add(h,l,s),o.sub(h,h,c),o.sub(h,h,a);var v,m;this.firstImpact&&0!==this.restitution?(m=0,v=1/e*(1+this.restitution)*this.computeGW()):(m=o.dot(u,h)+this.offset,v=this.computeGW());var g=this.computeGiMf(),y=-m*t-v*e-i*g;return y};var a=o.create(),s=o.create(),c=o.create();n.prototype.getVelocityAlongNormal=function(){return this.bodyA.getVelocityAtPoint(a,this.contactPointA),this.bodyB.getVelocityAtPoint(s,this.contactPointB),o.subtract(c,a,s),o.dot(this.normalA,c)}},{"../math/vec2":30,"./Equation":22}],22:[function(t,e,i){function n(t,e,i,r){this.minForce="undefined"==typeof i?-Number.MAX_VALUE:i,this.maxForce="undefined"==typeof r?Number.MAX_VALUE:r,this.bodyA=t,this.bodyB=e,this.stiffness=n.DEFAULT_STIFFNESS,this.relaxation=n.DEFAULT_RELAXATION,this.G=new o.ARRAY_TYPE(6);for(var a=0;6>a;a++)this.G[a]=0;this.offset=0,this.a=0,this.b=0,this.epsilon=0,this.timeStep=1/60,this.needsUpdate=!0,this.multiplier=0,this.relativeVelocity=0,this.enabled=!0}e.exports=n;var r=t("../math/vec2"),o=t("../utils/Utils");t("../objects/Body");n.prototype.constructor=n,n.DEFAULT_STIFFNESS=1e6,n.DEFAULT_RELAXATION=4,n.prototype.update=function(){var t=this.stiffness,e=this.relaxation,i=this.timeStep;this.a=4/(i*(1+4*e)),this.b=4*e/(1+4*e),this.epsilon=4/(i*i*t*(1+4*e)),this.needsUpdate=!1},n.prototype.gmult=function(t,e,i,n,r){return t[0]*e[0]+t[1]*e[1]+t[2]*i+t[3]*n[0]+t[4]*n[1]+t[5]*r},n.prototype.computeB=function(t,e,i){var n=this.computeGW(),r=this.computeGq(),o=this.computeGiMf();return-r*t-n*e-o*i};var a=r.create(),s=r.create();n.prototype.computeGq=function(){var t=this.G,e=this.bodyA,i=this.bodyB,n=(e.position,i.position,e.angle),r=i.angle;return this.gmult(t,a,n,s,r)+this.offset},n.prototype.computeGW=function(){var t=this.G,e=this.bodyA,i=this.bodyB,n=e.velocity,r=i.velocity,o=e.angularVelocity,a=i.angularVelocity;return this.gmult(t,n,o,r,a)+this.relativeVelocity},n.prototype.computeGWlambda=function(){var t=this.G,e=this.bodyA,i=this.bodyB,n=e.vlambda,r=i.vlambda,o=e.wlambda,a=i.wlambda;return this.gmult(t,n,o,r,a)};var c=r.create(),l=r.create();n.prototype.computeGiMf=function(){var t=this.bodyA,e=this.bodyB,i=t.force,n=t.angularForce,o=e.force,a=e.angularForce,s=t.invMassSolve,h=e.invMassSolve,u=t.invInertiaSolve,p=e.invInertiaSolve,d=this.G;return r.scale(c,i,s),r.multiply(c,t.massMultiplier,c),r.scale(l,o,h),r.multiply(l,e.massMultiplier,l),this.gmult(d,c,n*u,l,a*p)},n.prototype.computeGiMGt=function(){var t=this.bodyA,e=this.bodyB,i=t.invMassSolve,n=e.invMassSolve,r=t.invInertiaSolve,o=e.invInertiaSolve,a=this.G;return a[0]*a[0]*i*t.massMultiplier[0]+a[1]*a[1]*i*t.massMultiplier[1]+a[2]*a[2]*r+a[3]*a[3]*n*e.massMultiplier[0]+a[4]*a[4]*n*e.massMultiplier[1]+a[5]*a[5]*o};var h=r.create(),u=r.create(),p=r.create();r.create(),r.create(),r.create();n.prototype.addToWlambda=function(t){var e=this.bodyA,i=this.bodyB,n=h,o=u,a=p,s=e.invMassSolve,c=i.invMassSolve,l=e.invInertiaSolve,d=i.invInertiaSolve,f=this.G;o[0]=f[0],o[1]=f[1],a[0]=f[3],a[1]=f[4],r.scale(n,o,s*t),r.multiply(n,n,e.massMultiplier),r.add(e.vlambda,e.vlambda,n),e.wlambda+=l*f[2]*t,r.scale(n,a,c*t),r.multiply(n,n,i.massMultiplier),r.add(i.vlambda,i.vlambda,n),i.wlambda+=d*f[5]*t},n.prototype.computeInvC=function(t){return 1/(this.computeGiMGt()+t)}},{"../math/vec2":30,"../objects/Body":31,"../utils/Utils":57}],23:[function(t,e,i){function n(t,e,i){o.call(this,t,e,-i,i),this.contactPointA=r.create(),this.contactPointB=r.create(),this.t=r.create(),this.contactEquations=[],this.shapeA=null,this.shapeB=null,this.frictionCoefficient=.3}var r=t("../math/vec2"),o=t("./Equation");t("../utils/Utils");e.exports=n,n.prototype=new o,n.prototype.constructor=n,n.prototype.setSlipForce=function(t){this.maxForce=t,this.minForce=-t},n.prototype.getSlipForce=function(){return this.maxForce},n.prototype.computeB=function(t,e,i){var n=(this.bodyA,this.bodyB,this.contactPointA),o=this.contactPointB,a=this.t,s=this.G;s[0]=-a[0],s[1]=-a[1],s[2]=-r.crossLength(n,a),s[3]=a[0],s[4]=a[1],s[5]=r.crossLength(o,a);var c=this.computeGW(),l=this.computeGiMf(),h=-c*e-i*l;return h}},{"../math/vec2":30,"../utils/Utils":57,"./Equation":22}],24:[function(t,e,i){function n(t,e,i){i=i||{},r.call(this,t,e,-Number.MAX_VALUE,Number.MAX_VALUE),this.angle=i.angle||0;var n=this.G;n[2]=1,n[5]=-1}var r=t("./Equation"),o=t("../math/vec2");e.exports=n,n.prototype=new r,n.prototype.constructor=n;var a=o.create(),s=o.create(),c=o.fromValues(1,0),l=o.fromValues(0,1);n.prototype.computeGq=function(){return o.rotate(a,c,this.bodyA.angle+this.angle),o.rotate(s,l,this.bodyB.angle),o.dot(a,s)}},{"../math/vec2":30,"./Equation":22}],25:[function(t,e,i){function n(t,e){r.call(this,t,e,-Number.MAX_VALUE,Number.MAX_VALUE),this.relativeVelocity=1,this.ratio=1}var r=t("./Equation");t("../math/vec2");e.exports=n,n.prototype=new r,n.prototype.constructor=n,n.prototype.computeB=function(t,e,i){var n=this.G;n[2]=-1,n[5]=this.ratio;var r=this.computeGiMf(),o=this.computeGW(),a=-o*e-i*r;return a}},{"../math/vec2":30,"./Equation":22}],26:[function(t,e,i){var n=function(){};e.exports=n,n.prototype={constructor:n,on:function(t,e,i){e.context=i||this,void 0===this._listeners&&(this._listeners={});var n=this._listeners;return void 0===n[t]&&(n[t]=[]),-1===n[t].indexOf(e)&&n[t].push(e),this},has:function(t,e){if(void 0===this._listeners)return!1;var i=this._listeners;if(e){if(void 0!==i[t]&&-1!==i[t].indexOf(e))return!0}else if(void 0!==i[t])return!0;return!1},off:function(t,e){if(void 0===this._listeners)return this;var i=this._listeners,n=i[t].indexOf(e);return-1!==n&&i[t].splice(n,1),this},emit:function(t){if(void 0===this._listeners)return this;var e=this._listeners,i=e[t.type];if(void 0!==i){t.target=this;for(var n=0,r=i.length;r>n;n++){var o=i[n];o.call(o.context,t)}}return this}}},{}],27:[function(t,e,i){function n(t,e,i){if(i=i||{},!(t instanceof r&&e instanceof r))throw new Error("First two arguments must be Material instances.");this.id=n.idCounter++,this.materialA=t,this.materialB=e,this.friction="undefined"!=typeof i.friction?Number(i.friction):.3,this.restitution="undefined"!=typeof i.restitution?Number(i.restitution):0,this.stiffness="undefined"!=typeof i.stiffness?Number(i.stiffness):o.DEFAULT_STIFFNESS,this.relaxation="undefined"!=typeof i.relaxation?Number(i.relaxation):o.DEFAULT_RELAXATION,this.frictionStiffness="undefined"!=typeof i.frictionStiffness?Number(i.frictionStiffness):o.DEFAULT_STIFFNESS,this.frictionRelaxation="undefined"!=typeof i.frictionRelaxation?Number(i.frictionRelaxation):o.DEFAULT_RELAXATION,this.surfaceVelocity="undefined"!=typeof i.surfaceVelocity?Number(i.surfaceVelocity):0,this.contactSkinSize=.005}var r=t("./Material"),o=t("../equations/Equation");e.exports=n,n.idCounter=0},{"../equations/Equation":22,"./Material":28}],28:[function(t,e,i){function n(t){this.id=t||n.idCounter++}e.exports=n,n.idCounter=0},{}],29:[function(t,e,i){var n={};n.GetArea=function(t){if(t.length<6)return 0;for(var e=t.length-2,i=0,n=0;e>n;n+=2)i+=(t[n+2]-t[n])*(t[n+1]+t[n+3]);return i+=(t[0]-t[e])*(t[e+1]+t[1]),.5*-i},n.Triangulate=function(t){var e=t.length>>1;if(3>e)return[];for(var i=[],r=[],o=0;e>o;o++)r.push(o);for(var o=0,a=e;a>3;){var s=r[(o+0)%a],c=r[(o+1)%a],l=r[(o+2)%a],h=t[2*s],u=t[2*s+1],p=t[2*c],d=t[2*c+1],f=t[2*l],v=t[2*l+1],m=!1;if(n._convex(h,u,p,d,f,v)){m=!0;for(var g=0;a>g;g++){var y=r[g];if(y!=s&&y!=c&&y!=l&&n._PointInTriangle(t[2*y],t[2*y+1],h,u,p,d,f,v)){m=!1;break}}}if(m)i.push(s,c,l),r.splice((o+1)%a,1),a--,o=0;else if(o++>3*a)break}return i.push(r[0],r[1],r[2]),i},n._PointInTriangle=function(t,e,i,n,r,o,a,s){var c=a-i,l=s-n,h=r-i,u=o-n,p=t-i,d=e-n,f=c*c+l*l,v=c*h+l*u,m=c*p+l*d,g=h*h+u*u,y=h*p+u*d,b=1/(f*g-v*v),A=(g*m-v*y)*b,_=(f*y-v*m)*b;return A>=0&&_>=0&&1>A+_},n._convex=function(t,e,i,n,r,o){return(e-n)*(r-i)+(i-t)*(o-n)>=0},e.exports=n},{}],30:[function(t,e,i){var n=e.exports={},r=t("../utils/Utils");n.crossLength=function(t,e){return t[0]*e[1]-t[1]*e[0]},n.crossVZ=function(t,e,i){return n.rotate(t,e,-Math.PI/2),n.scale(t,t,i),t},n.crossZV=function(t,e,i){return n.rotate(t,i,Math.PI/2),n.scale(t,t,e),t},n.rotate=function(t,e,i){if(0!==i){var n=Math.cos(i),r=Math.sin(i),o=e[0],a=e[1];t[0]=n*o-r*a,t[1]=r*o+n*a}else t[0]=e[0],t[1]=e[1]},n.rotate90cw=function(t,e){var i=e[0],n=e[1];t[0]=n,t[1]=-i},n.toLocalFrame=function(t,e,i,r){n.copy(t,e),n.sub(t,t,i),n.rotate(t,t,-r)},n.toGlobalFrame=function(t,e,i,r){n.copy(t,e),n.rotate(t,t,r),n.add(t,t,i)},n.vectorToLocalFrame=function(t,e,i){n.rotate(t,e,-i)},n.vectorToGlobalFrame=function(t,e,i){n.rotate(t,e,i)},n.centroid=function(t,e,i,r){return n.add(t,e,i),n.add(t,t,r),n.scale(t,t,1/3),t},n.create=function(){var t=new r.ARRAY_TYPE(2);return t[0]=0,t[1]=0,t},n.clone=function(t){var e=new r.ARRAY_TYPE(2);return e[0]=t[0],e[1]=t[1],e},n.fromValues=function(t,e){var i=new r.ARRAY_TYPE(2);return i[0]=t,i[1]=e,i},n.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t},n.set=function(t,e,i){return t[0]=e,t[1]=i,t},n.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t},n.subtract=function(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t},n.sub=n.subtract,n.multiply=function(t,e,i){return t[0]=e[0]*i[0],t[1]=e[1]*i[1],t},n.mul=n.multiply,n.divide=function(t,e,i){return t[0]=e[0]/i[0],t[1]=e[1]/i[1],t},n.div=n.divide,n.scale=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t},n.distance=function(t,e){var i=e[0]-t[0],n=e[1]-t[1];return Math.sqrt(i*i+n*n)},n.dist=n.distance,n.squaredDistance=function(t,e){var i=e[0]-t[0],n=e[1]-t[1];return i*i+n*n},n.sqrDist=n.squaredDistance,n.length=function(t){var e=t[0],i=t[1];return Math.sqrt(e*e+i*i)},n.len=n.length,n.squaredLength=function(t){var e=t[0],i=t[1];return e*e+i*i},n.sqrLen=n.squaredLength,n.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t},n.normalize=function(t,e){var i=e[0],n=e[1],r=i*i+n*n;
return r>0&&(r=1/Math.sqrt(r),t[0]=e[0]*r,t[1]=e[1]*r),t},n.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]},n.str=function(t){return"vec2("+t[0]+", "+t[1]+")"},n.lerp=function(t,e,i,n){var r=e[0],o=e[1];return t[0]=r+n*(i[0]-r),t[1]=o+n*(i[1]-o),t},n.reflect=function(t,e,i){var n=e[0]*i[0]+e[1]*i[1];t[0]=e[0]-2*i[0]*n,t[1]=e[1]-2*i[1]*n},n.getLineSegmentsIntersection=function(t,e,i,r,o){var a=n.getLineSegmentsIntersectionFraction(e,i,r,o);return 0>a?!1:(t[0]=e[0]+a*(i[0]-e[0]),t[1]=e[1]+a*(i[1]-e[1]),!0)},n.getLineSegmentsIntersectionFraction=function(t,e,i,n){var r,o,a=e[0]-t[0],s=e[1]-t[1],c=n[0]-i[0],l=n[1]-i[1];return r=(-s*(t[0]-i[0])+a*(t[1]-i[1]))/(-c*s+a*l),o=(c*(t[1]-i[1])-l*(t[0]-i[0]))/(-c*s+a*l),r>=0&&1>=r&&o>=0&&1>=o?o:-1}},{"../utils/Utils":57}],31:[function(t,e,i){function n(t){t=t||{},h.call(this),this.id=t.id||++n._idCounter,this.world=null,this.shapes=[],this.mass=t.mass||0,this.invMass=0,this.inertia=0,this.invInertia=0,this.invMassSolve=0,this.invInertiaSolve=0,this.fixedRotation=!!t.fixedRotation,this.fixedX=!!t.fixedX,this.fixedY=!!t.fixedY,this.massMultiplier=r.create(),this.position=r.fromValues(0,0),t.position&&r.copy(this.position,t.position),this.interpolatedPosition=r.fromValues(0,0),this.interpolatedAngle=0,this.previousPosition=r.fromValues(0,0),this.previousAngle=0,this.velocity=r.fromValues(0,0),t.velocity&&r.copy(this.velocity,t.velocity),this.vlambda=r.fromValues(0,0),this.wlambda=0,this.angle=t.angle||0,this.angularVelocity=t.angularVelocity||0,this.force=r.create(),t.force&&r.copy(this.force,t.force),this.angularForce=t.angularForce||0,this.damping="number"==typeof t.damping?t.damping:.1,this.angularDamping="number"==typeof t.angularDamping?t.angularDamping:.1,this.type=n.STATIC,"undefined"!=typeof t.type?this.type=t.type:t.mass?this.type=n.DYNAMIC:this.type=n.STATIC,this.boundingRadius=0,this.aabb=new l,this.aabbNeedsUpdate=!0,this.allowSleep=void 0!==t.allowSleep?t.allowSleep:!0,this.wantsToSleep=!1,this.sleepState=n.AWAKE,this.sleepSpeedLimit=void 0!==t.sleepSpeedLimit?t.sleepSpeedLimit:.2,this.sleepTimeLimit=void 0!==t.sleepTimeLimit?t.sleepTimeLimit:1,this.gravityScale=void 0!==t.gravityScale?t.gravityScale:1,this.collisionResponse=void 0!==t.collisionResponse?t.collisionResponse:!0,this.idleTime=0,this.timeLastSleepy=0,this.ccdSpeedThreshold=void 0!==t.ccdSpeedThreshold?t.ccdSpeedThreshold:-1,this.ccdIterations=void 0!==t.ccdIterations?t.ccdIterations:10,this.concavePath=null,this._wakeUpAfterNarrowphase=!1,this.updateMassProperties()}var r=t("../math/vec2"),o=t("poly-decomp"),a=t("../shapes/Convex"),s=t("../collision/RaycastResult"),c=t("../collision/Ray"),l=t("../collision/AABB"),h=t("../events/EventEmitter");e.exports=n,n.prototype=new h,n.prototype.constructor=n,n._idCounter=0,n.prototype.updateSolveMassProperties=function(){this.sleepState===n.SLEEPING||this.type===n.KINEMATIC?(this.invMassSolve=0,this.invInertiaSolve=0):(this.invMassSolve=this.invMass,this.invInertiaSolve=this.invInertia)},n.prototype.setDensity=function(t){var e=this.getArea();this.mass=e*t,this.updateMassProperties()},n.prototype.getArea=function(){for(var t=0,e=0;e<this.shapes.length;e++)t+=this.shapes[e].area;return t},n.prototype.getAABB=function(){return this.aabbNeedsUpdate&&this.updateAABB(),this.aabb};var u=new l,p=r.create();n.prototype.updateAABB=function(){for(var t=this.shapes,e=t.length,i=p,n=this.angle,o=0;o!==e;o++){var a=t[o],s=a.angle+n;r.rotate(i,a.position,n),r.add(i,i,this.position),a.computeAABB(u,i,s),0===o?this.aabb.copy(u):this.aabb.extend(u)}this.aabbNeedsUpdate=!1},n.prototype.updateBoundingRadius=function(){for(var t=this.shapes,e=t.length,i=0,n=0;n!==e;n++){var o=t[n],a=r.length(o.position),s=o.boundingRadius;a+s>i&&(i=a+s)}this.boundingRadius=i},n.prototype.addShape=function(t,e,i){if(t.body)throw new Error("A shape can only be added to one body.");t.body=this,e?r.copy(t.position,e):r.set(t.position,0,0),t.angle=i||0,this.shapes.push(t),this.updateMassProperties(),this.updateBoundingRadius(),this.aabbNeedsUpdate=!0},n.prototype.removeShape=function(t){var e=this.shapes.indexOf(t);return-1!==e?(this.shapes.splice(e,1),this.aabbNeedsUpdate=!0,t.body=null,!0):!1},n.prototype.updateMassProperties=function(){if(this.type===n.STATIC||this.type===n.KINEMATIC)this.mass=Number.MAX_VALUE,this.invMass=0,this.inertia=Number.MAX_VALUE,this.invInertia=0;else{var t=this.shapes,e=t.length,i=this.mass/e,o=0;if(this.fixedRotation)this.inertia=Number.MAX_VALUE,this.invInertia=0;else{for(var a=0;e>a;a++){var s=t[a],c=r.squaredLength(s.position),l=s.computeMomentOfInertia(i);o+=l+i*c}this.inertia=o,this.invInertia=o>0?1/o:0}this.invMass=1/this.mass,r.set(this.massMultiplier,this.fixedX?0:1,this.fixedY?0:1)}};r.create();n.prototype.applyForce=function(t,e){if(r.add(this.force,this.force,t),e){var i=r.crossLength(e,t);this.angularForce+=i}};var d=r.create(),f=r.create(),v=r.create();n.prototype.applyForceLocal=function(t,e){e=e||v;var i=d,n=f;this.vectorToWorldFrame(i,t),this.vectorToWorldFrame(n,e),this.applyForce(i,n)};var m=r.create();n.prototype.applyImpulse=function(t,e){if(this.type===n.DYNAMIC){var i=m;if(r.scale(i,t,this.invMass),r.multiply(i,this.massMultiplier,i),r.add(this.velocity,i,this.velocity),e){var o=r.crossLength(e,t);o*=this.invInertia,this.angularVelocity+=o}}};var g=r.create(),y=r.create(),b=r.create();n.prototype.applyImpulseLocal=function(t,e){e=e||b;var i=g,n=y;this.vectorToWorldFrame(i,t),this.vectorToWorldFrame(n,e),this.applyImpulse(i,n)},n.prototype.toLocalFrame=function(t,e){r.toLocalFrame(t,e,this.position,this.angle)},n.prototype.toWorldFrame=function(t,e){r.toGlobalFrame(t,e,this.position,this.angle)},n.prototype.vectorToLocalFrame=function(t,e){r.vectorToLocalFrame(t,e,this.angle)},n.prototype.vectorToWorldFrame=function(t,e){r.vectorToGlobalFrame(t,e,this.angle)},n.prototype.fromPolygon=function(t,e){e=e||{};for(var i=this.shapes.length;i>=0;--i)this.removeShape(this.shapes[i]);var n=new o.Polygon;if(n.vertices=t,n.makeCCW(),"number"==typeof e.removeCollinearPoints&&n.removeCollinearPoints(e.removeCollinearPoints),"undefined"==typeof e.skipSimpleCheck&&!n.isSimple())return!1;this.concavePath=n.vertices.slice(0);for(var i=0;i<this.concavePath.length;i++){var s=[0,0];r.copy(s,this.concavePath[i]),this.concavePath[i]=s}var c;c=e.optimalDecomp?n.decomp():n.quickDecomp();for(var l=r.create(),i=0;i!==c.length;i++){for(var h=new a({vertices:c[i].vertices}),u=0;u!==h.vertices.length;u++){var s=h.vertices[u];r.sub(s,s,h.centerOfMass)}r.scale(l,h.centerOfMass,1),h.updateTriangles(),h.updateCenterOfMass(),h.updateBoundingRadius(),this.addShape(h,l)}return this.adjustCenterOfMass(),this.aabbNeedsUpdate=!0,!0};var A=(r.fromValues(0,0),r.fromValues(0,0)),_=r.fromValues(0,0),E=r.fromValues(0,0);n.prototype.adjustCenterOfMass=function(){var t=A,e=_,i=E,n=0;r.set(e,0,0);for(var o=0;o!==this.shapes.length;o++){var a=this.shapes[o];r.scale(t,a.position,a.area),r.add(e,e,t),n+=a.area}r.scale(i,e,1/n);for(var o=0;o!==this.shapes.length;o++){var a=this.shapes[o];r.sub(a.position,a.position,i)}r.add(this.position,this.position,i);for(var o=0;this.concavePath&&o<this.concavePath.length;o++)r.sub(this.concavePath[o],this.concavePath[o],i);this.updateMassProperties(),this.updateBoundingRadius()},n.prototype.setZeroForce=function(){r.set(this.force,0,0),this.angularForce=0},n.prototype.resetConstraintVelocity=function(){var t=this,e=t.vlambda;r.set(e,0,0),t.wlambda=0},n.prototype.addConstraintVelocity=function(){var t=this,e=t.velocity;r.add(e,e,t.vlambda),t.angularVelocity+=t.wlambda},n.prototype.applyDamping=function(t){if(this.type===n.DYNAMIC){var e=this.velocity;r.scale(e,e,Math.pow(1-this.damping,t)),this.angularVelocity*=Math.pow(1-this.angularDamping,t)}},n.prototype.wakeUp=function(){var t=this.sleepState;this.sleepState=n.AWAKE,this.idleTime=0,t!==n.AWAKE&&this.emit(n.wakeUpEvent)},n.prototype.sleep=function(){this.sleepState=n.SLEEPING,this.angularVelocity=0,this.angularForce=0,r.set(this.velocity,0,0),r.set(this.force,0,0),this.emit(n.sleepEvent)},n.prototype.sleepTick=function(t,e,i){if(this.allowSleep&&this.type!==n.SLEEPING){this.wantsToSleep=!1;var o=(this.sleepState,r.squaredLength(this.velocity)+Math.pow(this.angularVelocity,2)),a=Math.pow(this.sleepSpeedLimit,2);o>=a?(this.idleTime=0,this.sleepState=n.AWAKE):(this.idleTime+=i,this.sleepState=n.SLEEPY),this.idleTime>this.sleepTimeLimit&&(e?this.wantsToSleep=!0:this.sleep())}},n.prototype.overlaps=function(t){return this.world.overlapKeeper.bodiesAreOverlapping(this,t)};var x=r.create(),w=r.create();n.prototype.integrate=function(t){var e=this.invMass,i=this.force,n=this.position,o=this.velocity;r.copy(this.previousPosition,this.position),this.previousAngle=this.angle,this.fixedRotation||(this.angularVelocity+=this.angularForce*this.invInertia*t),r.scale(x,i,t*e),r.multiply(x,this.massMultiplier,x),r.add(o,x,o),this.integrateToTimeOfImpact(t)||(r.scale(w,o,t),r.add(n,n,w),this.fixedRotation||(this.angle+=this.angularVelocity*t)),this.aabbNeedsUpdate=!0};var F=new s,B=new c({mode:c.ALL}),q=r.create(),C=r.create(),S=r.create(),P=r.create();n.prototype.integrateToTimeOfImpact=function(t){if(this.ccdSpeedThreshold<0||r.squaredLength(this.velocity)<Math.pow(this.ccdSpeedThreshold,2))return!1;r.normalize(q,this.velocity),r.scale(C,this.velocity,t),r.add(C,C,this.position),r.sub(S,C,this.position);var e,i=this.angularVelocity*t,n=r.length(S),o=1,a=this;if(F.reset(),B.callback=function(t){t.body!==a&&(e=t.body,t.getHitPoint(C,B),r.sub(S,C,a.position),o=r.length(S)/n,t.stop())},r.copy(B.from,this.position),r.copy(B.to,C),B.update(),this.world.raycast(F,B),!e)return!1;var s=this.angle;r.copy(P,this.position);for(var c=0,l=0,h=0,u=o;u>=l&&c<this.ccdIterations;){c++,h=(u-l)/2,r.scale(w,S,o),r.add(this.position,P,w),this.angle=s+i*o,this.updateAABB();var p=this.aabb.overlaps(e.aabb)&&this.world.narrowphase.bodiesOverlap(this,e);p?l=h:u=h}return o=h,r.copy(this.position,P),this.angle=s,r.scale(w,S,o),r.add(this.position,this.position,w),this.fixedRotation||(this.angle+=i*o),!0},n.prototype.getVelocityAtPoint=function(t,e){return r.crossVZ(t,e,this.angularVelocity),r.subtract(t,this.velocity,t),t},n.sleepyEvent={type:"sleepy"},n.sleepEvent={type:"sleep"},n.wakeUpEvent={type:"wakeup"},n.DYNAMIC=1,n.STATIC=2,n.KINEMATIC=4,n.AWAKE=0,n.SLEEPY=1,n.SLEEPING=2},{"../collision/AABB":7,"../collision/Ray":11,"../collision/RaycastResult":12,"../events/EventEmitter":26,"../math/vec2":30,"../shapes/Convex":40,"poly-decomp":5}],32:[function(t,e,i){function n(t,e,i){i=i||{},o.call(this,t,e,i),this.localAnchorA=r.fromValues(0,0),this.localAnchorB=r.fromValues(0,0),i.localAnchorA&&r.copy(this.localAnchorA,i.localAnchorA),i.localAnchorB&&r.copy(this.localAnchorB,i.localAnchorB),i.worldAnchorA&&this.setWorldAnchorA(i.worldAnchorA),i.worldAnchorB&&this.setWorldAnchorB(i.worldAnchorB);var n=r.create(),a=r.create();this.getWorldAnchorA(n),this.getWorldAnchorB(a);var s=r.distance(n,a);this.restLength="number"==typeof i.restLength?i.restLength:s}var r=t("../math/vec2"),o=t("./Spring");t("../utils/Utils");e.exports=n,n.prototype=new o,n.prototype.constructor=n,n.prototype.setWorldAnchorA=function(t){this.bodyA.toLocalFrame(this.localAnchorA,t)},n.prototype.setWorldAnchorB=function(t){this.bodyB.toLocalFrame(this.localAnchorB,t)},n.prototype.getWorldAnchorA=function(t){this.bodyA.toWorldFrame(t,this.localAnchorA)},n.prototype.getWorldAnchorB=function(t){this.bodyB.toWorldFrame(t,this.localAnchorB)};var a=r.create(),s=r.create(),c=r.create(),l=r.create(),h=r.create(),u=r.create(),p=r.create(),d=r.create(),f=r.create();n.prototype.applyForce=function(){var t=this.stiffness,e=this.damping,i=this.restLength,n=this.bodyA,o=this.bodyB,v=a,m=s,g=c,y=l,b=f,A=h,_=u,E=p,x=d;this.getWorldAnchorA(A),this.getWorldAnchorB(_),r.sub(E,A,n.position),r.sub(x,_,o.position),r.sub(v,_,A);var w=r.len(v);r.normalize(m,v),r.sub(g,o.velocity,n.velocity),r.crossZV(b,o.angularVelocity,x),r.add(g,g,b),r.crossZV(b,n.angularVelocity,E),r.sub(g,g,b),r.scale(y,m,-t*(w-i)-e*r.dot(g,m)),r.sub(n.force,n.force,y),r.add(o.force,o.force,y);var F=r.crossLength(E,y),B=r.crossLength(x,y);n.angularForce-=F,o.angularForce+=B}},{"../math/vec2":30,"../utils/Utils":57,"./Spring":34}],33:[function(t,e,i){function n(t,e,i){i=i||{},r.call(this,t,e,i),this.restAngle="number"==typeof i.restAngle?i.restAngle:e.angle-t.angle}var r=(t("../math/vec2"),t("./Spring"));e.exports=n,n.prototype=new r,n.prototype.constructor=n,n.prototype.applyForce=function(){var t=this.stiffness,e=this.damping,i=this.restAngle,n=this.bodyA,r=this.bodyB,o=r.angle-n.angle,a=r.angularVelocity-n.angularVelocity,s=-t*(o-i)-e*a*0;n.angularForce-=s,r.angularForce+=s}},{"../math/vec2":30,"./Spring":34}],34:[function(t,e,i){function n(t,e,i){i=r.defaults(i,{stiffness:100,damping:1}),this.stiffness=i.stiffness,this.damping=i.damping,this.bodyA=t,this.bodyB=e}var r=(t("../math/vec2"),t("../utils/Utils"));e.exports=n,n.prototype.applyForce=function(){}},{"../math/vec2":30,"../utils/Utils":57}],35:[function(t,e,i){function n(t,e){e=e||{},this.chassisBody=t,this.wheels=[],this.groundBody=new c({mass:0}),this.world=null;var i=this;this.preStepCallback=function(){i.update()}}function r(t,e){e=e||{},this.vehicle=t,this.forwardEquation=new s(t.chassisBody,t.groundBody),this.sideEquation=new s(t.chassisBody,t.groundBody),this.steerValue=0,this.engineForce=0,this.setSideFriction(void 0!==e.sideFriction?e.sideFriction:5),this.localForwardVector=o.fromValues(0,1),e.localForwardVector&&o.copy(this.localForwardVector,e.localForwardVector),this.localPosition=o.fromValues(0,0),e.localPosition&&o.copy(this.localPosition,e.localPosition),a.apply(this,t.chassisBody,t.groundBody),this.equations.push(this.forwardEquation,this.sideEquation),this.setBrakeForce(0)}var o=t("../math/vec2"),a=(t("../utils/Utils"),t("../constraints/Constraint")),s=t("../equations/FrictionEquation"),c=t("../objects/Body");e.exports=n,n.prototype.addToWorld=function(t){this.world=t,t.addBody(this.groundBody),t.on("preStep",this.preStepCallback);for(var e=0;e<this.wheels.length;e++){var i=this.wheels[e];t.addConstraint(i)}},n.prototype.removeFromWorld=function(){var t=this.world;t.removeBody(this.groundBody),t.off("preStep",this.preStepCallback);for(var e=0;e<this.wheels.length;e++){var i=this.wheels[e];t.removeConstraint(i)}this.world=null},n.prototype.addWheel=function(t){var e=new r(this,t);return this.wheels.push(e),e},n.prototype.update=function(){for(var t=0;t<this.wheels.length;t++)this.wheels[t].update()},r.prototype=new a,r.prototype.setBrakeForce=function(t){this.forwardEquation.setSlipForce(t)},r.prototype.setSideFriction=function(t){this.sideEquation.setSlipForce(t)};var l=o.create(),h=o.create();r.prototype.getSpeed=function(){return this.vehicle.chassisBody.vectorToWorldFrame(h,this.localForwardVector),this.vehicle.chassisBody.getVelocityAtPoint(l,h),o.dot(l,h)};var u=o.create();r.prototype.update=function(){this.vehicle.chassisBody.vectorToWorldFrame(this.forwardEquation.t,this.localForwardVector),o.rotate(this.sideEquation.t,this.localForwardVector,Math.PI/2),this.vehicle.chassisBody.vectorToWorldFrame(this.sideEquation.t,this.sideEquation.t),o.rotate(this.forwardEquation.t,this.forwardEquation.t,this.steerValue),o.rotate(this.sideEquation.t,this.sideEquation.t,this.steerValue),this.vehicle.chassisBody.toWorldFrame(this.forwardEquation.contactPointB,this.localPosition),o.copy(this.sideEquation.contactPointB,this.forwardEquation.contactPointB),this.vehicle.chassisBody.vectorToWorldFrame(this.forwardEquation.contactPointA,this.localPosition),o.copy(this.sideEquation.contactPointA,this.forwardEquation.contactPointA),o.normalize(u,this.forwardEquation.t),o.scale(u,u,this.engineForce),this.vehicle.chassisBody.applyForce(u,this.forwardEquation.contactPointA)}},{"../constraints/Constraint":14,"../equations/FrictionEquation":23,"../math/vec2":30,"../objects/Body":31,"../utils/Utils":57}],36:[function(t,e,i){var n=e.exports={AABB:t("./collision/AABB"),AngleLockEquation:t("./equations/AngleLockEquation"),Body:t("./objects/Body"),Broadphase:t("./collision/Broadphase"),Capsule:t("./shapes/Capsule"),Circle:t("./shapes/Circle"),Constraint:t("./constraints/Constraint"),ContactEquation:t("./equations/ContactEquation"),ContactEquationPool:t("./utils/ContactEquationPool"),ContactMaterial:t("./material/ContactMaterial"),Convex:t("./shapes/Convex"),DistanceConstraint:t("./constraints/DistanceConstraint"),Equation:t("./equations/Equation"),EventEmitter:t("./events/EventEmitter"),FrictionEquation:t("./equations/FrictionEquation"),FrictionEquationPool:t("./utils/FrictionEquationPool"),GearConstraint:t("./constraints/GearConstraint"),GSSolver:t("./solver/GSSolver"),Heightfield:t("./shapes/Heightfield"),Line:t("./shapes/Line"),LockConstraint:t("./constraints/LockConstraint"),Material:t("./material/Material"),Narrowphase:t("./collision/Narrowphase"),NaiveBroadphase:t("./collision/NaiveBroadphase"),Particle:t("./shapes/Particle"),Plane:t("./shapes/Plane"),Pool:t("./utils/Pool"),RevoluteConstraint:t("./constraints/RevoluteConstraint"),PrismaticConstraint:t("./constraints/PrismaticConstraint"),Ray:t("./collision/Ray"),RaycastResult:t("./collision/RaycastResult"),Box:t("./shapes/Box"),RotationalVelocityEquation:t("./equations/RotationalVelocityEquation"),SAPBroadphase:t("./collision/SAPBroadphase"),Shape:t("./shapes/Shape"),Solver:t("./solver/Solver"),Spring:t("./objects/Spring"),TopDownVehicle:t("./objects/TopDownVehicle"),LinearSpring:t("./objects/LinearSpring"),RotationalSpring:t("./objects/RotationalSpring"),Utils:t("./utils/Utils"),World:t("./world/World"),vec2:t("./math/vec2"),version:t("../package.json").version};Object.defineProperty(n,"Rectangle",{get:function(){return console.warn("The Rectangle class has been renamed to Box."),this.Box}})},{"../package.json":6,"./collision/AABB":7,"./collision/Broadphase":8,"./collision/NaiveBroadphase":9,"./collision/Narrowphase":10,"./collision/Ray":11,"./collision/RaycastResult":12,"./collision/SAPBroadphase":13,"./constraints/Constraint":14,"./constraints/DistanceConstraint":15,"./constraints/GearConstraint":16,"./constraints/LockConstraint":17,"./constraints/PrismaticConstraint":18,"./constraints/RevoluteConstraint":19,"./equations/AngleLockEquation":20,"./equations/ContactEquation":21,"./equations/Equation":22,"./equations/FrictionEquation":23,"./equations/RotationalVelocityEquation":25,"./events/EventEmitter":26,"./material/ContactMaterial":27,"./material/Material":28,"./math/vec2":30,"./objects/Body":31,"./objects/LinearSpring":32,"./objects/RotationalSpring":33,"./objects/Spring":34,"./objects/TopDownVehicle":35,"./shapes/Box":37,"./shapes/Capsule":38,"./shapes/Circle":39,"./shapes/Convex":40,"./shapes/Heightfield":41,"./shapes/Line":42,"./shapes/Particle":43,"./shapes/Plane":44,"./shapes/Shape":45,"./solver/GSSolver":46,"./solver/Solver":47,"./utils/ContactEquationPool":48,"./utils/FrictionEquationPool":49,"./utils/Pool":55,"./utils/Utils":57,"./world/World":61}],37:[function(t,e,i){function n(t){"number"==typeof arguments[0]&&"number"==typeof arguments[1]&&(t={width:arguments[0],height:arguments[1]},console.warn("The Rectangle has been renamed to Box and its constructor signature has changed. Please use the following format: new Box({ width: 1, height: 1, ... })")),t=t||{};var e=this.width=t.width||1,i=this.height=t.height||1,n=[r.fromValues(-e/2,-i/2),r.fromValues(e/2,-i/2),r.fromValues(e/2,i/2),r.fromValues(-e/2,i/2)],s=[r.fromValues(1,0),r.fromValues(0,1)];t.vertices=n,t.axes=s,t.type=o.BOX,a.call(this,t)}var r=t("../math/vec2"),o=t("./Shape"),a=t("./Convex");e.exports=n,n.prototype=new a,n.prototype.constructor=n,n.prototype.computeMomentOfInertia=function(t){var e=this.width,i=this.height;return t*(i*i+e*e)/12},n.prototype.updateBoundingRadius=function(){var t=this.width,e=this.height;this.boundingRadius=Math.sqrt(t*t+e*e)/2};r.create(),r.create(),r.create(),r.create();n.prototype.computeAABB=function(t,e,i){t.setFromPoints(this.vertices,e,i,0)},n.prototype.updateArea=function(){this.area=this.width*this.height}},{"../math/vec2":30,"./Convex":40,"./Shape":45}],38:[function(t,e,i){function n(t){"number"==typeof arguments[0]&&"number"==typeof arguments[1]&&(t={length:arguments[0],radius:arguments[1]},console.warn("The Capsule constructor signature has changed. Please use the following format: new Capsule({ radius: 1, length: 1 })")),t=t||{},this.length=t.length||1,this.radius=t.radius||1,t.type=r.CAPSULE,r.call(this,t)}var r=t("./Shape"),o=t("../math/vec2");e.exports=n,n.prototype=new r,n.prototype.constructor=n,n.prototype.computeMomentOfInertia=function(t){var e=this.radius,i=this.length+e,n=2*e;return t*(n*n+i*i)/12},n.prototype.updateBoundingRadius=function(){this.boundingRadius=this.radius+this.length/2},n.prototype.updateArea=function(){this.area=Math.PI*this.radius*this.radius+2*this.radius*this.length};var a=o.create();n.prototype.computeAABB=function(t,e,i){var n=this.radius;o.set(a,this.length/2,0),0!==i&&o.rotate(a,a,i),o.set(t.upperBound,Math.max(a[0]+n,-a[0]+n),Math.max(a[1]+n,-a[1]+n)),o.set(t.lowerBound,Math.min(a[0]-n,-a[0]-n),Math.min(a[1]-n,-a[1]-n)),o.add(t.lowerBound,t.lowerBound,e),o.add(t.upperBound,t.upperBound,e)};var s=o.create(),c=o.create(),l=o.create(),h=o.create(),u=o.fromValues(0,1);n.prototype.raycast=function(t,e,i,n){for(var r=e.from,a=e.to,p=(e.direction,s),d=c,f=l,v=h,m=this.length/2,g=0;2>g;g++){var y=this.radius*(2*g-1);o.set(f,-m,y),o.set(v,m,y),o.toGlobalFrame(f,f,i,n),o.toGlobalFrame(v,v,i,n);var b=o.getLineSegmentsIntersectionFraction(r,a,f,v);if(b>=0&&(o.rotate(d,u,n),o.scale(d,d,2*g-1),e.reportIntersection(t,b,d,-1),t.shouldStop(e)))return}for(var A=Math.pow(this.radius,2)+Math.pow(m,2),g=0;2>g;g++){o.set(f,m*(2*g-1),0),o.toGlobalFrame(f,f,i,n);var _=Math.pow(a[0]-r[0],2)+Math.pow(a[1]-r[1],2),E=2*((a[0]-r[0])*(r[0]-f[0])+(a[1]-r[1])*(r[1]-f[1])),x=Math.pow(r[0]-f[0],2)+Math.pow(r[1]-f[1],2)-Math.pow(this.radius,2),b=Math.pow(E,2)-4*_*x;if(!(0>b))if(0===b){if(o.lerp(p,r,a,b),o.squaredDistance(p,i)>A&&(o.sub(d,p,f),o.normalize(d,d),e.reportIntersection(t,b,d,-1),t.shouldStop(e)))return}else{var w=Math.sqrt(b),F=1/(2*_),B=(-E-w)*F,q=(-E+w)*F;if(B>=0&&1>=B&&(o.lerp(p,r,a,B),o.squaredDistance(p,i)>A&&(o.sub(d,p,f),o.normalize(d,d),e.reportIntersection(t,B,d,-1),t.shouldStop(e))))return;if(q>=0&&1>=q&&(o.lerp(p,r,a,q),o.squaredDistance(p,i)>A&&(o.sub(d,p,f),o.normalize(d,d),e.reportIntersection(t,q,d,-1),t.shouldStop(e))))return}}}},{"../math/vec2":30,"./Shape":45}],39:[function(t,e,i){function n(t){"number"==typeof arguments[0]&&(t={radius:arguments[0]},console.warn("The Circle constructor signature has changed. Please use the following format: new Circle({ radius: 1 })")),t=t||{},this.radius=t.radius||1,t.type=r.CIRCLE,r.call(this,t)}var r=t("./Shape"),o=t("../math/vec2");e.exports=n,n.prototype=new r,n.prototype.constructor=n,n.prototype.computeMomentOfInertia=function(t){var e=this.radius;return t*e*e/2},n.prototype.updateBoundingRadius=function(){this.boundingRadius=this.radius},n.prototype.updateArea=function(){this.area=Math.PI*this.radius*this.radius},n.prototype.computeAABB=function(t,e,i){var n=this.radius;o.set(t.upperBound,n,n),o.set(t.lowerBound,-n,-n),e&&(o.add(t.lowerBound,t.lowerBound,e),o.add(t.upperBound,t.upperBound,e))};var a=o.create(),s=o.create();n.prototype.raycast=function(t,e,i,n){var r=e.from,c=e.to,l=this.radius,h=Math.pow(c[0]-r[0],2)+Math.pow(c[1]-r[1],2),u=2*((c[0]-r[0])*(r[0]-i[0])+(c[1]-r[1])*(r[1]-i[1])),p=Math.pow(r[0]-i[0],2)+Math.pow(r[1]-i[1],2)-Math.pow(l,2),d=Math.pow(u,2)-4*h*p,f=a,v=s;if(!(0>d))if(0===d)o.lerp(f,r,c,d),o.sub(v,f,i),o.normalize(v,v),e.reportIntersection(t,d,v,-1);else{var m=Math.sqrt(d),g=1/(2*h),y=(-u-m)*g,b=(-u+m)*g;if(y>=0&&1>=y&&(o.lerp(f,r,c,y),o.sub(v,f,i),o.normalize(v,v),e.reportIntersection(t,y,v,-1),t.shouldStop(e)))return;b>=0&&1>=b&&(o.lerp(f,r,c,b),o.sub(v,f,i),o.normalize(v,v),e.reportIntersection(t,b,v,-1))}}},{"../math/vec2":30,"./Shape":45}],40:[function(t,e,i){function n(t){Array.isArray(arguments[0])&&(t={vertices:arguments[0],axes:arguments[1]},console.warn("The Convex constructor signature has changed. Please use the following format: new Convex({ vertices: [...], ... })")),t=t||{},this.vertices=[];for(var e=void 0!==t.vertices?t.vertices:[],i=0;i<e.length;i++){var n=o.create();o.copy(n,e[i]),this.vertices.push(n)}if(this.axes=[],t.axes)for(var i=0;i<t.axes.length;i++){var a=o.create();o.copy(a,t.axes[i]),this.axes.push(a)}else for(var i=0;i<this.vertices.length;i++){var s=this.vertices[i],c=this.vertices[(i+1)%this.vertices.length],l=o.create();o.sub(l,c,s),o.rotate90cw(l,l),o.normalize(l,l),this.axes.push(l)}if(this.centerOfMass=o.fromValues(0,0),this.triangles=[],this.vertices.length&&(this.updateTriangles(),this.updateCenterOfMass()),this.boundingRadius=0,t.type=r.CONVEX,r.call(this,t),this.updateBoundingRadius(),this.updateArea(),this.area<0)throw new Error("Convex vertices must be given in conter-clockwise winding.")}var r=t("./Shape"),o=t("../math/vec2"),a=t("../math/polyk");t("poly-decomp");e.exports=n,n.prototype=new r,n.prototype.constructor=n;var s=o.create(),c=o.create();n.prototype.projectOntoLocalAxis=function(t,e){for(var i,n,r=null,a=null,t=s,c=0;c<this.vertices.length;c++)i=this.vertices[c],n=o.dot(i,t),(null===r||n>r)&&(r=n),(null===a||a>n)&&(a=n);if(a>r){var l=a;a=r,r=l}o.set(e,a,r)},n.prototype.projectOntoWorldAxis=function(t,e,i,n){var r=c;this.projectOntoLocalAxis(t,n),0!==i?o.rotate(r,t,i):r=t;var a=o.dot(e,r);o.set(n,n[0]+a,n[1]+a)},n.prototype.updateTriangles=function(){this.triangles.length=0;for(var t=[],e=0;e<this.vertices.length;e++){var i=this.vertices[e];t.push(i[0],i[1])}for(var n=a.Triangulate(t),e=0;e<n.length;e+=3){var r=n[e],o=n[e+1],s=n[e+2];this.triangles.push([r,o,s])}};var l=o.create(),h=o.create(),u=o.create(),p=o.create(),d=o.create();o.create(),o.create(),o.create(),o.create();n.prototype.updateCenterOfMass=function(){var t=this.triangles,e=this.vertices,i=this.centerOfMass,r=l,a=u,s=p,c=d,f=h;o.set(i,0,0);for(var v=0,m=0;m!==t.length;m++){var g=t[m],a=e[g[0]],s=e[g[1]],c=e[g[2]];o.centroid(r,a,s,c);var y=n.triangleArea(a,s,c);v+=y,o.scale(f,r,y),o.add(i,i,f)}o.scale(i,i,1/v)},n.prototype.computeMomentOfInertia=function(t){for(var e=0,i=0,n=this.vertices.length,r=n-1,a=0;n>a;r=a,a++){var s=this.vertices[r],c=this.vertices[a],l=Math.abs(o.crossLength(s,c)),h=o.dot(c,c)+o.dot(c,s)+o.dot(s,s);e+=l*h,i+=l}return t/6*(e/i)},n.prototype.updateBoundingRadius=function(){for(var t=this.vertices,e=0,i=0;i!==t.length;i++){var n=o.squaredLength(t[i]);n>e&&(e=n)}this.boundingRadius=Math.sqrt(e)},n.triangleArea=function(t,e,i){return.5*((e[0]-t[0])*(i[1]-t[1])-(i[0]-t[0])*(e[1]-t[1]))},n.prototype.updateArea=function(){this.updateTriangles(),this.area=0;for(var t=this.triangles,e=this.vertices,i=0;i!==t.length;i++){var r=t[i],o=e[r[0]],a=e[r[1]],s=e[r[2]],c=n.triangleArea(o,a,s);this.area+=c}},n.prototype.computeAABB=function(t,e,i){t.setFromPoints(this.vertices,e,i,0)};var f=o.create(),v=o.create(),m=o.create();n.prototype.raycast=function(t,e,i,n){var r=f,a=v,s=m,c=this.vertices;o.toLocalFrame(r,e.from,i,n),o.toLocalFrame(a,e.to,i,n);for(var l=c.length,h=0;l>h&&!t.shouldStop(e);h++){var u=c[h],p=c[(h+1)%l],d=o.getLineSegmentsIntersectionFraction(r,a,u,p);d>=0&&(o.sub(s,p,u),o.rotate(s,s,-Math.PI/2+n),o.normalize(s,s),e.reportIntersection(t,d,s,h))}}},{"../math/polyk":29,"../math/vec2":30,"./Shape":45,"poly-decomp":5}],41:[function(t,e,i){function n(t){if(Array.isArray(arguments[0])){if(t={heights:arguments[0]},"object"==typeof arguments[1])for(var e in arguments[1])t[e]=arguments[1][e];console.warn("The Heightfield constructor signature has changed. Please use the following format: new Heightfield({ heights: [...], ... })")}t=t||{},this.heights=t.heights?t.heights.slice(0):[],this.maxValue=t.maxValue||null,this.minValue=t.minValue||null,this.elementWidth=t.elementWidth||.1,(void 0===t.maxValue||void 0===t.minValue)&&this.updateMaxMinValues(),t.type=r.HEIGHTFIELD,r.call(this,t)}var r=t("./Shape"),o=t("../math/vec2");t("../utils/Utils");e.exports=n,n.prototype=new r,n.prototype.constructor=n,n.prototype.updateMaxMinValues=function(){for(var t=this.heights,e=t[0],i=t[0],n=0;n!==t.length;n++){var r=t[n];r>e&&(e=r),i>r&&(i=r)}this.maxValue=e,this.minValue=i},n.prototype.computeMomentOfInertia=function(t){return Number.MAX_VALUE},n.prototype.updateBoundingRadius=function(){this.boundingRadius=Number.MAX_VALUE},n.prototype.updateArea=function(){for(var t=this.heights,e=0,i=0;i<t.length-1;i++)e+=(t[i]+t[i+1])/2*this.elementWidth;this.area=e};var a=[o.create(),o.create(),o.create(),o.create()];n.prototype.computeAABB=function(t,e,i){o.set(a[0],0,this.maxValue),o.set(a[1],this.elementWidth*this.heights.length,this.maxValue),o.set(a[2],this.elementWidth*this.heights.length,this.minValue),o.set(a[3],0,this.minValue),t.setFromPoints(a,e,i)},n.prototype.getLineSegment=function(t,e,i){var n=this.heights,r=this.elementWidth;o.set(t,i*r,n[i]),o.set(e,(i+1)*r,n[i+1])},n.prototype.getSegmentIndex=function(t){return Math.floor(t[0]/this.elementWidth)},n.prototype.getClampedSegmentIndex=function(t){var e=this.getSegmentIndex(t);return e=Math.min(this.heights.length,Math.max(e,0))};var s=(o.create(),o.create()),c=o.create(),l=o.create(),h=o.create(),u=o.create();o.fromValues(0,1);n.prototype.raycast=function(t,e,i,n){var r=e.from,a=e.to,p=(e.direction,s),d=c,f=l,v=h,m=u;o.toLocalFrame(v,r,i,n),o.toLocalFrame(m,a,i,n);var g=this.getClampedSegmentIndex(v),y=this.getClampedSegmentIndex(m);if(g>y){var b=g;g=y,y=b}for(var A=0;A<this.heights.length-1;A++){this.getLineSegment(d,f,A);var _=o.getLineSegmentsIntersectionFraction(v,m,d,f);if(_>=0&&(o.sub(p,f,d),o.rotate(p,p,n+Math.PI/2),o.normalize(p,p),e.reportIntersection(t,_,p,-1),t.shouldStop(e)))return}}},{"../math/vec2":30,"../utils/Utils":57,"./Shape":45}],42:[function(t,e,i){function n(t){"number"==typeof arguments[0]&&(t={length:arguments[0]},console.warn("The Line constructor signature has changed. Please use the following format: new Line({ length: 1, ... })")),t=t||{},this.length=t.length||1,t.type=r.LINE,r.call(this,t)}var r=t("./Shape"),o=t("../math/vec2");e.exports=n,n.prototype=new r,n.prototype.constructor=n,n.prototype.computeMomentOfInertia=function(t){return t*Math.pow(this.length,2)/12},n.prototype.updateBoundingRadius=function(){this.boundingRadius=this.length/2};var a=[o.create(),o.create()];n.prototype.computeAABB=function(t,e,i){var n=this.length/2;o.set(a[0],-n,0),o.set(a[1],n,0),t.setFromPoints(a,e,i,0)};var s=(o.create(),o.create()),c=o.create(),l=o.create(),h=o.fromValues(0,1);n.prototype.raycast=function(t,e,i,n){var r=e.from,a=e.to,u=c,p=l,d=this.length/2;o.set(u,-d,0),o.set(p,d,0),o.toGlobalFrame(u,u,i,n),o.toGlobalFrame(p,p,i,n);var f=o.getLineSegmentsIntersectionFraction(u,p,r,a);if(f>=0){var v=s;o.rotate(v,h,n),e.reportIntersection(t,f,v,-1)}}},{"../math/vec2":30,"./Shape":45}],43:[function(t,e,i){function n(t){t=t||{},t.type=r.PARTICLE,r.call(this,t)}var r=t("./Shape"),o=t("../math/vec2");e.exports=n,n.prototype=new r,n.prototype.constructor=n,n.prototype.computeMomentOfInertia=function(t){return 0},n.prototype.updateBoundingRadius=function(){this.boundingRadius=0},n.prototype.computeAABB=function(t,e,i){o.copy(t.lowerBound,e),o.copy(t.upperBound,e)}},{"../math/vec2":30,"./Shape":45}],44:[function(t,e,i){function n(t){t=t||{},t.type=r.PLANE,r.call(this,t)}var r=t("./Shape"),o=t("../math/vec2");t("../utils/Utils");e.exports=n,n.prototype=new r,n.prototype.constructor=n,n.prototype.computeMomentOfInertia=function(t){return 0},n.prototype.updateBoundingRadius=function(){this.boundingRadius=Number.MAX_VALUE},n.prototype.computeAABB=function(t,e,i){var n=i%(2*Math.PI),r=o.set,a=1e7,s=t.lowerBound,c=t.upperBound;r(s,-a,-a),r(c,a,a),0===n?c[1]=0:n===Math.PI/2?s[0]=0:n===Math.PI?s[1]=0:n===3*Math.PI/2&&(c[0]=0)},n.prototype.updateArea=function(){this.area=Number.MAX_VALUE};var a=o.create(),s=(o.create(),o.create(),o.create()),c=o.create();
n.prototype.raycast=function(t,e,i,n){var r=e.from,l=e.to,h=e.direction,u=a,p=s,d=c;o.set(p,0,1),o.rotate(p,p,n),o.sub(d,r,i);var f=o.dot(d,p);o.sub(d,l,i);var v=o.dot(d,p);if(!(f*v>0||o.squaredDistance(r,l)<f*f)){var m=o.dot(p,h);o.sub(u,r,i);var g=-o.dot(p,u)/m/e.length;e.reportIntersection(t,g,p,-1)}}},{"../math/vec2":30,"../utils/Utils":57,"./Shape":45}],45:[function(t,e,i){function n(t){t=t||{},this.body=null,this.position=r.fromValues(0,0),t.position&&r.copy(this.position,t.position),this.angle=t.angle||0,this.type=t.type||0,this.id=n.idCounter++,this.boundingRadius=0,this.collisionGroup=void 0!==t.collisionGroup?t.collisionGroup:1,this.collisionResponse=void 0!==t.collisionResponse?t.collisionResponse:!0,this.collisionMask=void 0!==t.collisionMask?t.collisionMask:1,this.material=t.material||null,this.area=0,this.sensor=void 0!==t.sensor?t.sensor:!1,this.type&&this.updateBoundingRadius(),this.updateArea()}e.exports=n;var r=t("../math/vec2");n.idCounter=0,n.CIRCLE=1,n.PARTICLE=2,n.PLANE=4,n.CONVEX=8,n.LINE=16,n.BOX=32,Object.defineProperty(n,"RECTANGLE",{get:function(){return console.warn("Shape.RECTANGLE is deprecated, use Shape.BOX instead."),n.BOX}}),n.CAPSULE=64,n.HEIGHTFIELD=128,n.prototype.computeMomentOfInertia=function(t){},n.prototype.updateBoundingRadius=function(){},n.prototype.updateArea=function(){},n.prototype.computeAABB=function(t,e,i){},n.prototype.raycast=function(t,e,i,n){}},{"../math/vec2":30}],46:[function(t,e,i){function n(t){a.call(this,t,a.GS),t=t||{},this.iterations=t.iterations||10,this.tolerance=t.tolerance||1e-7,this.arrayStep=30,this.lambda=new s.ARRAY_TYPE(this.arrayStep),this.Bs=new s.ARRAY_TYPE(this.arrayStep),this.invCs=new s.ARRAY_TYPE(this.arrayStep),this.useZeroRHS=!1,this.frictionIterations=void 0!==t.frictionIterations?0:t.frictionIterations,this.usedIterations=0}function r(t){for(var e=t.length;e--;)t[e]=0}var o=t("../math/vec2"),a=t("./Solver"),s=t("../utils/Utils"),c=t("../equations/FrictionEquation");e.exports=n,n.prototype=new a,n.prototype.constructor=n,n.prototype.solve=function(t,e){this.sortEquations();var i=0,a=this.iterations,l=this.frictionIterations,h=this.equations,u=h.length,p=Math.pow(this.tolerance*u,2),d=e.bodies,f=e.bodies.length,v=(o.add,o.set,this.useZeroRHS),m=this.lambda;if(this.usedIterations=0,u)for(var g=0;g!==f;g++){var y=d[g];y.updateSolveMassProperties()}m.length<u&&(m=this.lambda=new s.ARRAY_TYPE(u+this.arrayStep),this.Bs=new s.ARRAY_TYPE(u+this.arrayStep),this.invCs=new s.ARRAY_TYPE(u+this.arrayStep)),r(m);for(var b=this.invCs,A=this.Bs,m=this.lambda,g=0;g!==h.length;g++){var _=h[g];(_.timeStep!==t||_.needsUpdate)&&(_.timeStep=t,_.update()),A[g]=_.computeB(_.a,_.b,t),b[g]=_.computeInvC(_.epsilon)}var _,E,g,x;if(0!==u){for(g=0;g!==f;g++){var y=d[g];y.resetConstraintVelocity()}if(l){for(i=0;i!==l;i++){for(E=0,x=0;x!==u;x++){_=h[x];var w=n.iterateEquation(x,_,_.epsilon,A,b,m,v,t,i);E+=Math.abs(w)}if(this.usedIterations++,p>=E*E)break}for(n.updateMultipliers(h,m,1/t),x=0;x!==u;x++){var F=h[x];if(F instanceof c){for(var B=0,q=0;q!==F.contactEquations.length;q++)B+=F.contactEquations[q].multiplier;B*=F.frictionCoefficient/F.contactEquations.length,F.maxForce=B,F.minForce=-B}}}for(i=0;i!==a;i++){for(E=0,x=0;x!==u;x++){_=h[x];var w=n.iterateEquation(x,_,_.epsilon,A,b,m,v,t,i);E+=Math.abs(w)}if(this.usedIterations++,p>=E*E)break}for(g=0;g!==f;g++)d[g].addConstraintVelocity();n.updateMultipliers(h,m,1/t)}},n.updateMultipliers=function(t,e,i){for(var n=t.length;n--;)t[n].multiplier=e[n]*i},n.iterateEquation=function(t,e,i,n,r,o,a,s,c){var l=n[t],h=r[t],u=o[t],p=e.computeGWlambda(),d=e.maxForce,f=e.minForce;a&&(l=0);var v=h*(l-p-i*u),m=u+v;return f*s>m?v=f*s-u:m>d*s&&(v=d*s-u),o[t]+=v,e.addToWlambda(v),v}},{"../equations/FrictionEquation":23,"../math/vec2":30,"../utils/Utils":57,"./Solver":47}],47:[function(t,e,i){function n(t,e){t=t||{},r.call(this),this.type=e,this.equations=[],this.equationSortFunction=t.equationSortFunction||!1}var r=(t("../utils/Utils"),t("../events/EventEmitter"));e.exports=n,n.prototype=new r,n.prototype.constructor=n,n.prototype.solve=function(t,e){throw new Error("Solver.solve should be implemented by subclasses!")};var o={bodies:[]};n.prototype.solveIsland=function(t,e){this.removeAllEquations(),e.equations.length&&(this.addEquations(e.equations),o.bodies.length=0,e.getBodies(o.bodies),o.bodies.length&&this.solve(t,o))},n.prototype.sortEquations=function(){this.equationSortFunction&&this.equations.sort(this.equationSortFunction)},n.prototype.addEquation=function(t){t.enabled&&this.equations.push(t)},n.prototype.addEquations=function(t){for(var e=0,i=t.length;e!==i;e++){var n=t[e];n.enabled&&this.equations.push(n)}},n.prototype.removeEquation=function(t){var e=this.equations.indexOf(t);-1!==e&&this.equations.splice(e,1)},n.prototype.removeAllEquations=function(){this.equations.length=0},n.GS=1,n.ISLAND=2},{"../events/EventEmitter":26,"../utils/Utils":57}],48:[function(t,e,i){function n(){o.apply(this,arguments)}var r=t("../equations/ContactEquation"),o=t("./Pool");e.exports=n,n.prototype=new o,n.prototype.constructor=n,n.prototype.create=function(){return new r},n.prototype.destroy=function(t){return t.bodyA=t.bodyB=null,this}},{"../equations/ContactEquation":21,"./Pool":55}],49:[function(t,e,i){function n(){o.apply(this,arguments)}var r=t("../equations/FrictionEquation"),o=t("./Pool");e.exports=n,n.prototype=new o,n.prototype.constructor=n,n.prototype.create=function(){return new r},n.prototype.destroy=function(t){return t.bodyA=t.bodyB=null,this}},{"../equations/FrictionEquation":23,"./Pool":55}],50:[function(t,e,i){function n(){o.apply(this,arguments)}var r=t("../world/IslandNode"),o=t("./Pool");e.exports=n,n.prototype=new o,n.prototype.constructor=n,n.prototype.create=function(){return new r},n.prototype.destroy=function(t){return t.reset(),this}},{"../world/IslandNode":60,"./Pool":55}],51:[function(t,e,i){function n(){o.apply(this,arguments)}var r=t("../world/Island"),o=t("./Pool");e.exports=n,n.prototype=new o,n.prototype.constructor=n,n.prototype.create=function(){return new r},n.prototype.destroy=function(t){return t.reset(),this}},{"../world/Island":58,"./Pool":55}],52:[function(t,e,i){function n(){this.overlappingShapesLastState=new r,this.overlappingShapesCurrentState=new r,this.recordPool=new o({size:16}),this.tmpDict=new r,this.tmpArray1=[]}var r=t("./TupleDictionary"),o=(t("./OverlapKeeperRecord"),t("./OverlapKeeperRecordPool"));t("./Utils");e.exports=n,n.prototype.tick=function(){for(var t=this.overlappingShapesLastState,e=this.overlappingShapesCurrentState,i=t.keys.length;i--;){var n=t.keys[i],r=t.getByKey(n);e.getByKey(n);r&&this.recordPool.release(r)}t.reset(),t.copy(e),e.reset()},n.prototype.setOverlapping=function(t,e,i,n){var r=(this.overlappingShapesLastState,this.overlappingShapesCurrentState);if(!r.get(e.id,n.id)){var o=this.recordPool.get();o.set(t,e,i,n),r.set(e.id,n.id,o)}},n.prototype.getNewOverlaps=function(t){return this.getDiff(this.overlappingShapesLastState,this.overlappingShapesCurrentState,t)},n.prototype.getEndOverlaps=function(t){return this.getDiff(this.overlappingShapesCurrentState,this.overlappingShapesLastState,t)},n.prototype.bodiesAreOverlapping=function(t,e){for(var i=this.overlappingShapesCurrentState,n=i.keys.length;n--;){var r=i.keys[n],o=i.data[r];if(o.bodyA===t&&o.bodyB===e||o.bodyA===e&&o.bodyB===t)return!0}return!1},n.prototype.getDiff=function(t,e,i){var i=i||[],n=t,r=e;i.length=0;for(var o=r.keys.length;o--;){var a=r.keys[o],s=r.data[a];if(!s)throw new Error("Key "+a+" had no data!");var c=n.data[a];c||i.push(s)}return i},n.prototype.isNewOverlap=function(t,e){var i=0|t.id,n=0|e.id,r=this.overlappingShapesLastState,o=this.overlappingShapesCurrentState;return!r.get(i,n)&&!!o.get(i,n)},n.prototype.getNewBodyOverlaps=function(t){this.tmpArray1.length=0;var e=this.getNewOverlaps(this.tmpArray1);return this.getBodyDiff(e,t)},n.prototype.getEndBodyOverlaps=function(t){this.tmpArray1.length=0;var e=this.getEndOverlaps(this.tmpArray1);return this.getBodyDiff(e,t)},n.prototype.getBodyDiff=function(t,e){e=e||[];for(var i=this.tmpDict,n=t.length;n--;){var r=t[n];i.set(0|r.bodyA.id,0|r.bodyB.id,r)}for(n=i.keys.length;n--;){var r=i.getByKey(i.keys[n]);r&&e.push(r.bodyA,r.bodyB)}return i.reset(),e}},{"./OverlapKeeperRecord":53,"./OverlapKeeperRecordPool":54,"./TupleDictionary":56,"./Utils":57}],53:[function(t,e,i){function n(t,e,i,n){this.shapeA=e,this.shapeB=n,this.bodyA=t,this.bodyB=i}e.exports=n,n.prototype.set=function(t,e,i,r){n.call(this,t,e,i,r)}},{}],54:[function(t,e,i){function n(){o.apply(this,arguments)}var r=t("./OverlapKeeperRecord"),o=t("./Pool");e.exports=n,n.prototype=new o,n.prototype.constructor=n,n.prototype.create=function(){return new r},n.prototype.destroy=function(t){return t.bodyA=t.bodyB=t.shapeA=t.shapeB=null,this}},{"./OverlapKeeperRecord":53,"./Pool":55}],55:[function(t,e,i){function n(t){t=t||{},this.objects=[],void 0!==t.size&&this.resize(t.size)}e.exports=n,n.prototype.resize=function(t){for(var e=this.objects;e.length>t;)e.pop();for(;e.length<t;)e.push(this.create());return this},n.prototype.get=function(){var t=this.objects;return t.length?t.pop():this.create()},n.prototype.release=function(t){return this.destroy(t),this.objects.push(t),this}},{}],56:[function(t,e,i){function n(){this.data={},this.keys=[]}var r=t("./Utils");e.exports=n,n.prototype.getKey=function(t,e){return t=0|t,e=0|e,(0|t)===(0|e)?-1:0|((0|t)>(0|e)?t<<16|65535&e:e<<16|65535&t)},n.prototype.getByKey=function(t){return t=0|t,this.data[t]},n.prototype.get=function(t,e){return this.data[this.getKey(t,e)]},n.prototype.set=function(t,e,i){if(!i)throw new Error("No data!");var n=this.getKey(t,e);return this.data[n]||this.keys.push(n),this.data[n]=i,n},n.prototype.reset=function(){for(var t=this.data,e=this.keys,i=e.length;i--;)delete t[e[i]];e.length=0},n.prototype.copy=function(t){this.reset(),r.appendArray(this.keys,t.keys);for(var e=t.keys.length;e--;){var i=t.keys[e];this.data[i]=t.data[i]}}},{"./Utils":57}],57:[function(t,e,i){function n(){}e.exports=n,n.appendArray=function(t,e){if(e.length<15e4)t.push.apply(t,e);else for(var i=0,n=e.length;i!==n;++i)t.push(e[i])},n.splice=function(t,e,i){i=i||1;for(var n=e,r=t.length-i;r>n;n++)t[n]=t[n+i];t.length=r},"undefined"!=typeof P2_ARRAY_TYPE?n.ARRAY_TYPE=P2_ARRAY_TYPE:"undefined"!=typeof Float32Array?n.ARRAY_TYPE=Float32Array:n.ARRAY_TYPE=Array,n.extend=function(t,e){for(var i in e)t[i]=e[i]},n.defaults=function(t,e){t=t||{};for(var i in e)i in t||(t[i]=e[i]);return t}},{}],58:[function(t,e,i){function n(){this.equations=[],this.bodies=[]}var r=t("../objects/Body");e.exports=n,n.prototype.reset=function(){this.equations.length=this.bodies.length=0};var o=[];n.prototype.getBodies=function(t){var e=t||[],i=this.equations;o.length=0;for(var n=0;n!==i.length;n++){var r=i[n];-1===o.indexOf(r.bodyA.id)&&(e.push(r.bodyA),o.push(r.bodyA.id)),-1===o.indexOf(r.bodyB.id)&&(e.push(r.bodyB),o.push(r.bodyB.id))}return e},n.prototype.wantsToSleep=function(){for(var t=0;t<this.bodies.length;t++){var e=this.bodies[t];if(e.type===r.DYNAMIC&&!e.wantsToSleep)return!1}return!0},n.prototype.sleep=function(){for(var t=0;t<this.bodies.length;t++){var e=this.bodies[t];e.sleep()}return!0}},{"../objects/Body":31}],59:[function(t,e,i){function n(t){this.nodePool=new r({size:16}),this.islandPool=new o({size:8}),this.equations=[],this.islands=[],this.nodes=[],this.queue=[]}var r=(t("../math/vec2"),t("./Island"),t("./IslandNode"),t("./../utils/IslandNodePool")),o=t("./../utils/IslandPool"),a=t("../objects/Body");e.exports=n,n.getUnvisitedNode=function(t){for(var e=t.length,i=0;i!==e;i++){var n=t[i];if(!n.visited&&n.body.type===a.DYNAMIC)return n}return!1},n.prototype.visit=function(t,e,i){e.push(t.body);for(var n=t.equations.length,r=0;r!==n;r++){var o=t.equations[r];-1===i.indexOf(o)&&i.push(o)}},n.prototype.bfs=function(t,e,i){var r=this.queue;for(r.length=0,r.push(t),t.visited=!0,this.visit(t,e,i);r.length;)for(var o,s=r.pop();o=n.getUnvisitedNode(s.neighbors);)o.visited=!0,this.visit(o,e,i),o.body.type===a.DYNAMIC&&r.push(o)},n.prototype.split=function(t){for(var e=t.bodies,i=this.nodes,r=this.equations;i.length;)this.nodePool.release(i.pop());for(var o=0;o!==e.length;o++){var a=this.nodePool.get();a.body=e[o],i.push(a)}for(var s=0;s!==r.length;s++){var c=r[s],o=e.indexOf(c.bodyA),l=e.indexOf(c.bodyB),h=i[o],u=i[l];h.neighbors.push(u),u.neighbors.push(h),h.equations.push(c),u.equations.push(c)}for(var p=this.islands,o=0;o<p.length;o++)this.islandPool.release(p[o]);p.length=0;for(var d;d=n.getUnvisitedNode(i);){var f=this.islandPool.get();this.bfs(d,f.bodies,f.equations),p.push(f)}return p}},{"../math/vec2":30,"../objects/Body":31,"./../utils/IslandNodePool":50,"./../utils/IslandPool":51,"./Island":58,"./IslandNode":60}],60:[function(t,e,i){function n(t){this.body=t,this.neighbors=[],this.equations=[],this.visited=!1}e.exports=n,n.prototype.reset=function(){this.equations.length=0,this.neighbors.length=0,this.visited=!1,this.body=null}},{}],61:[function(t,e,i){function n(t){u.apply(this),t=t||{},this.springs=[],this.bodies=[],this.disabledBodyCollisionPairs=[],this.solver=t.solver||new r,this.narrowphase=new g(this),this.islandManager=new A,this.gravity=o.fromValues(0,-9.78),t.gravity&&o.copy(this.gravity,t.gravity),this.frictionGravity=o.length(this.gravity)||10,this.useWorldGravityAsFrictionGravity=!0,this.useFrictionGravityOnZeroGravity=!0,this.broadphase=t.broadphase||new m,this.broadphase.setWorld(this),this.constraints=[],this.defaultMaterial=new d,this.defaultContactMaterial=new f(this.defaultMaterial,this.defaultMaterial),this.lastTimeStep=1/60,this.applySpringForces=!0,this.applyDamping=!0,this.applyGravity=!0,this.solveConstraints=!0,this.contactMaterials=[],this.time=0,this.accumulator=0,this.stepping=!1,this.bodiesToBeRemoved=[],this.islandSplit="undefined"!=typeof t.islandSplit?!!t.islandSplit:!0,this.emitImpactEvent=!0,this._constraintIdCounter=0,this._bodyIdCounter=0,this.postStepEvent={type:"postStep"},this.addBodyEvent={type:"addBody",body:null},this.removeBodyEvent={type:"removeBody",body:null},this.addSpringEvent={type:"addSpring",spring:null},this.impactEvent={type:"impact",bodyA:null,bodyB:null,shapeA:null,shapeB:null,contactEquation:null},this.postBroadphaseEvent={type:"postBroadphase",pairs:null},this.sleepMode=n.NO_SLEEPING,this.beginContactEvent={type:"beginContact",shapeA:null,shapeB:null,bodyA:null,bodyB:null,contactEquations:[]},this.endContactEvent={type:"endContact",shapeA:null,shapeB:null,bodyA:null,bodyB:null},this.preSolveEvent={type:"preSolve",contactEquations:null,frictionEquations:null},this.overlappingShapesLastState={keys:[]},this.overlappingShapesCurrentState={keys:[]},this.overlapKeeper=new b}var r=t("../solver/GSSolver"),o=(t("../solver/Solver"),t("../collision/Ray"),t("../math/vec2")),a=t("../shapes/Circle"),s=t("../shapes/Convex"),c=(t("../shapes/Line"),t("../shapes/Plane")),l=t("../shapes/Capsule"),h=t("../shapes/Particle"),u=t("../events/EventEmitter"),p=t("../objects/Body"),d=(t("../shapes/Shape"),t("../objects/LinearSpring"),t("../material/Material")),f=t("../material/ContactMaterial"),v=(t("../constraints/DistanceConstraint"),t("../constraints/Constraint"),t("../constraints/LockConstraint"),t("../constraints/RevoluteConstraint"),t("../constraints/PrismaticConstraint"),t("../constraints/GearConstraint"),t("../../package.json"),t("../collision/Broadphase"),t("../collision/AABB")),m=t("../collision/SAPBroadphase"),g=t("../collision/Narrowphase"),y=t("../utils/Utils"),b=t("../utils/OverlapKeeper"),A=t("./IslandManager");t("../objects/RotationalSpring");e.exports=n,n.prototype=new Object(u.prototype),n.prototype.constructor=n,n.NO_SLEEPING=1,n.BODY_SLEEPING=2,n.ISLAND_SLEEPING=4,n.prototype.addConstraint=function(t){this.constraints.push(t)},n.prototype.addContactMaterial=function(t){this.contactMaterials.push(t)},n.prototype.removeContactMaterial=function(t){var e=this.contactMaterials.indexOf(t);-1!==e&&y.splice(this.contactMaterials,e,1)},n.prototype.getContactMaterial=function(t,e){for(var i=this.contactMaterials,n=0,r=i.length;n!==r;n++){var o=i[n];if(o.materialA.id===t.id&&o.materialB.id===e.id||o.materialA.id===e.id&&o.materialB.id===t.id)return o}return!1},n.prototype.removeConstraint=function(t){var e=this.constraints.indexOf(t);-1!==e&&y.splice(this.constraints,e,1)};var _=(o.create(),o.create(),o.create(),o.create(),o.create(),o.create(),o.create()),E=o.fromValues(0,0),x=o.fromValues(0,0);o.fromValues(0,0),o.fromValues(0,0);n.prototype.step=function(t,e,i){if(i=i||10,e=e||0,0===e)this.internalStep(t),this.time+=t;else{this.accumulator+=e;for(var n=0;this.accumulator>=t&&i>n;)this.internalStep(t),this.time+=t,this.accumulator-=t,n++;for(var r=this.accumulator%t/t,a=0;a!==this.bodies.length;a++){var s=this.bodies[a];o.lerp(s.interpolatedPosition,s.previousPosition,s.position,r),s.interpolatedAngle=s.previousAngle+r*(s.angle-s.previousAngle)}}};var w=[];n.prototype.internalStep=function(t){this.stepping=!0;var e=this.springs.length,i=this.springs,r=this.bodies,a=this.gravity,s=this.solver,c=this.bodies.length,l=this.broadphase,h=this.narrowphase,u=this.constraints,d=_,f=(o.scale,o.add),v=(o.rotate,this.islandManager);if(this.overlapKeeper.tick(),this.lastTimeStep=t,this.useWorldGravityAsFrictionGravity){var m=o.length(this.gravity);0===m&&this.useFrictionGravityOnZeroGravity||(this.frictionGravity=m)}if(this.applyGravity)for(var g=0;g!==c;g++){var b=r[g],A=b.force;b.type===p.DYNAMIC&&b.sleepState!==p.SLEEPING&&(o.scale(d,a,b.mass*b.gravityScale),f(A,A,d))}if(this.applySpringForces)for(var g=0;g!==e;g++){var E=i[g];E.applyForce()}if(this.applyDamping)for(var g=0;g!==c;g++){var b=r[g];b.type===p.DYNAMIC&&b.applyDamping(t)}for(var x=l.getCollisionPairs(this),F=this.disabledBodyCollisionPairs,g=F.length-2;g>=0;g-=2)for(var B=x.length-2;B>=0;B-=2)(F[g]===x[B]&&F[g+1]===x[B+1]||F[g+1]===x[B]&&F[g]===x[B+1])&&x.splice(B,2);var q=u.length;for(g=0;g!==q;g++){var C=u[g];if(!C.collideConnected)for(var B=x.length-2;B>=0;B-=2)(C.bodyA===x[B]&&C.bodyB===x[B+1]||C.bodyB===x[B]&&C.bodyA===x[B+1])&&x.splice(B,2)}this.postBroadphaseEvent.pairs=x,this.emit(this.postBroadphaseEvent),this.postBroadphaseEvent.pairs=null,h.reset(this);for(var g=0,S=x.length;g!==S;g+=2)for(var P=x[g],M=x[g+1],k=0,L=P.shapes.length;k!==L;k++)for(var R=P.shapes[k],I=R.position,O=R.angle,T=0,V=M.shapes.length;T!==V;T++){var N=M.shapes[T],U=N.position,G=N.angle,D=this.defaultContactMaterial;if(R.material&&N.material){var j=this.getContactMaterial(R.material,N.material);j&&(D=j)}this.runNarrowphase(h,P,R,I,O,M,N,U,G,D,this.frictionGravity)}for(var g=0;g!==c;g++){var z=r[g];z._wakeUpAfterNarrowphase&&(z.wakeUp(),z._wakeUpAfterNarrowphase=!1)}if(this.has("endContact")){this.overlapKeeper.getEndOverlaps(w);for(var X=this.endContactEvent,T=w.length;T--;){var H=w[T];X.shapeA=H.shapeA,X.shapeB=H.shapeB,X.bodyA=H.bodyA,X.bodyB=H.bodyB,this.emit(X)}w.length=0}var W=this.preSolveEvent;W.contactEquations=h.contactEquations,W.frictionEquations=h.frictionEquations,this.emit(W),W.contactEquations=W.frictionEquations=null;var q=u.length;for(g=0;g!==q;g++)u[g].update();if(h.contactEquations.length||h.frictionEquations.length||q)if(this.islandSplit){for(v.equations.length=0,y.appendArray(v.equations,h.contactEquations),y.appendArray(v.equations,h.frictionEquations),g=0;g!==q;g++)y.appendArray(v.equations,u[g].equations);v.split(this);for(var g=0;g!==v.islands.length;g++){var Y=v.islands[g];Y.equations.length&&s.solveIsland(t,Y)}}else{for(s.addEquations(h.contactEquations),s.addEquations(h.frictionEquations),g=0;g!==q;g++)s.addEquations(u[g].equations);this.solveConstraints&&s.solve(t,this),s.removeAllEquations()}for(var g=0;g!==c;g++){var z=r[g];z.integrate(t)}for(var g=0;g!==c;g++)r[g].setZeroForce();if(this.emitImpactEvent&&this.has("impact"))for(var K=this.impactEvent,g=0;g!==h.contactEquations.length;g++){var Z=h.contactEquations[g];Z.firstImpact&&(K.bodyA=Z.bodyA,K.bodyB=Z.bodyB,K.shapeA=Z.shapeA,K.shapeB=Z.shapeB,K.contactEquation=Z,this.emit(K))}if(this.sleepMode===n.BODY_SLEEPING)for(g=0;g!==c;g++)r[g].sleepTick(this.time,!1,t);else if(this.sleepMode===n.ISLAND_SLEEPING&&this.islandSplit){for(g=0;g!==c;g++)r[g].sleepTick(this.time,!0,t);for(var g=0;g<this.islandManager.islands.length;g++){var Y=this.islandManager.islands[g];Y.wantsToSleep()&&Y.sleep()}}this.stepping=!1;for(var J=this.bodiesToBeRemoved,g=0;g!==J.length;g++)this.removeBody(J[g]);J.length=0,this.emit(this.postStepEvent)},n.prototype.runNarrowphase=function(t,e,i,n,r,a,s,c,l,h,u){if(0!==(i.collisionGroup&s.collisionMask)&&0!==(s.collisionGroup&i.collisionMask)){o.rotate(E,n,e.angle),o.rotate(x,c,a.angle),o.add(E,E,e.position),o.add(x,x,a.position);var d=r+e.angle,f=l+a.angle;t.enableFriction=h.friction>0,t.frictionCoefficient=h.friction;var v;v=e.type===p.STATIC||e.type===p.KINEMATIC?a.mass:a.type===p.STATIC||a.type===p.KINEMATIC?e.mass:e.mass*a.mass/(e.mass+a.mass),t.slipForce=h.friction*u*v,t.restitution=h.restitution,t.surfaceVelocity=h.surfaceVelocity,t.frictionStiffness=h.frictionStiffness,t.frictionRelaxation=h.frictionRelaxation,t.stiffness=h.stiffness,t.relaxation=h.relaxation,t.contactSkinSize=h.contactSkinSize,t.enabledEquations=e.collisionResponse&&a.collisionResponse&&i.collisionResponse&&s.collisionResponse;var m=t[i.type|s.type],g=0;if(m){var y=i.sensor||s.sensor,b=t.frictionEquations.length;g=i.type<s.type?m.call(t,e,i,E,d,a,s,x,f,y):m.call(t,a,s,x,f,e,i,E,d,y);var A=t.frictionEquations.length-b;if(g){if(e.allowSleep&&e.type===p.DYNAMIC&&e.sleepState===p.SLEEPING&&a.sleepState===p.AWAKE&&a.type!==p.STATIC){var _=o.squaredLength(a.velocity)+Math.pow(a.angularVelocity,2),w=Math.pow(a.sleepSpeedLimit,2);_>=2*w&&(e._wakeUpAfterNarrowphase=!0)}if(a.allowSleep&&a.type===p.DYNAMIC&&a.sleepState===p.SLEEPING&&e.sleepState===p.AWAKE&&e.type!==p.STATIC){var F=o.squaredLength(e.velocity)+Math.pow(e.angularVelocity,2),B=Math.pow(e.sleepSpeedLimit,2);F>=2*B&&(a._wakeUpAfterNarrowphase=!0)}if(this.overlapKeeper.setOverlapping(e,i,a,s),this.has("beginContact")&&this.overlapKeeper.isNewOverlap(i,s)){var q=this.beginContactEvent;if(q.shapeA=i,q.shapeB=s,q.bodyA=e,q.bodyB=a,q.contactEquations.length=0,"number"==typeof g)for(var C=t.contactEquations.length-g;C<t.contactEquations.length;C++)q.contactEquations.push(t.contactEquations[C]);this.emit(q)}if("number"==typeof g&&A>1)for(var C=t.frictionEquations.length-A;C<t.frictionEquations.length;C++){var S=t.frictionEquations[C];S.setSlipForce(S.getSlipForce()/A)}}}}},n.prototype.addSpring=function(t){this.springs.push(t);var e=this.addSpringEvent;e.spring=t,this.emit(e),e.spring=null},n.prototype.removeSpring=function(t){var e=this.springs.indexOf(t);-1!==e&&y.splice(this.springs,e,1)},n.prototype.addBody=function(t){if(-1===this.bodies.indexOf(t)){this.bodies.push(t),t.world=this;var e=this.addBodyEvent;e.body=t,this.emit(e),e.body=null}},n.prototype.removeBody=function(t){if(this.stepping)this.bodiesToBeRemoved.push(t);else{t.world=null;var e=this.bodies.indexOf(t);-1!==e&&(y.splice(this.bodies,e,1),this.removeBodyEvent.body=t,t.resetConstraintVelocity(),this.emit(this.removeBodyEvent),this.removeBodyEvent.body=null)}},n.prototype.getBodyById=function(t){for(var e=this.bodies,i=0;i<e.length;i++){var n=e[i];if(n.id===t)return n}return!1},n.prototype.disableBodyCollision=function(t,e){this.disabledBodyCollisionPairs.push(t,e)},n.prototype.enableBodyCollision=function(t,e){for(var i=this.disabledBodyCollisionPairs,n=0;n<i.length;n+=2)if(i[n]===t&&i[n+1]===e||i[n+1]===t&&i[n]===e)return void i.splice(n,2)},n.prototype.clear=function(){this.time=0,this.solver&&this.solver.equations.length&&this.solver.removeAllEquations();for(var t=this.constraints,e=t.length-1;e>=0;e--)this.removeConstraint(t[e]);for(var i=this.bodies,e=i.length-1;e>=0;e--)this.removeBody(i[e]);for(var r=this.springs,e=r.length-1;e>=0;e--)this.removeSpring(r[e]);for(var o=this.contactMaterials,e=o.length-1;e>=0;e--)this.removeContactMaterial(o[e]);n.apply(this)};var F=o.create(),B=(o.fromValues(0,0),o.fromValues(0,0));n.prototype.hitTest=function(t,e,i){i=i||0;var n=new p({position:t}),r=new h,u=t,d=0,f=F,v=B;n.addShape(r);for(var m=this.narrowphase,g=[],y=0,b=e.length;y!==b;y++)for(var A=e[y],_=0,E=A.shapes.length;_!==E;_++){var x=A.shapes[_];o.rotate(f,x.position,A.angle),o.add(f,f,A.position);var w=x.angle+A.angle;(x instanceof a&&m.circleParticle(A,x,f,w,n,r,u,d,!0)||x instanceof s&&m.particleConvex(n,r,u,d,A,x,f,w,!0)||x instanceof c&&m.particlePlane(n,r,u,d,A,x,f,w,!0)||x instanceof l&&m.particleCapsule(n,r,u,d,A,x,f,w,!0)||x instanceof h&&o.squaredLength(o.sub(v,f,t))<i*i)&&g.push(A)}return g},n.prototype.setGlobalStiffness=function(t){for(var e=this.constraints,i=0;i!==e.length;i++)for(var n=e[i],r=0;r!==n.equations.length;r++){var o=n.equations[r];o.stiffness=t,o.needsUpdate=!0}for(var a=this.contactMaterials,i=0;i!==a.length;i++){var n=a[i];n.stiffness=n.frictionStiffness=t}var n=this.defaultContactMaterial;n.stiffness=n.frictionStiffness=t},n.prototype.setGlobalRelaxation=function(t){for(var e=0;e!==this.constraints.length;e++)for(var i=this.constraints[e],n=0;n!==i.equations.length;n++){var r=i.equations[n];r.relaxation=t,r.needsUpdate=!0}for(var e=0;e!==this.contactMaterials.length;e++){var i=this.contactMaterials[e];i.relaxation=i.frictionRelaxation=t}var i=this.defaultContactMaterial;i.relaxation=i.frictionRelaxation=t};var q=new v,C=[];n.prototype.raycast=function(t,e){return e.getAABB(q),this.broadphase.aabbQuery(this,q,C),e.intersectBodies(t,C),C.length=0,t.hasHit()}},{"../../package.json":6,"../collision/AABB":7,"../collision/Broadphase":8,"../collision/Narrowphase":10,"../collision/Ray":11,"../collision/SAPBroadphase":13,"../constraints/Constraint":14,"../constraints/DistanceConstraint":15,"../constraints/GearConstraint":16,"../constraints/LockConstraint":17,"../constraints/PrismaticConstraint":18,"../constraints/RevoluteConstraint":19,"../events/EventEmitter":26,"../material/ContactMaterial":27,"../material/Material":28,"../math/vec2":30,"../objects/Body":31,"../objects/LinearSpring":32,"../objects/RotationalSpring":33,"../shapes/Capsule":38,"../shapes/Circle":39,"../shapes/Convex":40,"../shapes/Line":42,"../shapes/Particle":43,"../shapes/Plane":44,"../shapes/Shape":45,"../solver/GSSolver":46,"../solver/Solver":47,"../utils/OverlapKeeper":52,"../utils/Utils":57,"./IslandManager":59}]},{},[36])(36)}),!function(t,e,i){"function"==typeof define&&define.amd?define([],i):"object"==typeof exports?module.exports=i():e[t]=i()}("Please",this,function(){"use strict";function t(){function t(t,e,i){var n=Math.random;return i instanceof a&&(n=i.random),Math.floor(n()*(e-t+1))+t}function e(t,e,i){var n=Math.random;return i instanceof a&&(n=i.random),n()*(e-t)+t}function i(t,e,i){return Math.max(e,Math.min(t,i))}function n(t,e){var i;switch(t){case"hex":for(i=0;i<e.length;i++)e[i]=s.HSV_to_HEX(e[i]);break;case"rgb":for(i=0;i<e.length;i++)e[i]=s.HSV_to_RGB(e[i]);break;case"rgb-string":for(i=0;i<e.length;i++){var n=s.HSV_to_RGB(e[i]);e[i]="rgb("+n.r+","+n.g+","+n.b+")"}break;case"hsv":break;default:console.error("Format not recognized.")}return e}function r(t){var e=s.HSV_to_RGB(t),i=(299*e.r+587*e.g+114*e.b)/1e3;return i>=128?"dark":"light"}function o(t){var e={};for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);return e}function a(t){function e(){n=(n+1)%256,r=(r+i[n])%256;var t=i[n];return i[n]=i[r],i[r]=t,i[(i[n]+i[r])%256]}for(var i=[],n=0,r=0,o=0;256>o;o++)i[o]=o;for(var a=0,s=0;256>a;a++){s=(s+i[a]+t.charCodeAt(a%t.length))%256;var c=i[a];i[a]=i[s],i[s]=c}this.random=function(){for(var t=0,i=0,n=1;8>t;t++)i+=e()*n,n*=256;return i/0x10000000000000000}}var s={},c={aliceblue:"F0F8FF",antiquewhite:"FAEBD7",aqua:"00FFFF",aquamarine:"7FFFD4",azure:"F0FFFF",beige:"F5F5DC",bisque:"FFE4C4",black:"000000",blanchedalmond:"FFEBCD",blue:"0000FF",blueviolet:"8A2BE2",brown:"A52A2A",burlywood:"DEB887",cadetblue:"5F9EA0",chartreuse:"7FFF00",chocolate:"D2691E",coral:"FF7F50",cornflowerblue:"6495ED",cornsilk:"FFF8DC",crimson:"DC143C",cyan:"00FFFF",darkblue:"00008B",darkcyan:"008B8B",darkgoldenrod:"B8860B",darkgray:"A9A9A9",darkgrey:"A9A9A9",darkgreen:"006400",darkkhaki:"BDB76B",darkmagenta:"8B008B",darkolivegreen:"556B2F",darkorange:"FF8C00",darkorchid:"9932CC",darkred:"8B0000",darksalmon:"E9967A",darkseagreen:"8FBC8F",darkslateblue:"483D8B",darkslategray:"2F4F4F",darkslategrey:"2F4F4F",darkturquoise:"00CED1",darkviolet:"9400D3",deeppink:"FF1493",deepskyblue:"00BFFF",dimgray:"696969",dimgrey:"696969",dodgerblue:"1E90FF",firebrick:"B22222",floralwhite:"FFFAF0",forestgreen:"228B22",fuchsia:"FF00FF",gainsboro:"DCDCDC",ghostwhite:"F8F8FF",gold:"FFD700",goldenrod:"DAA520",gray:"808080",grey:"808080",green:"008000",greenyellow:"ADFF2F",honeydew:"F0FFF0",hotpink:"FF69B4",indianred:"CD5C5C",indigo:"4B0082",ivory:"FFFFF0",khaki:"F0E68C",lavender:"E6E6FA",lavenderblush:"FFF0F5",lawngreen:"7CFC00",lemonchiffon:"FFFACD",lightblue:"ADD8E6",lightcoral:"F08080",lightcyan:"E0FFFF",lightgoldenrodyellow:"FAFAD2",lightgray:"D3D3D3",lightgrey:"D3D3D3",lightgreen:"90EE90",lightpink:"FFB6C1",lightsalmon:"FFA07A",lightseagreen:"20B2AA",lightskyblue:"87CEFA",lightslategray:"778899",lightslategrey:"778899",lightsteelblue:"B0C4DE",lightyellow:"FFFFE0",lime:"00FF00",limegreen:"32CD32",linen:"FAF0E6",magenta:"FF00FF",maroon:"800000",mediumaquamarine:"66CDAA",mediumblue:"0000CD",mediumorchid:"BA55D3",mediumpurple:"9370D8",mediumseagreen:"3CB371",mediumslateblue:"7B68EE",mediumspringgreen:"00FA9A",mediumturquoise:"48D1CC",mediumvioletred:"C71585",midnightblue:"191970",mintcream:"F5FFFA",mistyrose:"FFE4E1",moccasin:"FFE4B5",navajowhite:"FFDEAD",navy:"000080",oldlace:"FDF5E6",olive:"808000",olivedrab:"6B8E23",orange:"FFA500",orangered:"FF4500",orchid:"DA70D6",palegoldenrod:"EEE8AA",palegreen:"98FB98",paleturquoise:"AFEEEE",palevioletred:"D87093",papayawhip:"FFEFD5",peachpuff:"FFDAB9",peru:"CD853F",pink:"FFC0CB",plum:"DDA0DD",powderblue:"B0E0E6",purple:"800080",rebeccapurple:"663399",red:"FF0000",rosybrown:"BC8F8F",royalblue:"4169E1",saddlebrown:"8B4513",salmon:"FA8072",sandybrown:"F4A460",seagreen:"2E8B57",seashell:"FFF5EE",sienna:"A0522D",silver:"C0C0C0",skyblue:"87CEEB",slateblue:"6A5ACD",slategray:"708090",slategrey:"708090",snow:"FFFAFA",springgreen:"00FF7F",steelblue:"4682B4",tan:"D2B48C",teal:"008080",thistle:"D8BFD8",tomato:"FF6347",turquoise:"40E0D0",violet:"EE82EE",wheat:"F5DEB3",white:"FFFFFF",whitesmoke:"F5F5F5",yellow:"FFFF00",yellowgreen:"9ACD32"},l=.618033988749895,h={hue:null,saturation:null,value:null,base_color:"",greyscale:!1,grayscale:!1,golden:!0,full_random:!1,colors_returned:1,format:"hex",seed:null},u={scheme_type:"analogous",format:"hex"},p={golden:!1,format:"hex"};return s.NAME_to_HEX=function(t){return t=t.toLowerCase(),t in c?c[t]:void console.error("Color name not recognized.")},s.NAME_to_RGB=function(t){return s.HEX_to_RGB(s.NAME_to_HEX(t))},s.NAME_to_HSV=function(t){return s.HEX_to_HSV(s.NAME_to_HEX(t))},s.HEX_to_RGB=function(t){var e=/^#?([a-f\d])([a-f\d])([a-f\d])$/i;t=t.replace(e,function(t,e,i,n){return e+e+i+i+n+n});var i=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return i?{r:parseInt(i[1],16),g:parseInt(i[2],16),b:parseInt(i[3],16)}:null},s.RGB_to_HEX=function(t){return"#"+((1<<24)+(t.r<<16)+(t.g<<8)+t.b).toString(16).slice(1)},s.HSV_to_RGB=function(t){var e,i,n,r,o,a,s,c,l=t.h,h=t.s,u=t.v;if(0===h)return{r:u,g:u,b:u};switch(l/=60,r=Math.floor(l),o=l-r,a=u*(1-h),s=u*(1-h*o),c=u*(1-h*(1-o)),r){case 0:e=u,i=c,n=a;break;case 1:e=s,i=u,n=a;break;case 2:e=a,i=u,n=c;break;case 3:e=a,i=s,n=u;break;case 4:e=c,i=a,n=u;break;case 5:e=u,i=a,n=s}return{r:Math.floor(255*e),g:Math.floor(255*i),b:Math.floor(255*n)}},s.RGB_to_HSV=function(t){var e=t.r/255,i=t.g/255,n=t.b/255,r=0,o=0,a=0,s=Math.min(e,Math.min(i,n)),c=Math.max(e,Math.max(i,n));if(s===c)return a=s,{h:0,s:0,v:a};var l=e===s?i-n:n===s?e-i:n-e,h=e===s?3:n===s?1:5;return r=60*(h-l/(c-s)),o=(c-s)/c,a=c,{h:r,s:o,v:a}},s.HSV_to_HEX=function(t){
return s.RGB_to_HEX(s.HSV_to_RGB(t))},s.HEX_to_HSV=function(t){return s.RGB_to_HSV(s.HEX_to_RGB(t))},s.make_scheme=function(t,e){function r(t){return{h:t.h,s:t.s,v:t.v}}var a,s,c,l,h,p=o(u);if(null!==e)for(var d in e)e.hasOwnProperty(d)&&(p[d]=e[d]);var f=[t];switch(p.scheme_type.toLowerCase()){case"monochromatic":case"mono":for(h=1;2>=h;h++)a=r(t),c=a.s+.1*h,c=i(c,0,1),l=a.v+.1*h,l=i(l,0,1),a.s=c,a.v=l,f.push(a);for(h=1;2>=h;h++)a=r(t),c=a.s-.1*h,c=i(c,0,1),l=a.v-.1*h,l=i(l,0,1),a.s=c,a.v=l,f.push(a);break;case"complementary":case"complement":case"comp":a=r(t),a.h=(a.h+180)%360,f.push(a);break;case"split-complementary":case"split-complement":case"split":a=r(t),a.h=(a.h+165)%360,f.push(a),a=r(t),a.h=Math.abs((a.h-165)%360),f.push(a);break;case"double-complementary":case"double-complement":case"double":a=r(t),a.h=(a.h+180)%360,f.push(a),a.h=(a.h+30)%360,s=r(a),f.push(a),a.h=(a.h+180)%360,f.push(s);break;case"analogous":case"ana":for(h=1;5>=h;h++)a=r(t),a.h=(a.h+20*h)%360,f.push(a);break;case"triadic":case"triad":case"tri":for(h=1;3>h;h++)a=r(t),a.h=(a.h+120*h)%360,f.push(a);break;default:console.error("Color scheme not recognized.")}return n(p.format.toLowerCase(),f),f},s.make_color=function(r){var c=[],u=o(h),p=null;if(null!==r)for(var d in r)r.hasOwnProperty(d)&&(u[d]=r[d]);var f=null;"string"==typeof u.seed&&(f=new a(u.seed)),u.base_color.length>0&&(p=u.base_color.match(/^#?([0-9a-f]{3})([0-9a-f]{3})?$/i)?s.HEX_to_HSV(u.base_color):s.NAME_to_HSV(u.base_color));for(var v=0;v<u.colors_returned;v++){var m,g,y,b=t(0,360,f);null!==p?(m=i(t(p.h-5,p.h+5,f),0,360),g=0===p.s?0:e(.4,.85,f),y=e(.4,.85,f),c.push({h:m,s:g,v:y})):(m=u.greyscale===!0||u.grayscale===!0?0:u.golden===!0?(b+b/l)%360:null===u.hue||u.full_random===!0?b:i(u.hue,0,360),g=u.greyscale===!0||u.grayscale===!0?0:u.full_random===!0?e(0,1,f):null===u.saturation?.4:i(u.saturation,0,1),y=u.full_random===!0?e(0,1,f):u.greyscale===!0||u.grayscale===!0?e(.15,.75,f):null===u.value?.75:i(u.value,0,1),c.push({h:m,s:g,v:y}))}return n(u.format.toLowerCase(),c),c},s.make_contrast=function(t,e){var a=o(p);if(null!==e)for(var c in e)e.hasOwnProperty(c)&&(a[c]=e[c]);var h,u,d=r(t);if(a.golden===!0)u=t.h*(1+l)%360;else{var f=s.make_scheme(t,{scheme_type:"complementary",format:"hsv"})[1];u=i(f.h-30,0,360)}var v;return"dark"===d?v=i(t.v-.25,0,1):"light"===d&&(v=i(t.v+.25,0,1)),h=[{h:u,s:t.s,v:v}],n(a.format.toLowerCase(),h),h[0]},s}return t()}),function(){var t,e,i,n,r,o,a,s,c,l,h,u,p,d,f,v,m,g,y,b,A,_,E,x;t=!1,c=function(e,i){return null==i&&(i=t),t?console.log(e):void 0},m=function(t,e){return t=Math.floor(t),e=Math.floor(e),Math.floor(Math.random()*(e-t+1))+t},v=function(t,e,i){return t>=e-i&&e+i>t?!0:!1},window.two=new Two({fullscreen:!0}).appendTo(document.body),window.two_canvas=new Two({fullscreen:!0,type:Two.Types.canvas}),p=Math.floor(two.height/10),x=new p2.World({gravity:[0,p]}),e=-1,i=0,u={},l={},E=[],_=[],b=function(t,e){var i;return null==t&&(t=0),null==e&&(e=Please.make_color()),i=document.getElementById("level"),i||0!==t?(i||(i=document.createElement("h2"),i.id="level",document.body.appendChild(i)),i.setAttribute("style","color:"+e+";"),0!==t?i.innerHTML=""+t:i.innerHTML=""+t):!1},A=function(t){return null==t&&(t=Please.make_color()),window.document.body.style.background=t},r=function(t,e,i,n,r,o){var a,s,c;return null==i&&(i=70),null==n&&(n=200),null==r&&(r=10),null==o&&(o=1),i=Math.floor(i),n=Math.floor(n),r=Math.floor(r),a=e.makeCircle(i,n,r),a.fill=Please.make_color(),a.stroke="black",a.linewidth=2,c=new p2.Circle({radius:r}),c.material=new p2.Material,s=new p2.Body({mass:o,position:[i,n],damping:0,angularDamping:0}),s.ID=!1,s.addShape(c),t.addBody(s),{two:a,p2:{shape:c,body:s}}},a=function(t,e,i,n,o,a,s){var c;return null==s&&(s=0),c=r(t,e,n,o,a,s),t.addContactMaterial(new p2.ContactMaterial(i.p2.shape.material,c.p2.shape.material,{restitution:.9,stiffness:Number.MAX_VALUE})),c},s=function(t,e,n,r,o,s,c,l){var h,u,p,d,f,v;for(null==t&&(t=t),null==e&&(e=e),null==n&&(n=n),null==r&&(r=r),f=1-i/100,20>i&&(f=.8),0>f&&(f=0),p=u=0,d=r.length;d>u;p=++u)h=r[p],(20>i&&r.length-p>3||i>=20)&&(h.two.opacity=h.two.opacity*f,h.two.opacity<.2&&(h.two.opacity=0,e.remove(h),g(h)));return v=a(t,e,n,o,s,c,l),r.push(v),v},h=function(t,e,i){return null==e&&(e=e),null==i&&(i=i),t.two.translation.set(Math.floor(t.p2.body.position[0]),Math.floor(t.p2.body.position[1])),t},o=function(t,e,i,n,o,a){return null==t&&(t=t),null==e&&(e=e),null==n&&(n=m(0,e.height)),null==o&&(o=20),null==a&&(a=0),i||(i=Math.random()<.5?m(0,Math.floor(e.width/2)-28):m(Math.floor(e.width/2)+28,e.width)),u=r(t,e,i,n,o,a),u.p2.shape.sensor=!0,u.p2.body.damping=0,u.p2.body.ID="ENDDOT",u.two.fill="black",u},(d=function(){var t,e,n,s,c,h,d;if(A(),u=o(x,two),l=r(x,two,two.width/2,-30,10,1),t=i,t>0)for(d=c=0,h=t;h>=0?h>c:c>h;d=h>=0?++c:--c)n=m(0,two.width),s=m(50,two.height),n>u.p2.body.position[0]-35&&n<u.p2.body.position[0]+35&&s>u.p2.body.position[1]-35&&s<u.p2.body.position[1]+35||(e=a(x,two,l,n,s,30),_.push(e));return two.height>10*p?l.p2.body.velocity=[0,Math.floor(two.height/7)]:l.p2.body.velocity=[0,Math.floor(two.height/9)],l.p2.body.ID="DOT",window.scrollTo(0,1),two.play()})(),g=function(t){return x.removeBody(t.p2.body)},y=function(t){var e,n,r,o,a;for(null==t&&(t=!1),two.pause(),two.clear(),g(u),g(l),n=0,o=E.length;o>n;n++)e=E[n],g(e);for(E=[],r=0,a=_.length;a>r;r++)e=_[r],g(e);return _=[],t===!0?i+=1:(i-=1,0>i&&(i=0)),b(i),d()},f=function(t,e,i){return null==e&&(e=e),null==i&&(i=i),t.p2.body.position[1]>i.height+50||t.p2.body.position[0]<-50||t.p2.body.position[0]>i.width+50?!0:!1},two.bind("update",function(t){return h(l),x.step(1/60),e>-1&&(0===e?(y(!0),e=-1):e-=1),-1===e&&f(l,x,two)===!0?y(!1):void 0}),x.on("beginContact",function(t){return"ENDDOT"!==t.bodyB.ID&&"DOT"!==t.bodyB.ID||"ENDDOT"!==t.bodyA.ID&&"DOT"!==t.bodyA.ID?void 0:(u.two.fill="white",u.two.stroke="white",e=15)}),n=function(t){var e,i,n,r,o,a,c,h;return t.preventDefault(),t.stopPropagation(),c=null!=(e=null!=t&&null!=(i=t.touches)&&null!=(n=i[0])?n.pageX:void 0)?e:null!=t?t.pageX:void 0,h=null!=(r=null!=t&&null!=(o=t.touches)&&null!=(a=o[0])?a.pageY:void 0)?r:null!=t?t.pageY:void 0,v(c,u.p2.body.position[0],15)&&v(h,u.p2.body.position[1],15)?!1:null!=c&&null!=h?(s(x,two,l,E,c,h,30),!0):!1},document.body.addEventListener("mousedown",function(t){return n(t)}),document.body.addEventListener("touchstart",function(t){return n(t)}),document.body.addEventListener("click",function(t){return t.preventDefault()})}.call(this);